{"version":3,"sources":["../src/alumican.canvas/alm/canvas/Pointer.ts","../src/alumican.canvas/alm/canvas/BaseApp.ts"],"names":["alm","canvas_1","EventDispatcher","DeviceInfo","BaseApp","canvas","event","browser","_super","isAutoResizeEnabled","platformSetupOptions","_i","arguments","length","_this","call","this","mouseOverHandler","getMousePointer","mouseOutHandler","pointer","pointersById","mousePointerId","pointerIndex","pointerIds","indexOf","splice","pointingCount","notifyLeave","onPointerLeave","mouseDownHandler","notifyTouch","onPointerTouch","mouseUpHandler","notifyRelease","onPointerRelease","mouseMoveHandler","position","getPointerPosition","notifyMove","onPointerMove","isDragging","onPointerDrag","touchStartHandler","touch","id","touches","changedTouches","touchCount","i","item","getPointerId","identifier","Pointer","push","notifyEnter","onPointerEnter","touchEndHandler","touchCancelHandler","touchMoveHandler","originalEvent","preventDefault","touchForceChangeHandler","notifyTouchForce","force","onPointerTouchForceChange","keyDownHandler","onKeyDown","key","keyUpHandler","onKeyUp","resizeHandler","resize","width","height","requestAnimationFrame","elapsedFrameCount","elapsedTime","Date","getTime","startTime","onUpdate","onPlatformRender","jQuery","trace","getIsTouchEnabled","on","attr","onPlatformSetup","apply","onSetup","__extends","prototype","onResize","stageWidth","stageHeight","onPlatformResize","offset","getCanvas","pageX","left","pageY","top","touchId","getPointerIds","getFirstPointer","getPointerById","getLastPointer","getPointingCount","getStageWidth","getStageHeight","getElapsedFrameCount","getElapsedTime","getIsAutoResizeEnabled","setIsAutoResizeEnabled","value","isHovering","isTouching","x","y","prevX","prevY","dragX","dragY","velocityX","velocityY","touchBeginX","touchBeginY","touchForce"],"mappings":"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","file":"alumican.canvas.min.js","sourcesContent":["/// <reference path=\"../../include.ts\" />\n\nnamespace alm.canvas {\n\n\texport class Pointer {\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// CONSTRUCTOR\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tconstructor(id:string) {\n\t\t\tthis.id = id;\n\n\t\t\tthis.isHovering = false;\n\t\t\tthis.isTouching = false;\n\t\t\tthis.isDragging = false;\n\n\t\t\tthis.x = 0;\n\t\t\tthis.y = 0;\n\n\t\t\tthis.prevX = 0;\n\t\t\tthis.prevY = 0;\n\n\t\t\tthis.dragX = 0;\n\t\t\tthis.dragY = 0;\n\n\t\t\tthis.velocityX = 0;\n\t\t\tthis.velocityY = 0;\n\n\t\t\tthis.touchBeginX = 0;\n\t\t\tthis.touchBeginY = 0;\n\n\t\t\tthis.touchForce = 0;\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// METHOD\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic notifyEnter(x:number, y:number):void {\n\t\t\tthis.prevX = this.x = x;\n\t\t\tthis.prevY = this.y = y;\n\t\t\tthis.isHovering = true;\n\t\t}\n\n\t\tpublic notifyLeave():void {\n\t\t\tthis.isHovering = false;\n\t\t}\n\n\t\tpublic notifyTouch():void {\n\t\t\tthis.isTouching = true;\n\t\t\tthis.touchBeginX = this.x;\n\t\t\tthis.touchBeginY = this.y;\n\t\t}\n\n\t\tpublic notifyRelease():void {\n\t\t\tthis.isTouching = false;\n\t\t\tthis.isDragging = false;\n\t\t\tthis.dragX = 0;\n\t\t\tthis.dragY = 0;\n\t\t}\n\n\t\tpublic notifyMove(x:number, y:number):void {\n\t\t\tthis.prevX = this.x;\n\t\t\tthis.prevY = this.y;\n\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\n\t\t\tthis.velocityX = this.x - this.prevX;\n\t\t\tthis.velocityY = this.y - this.prevY;\n\n\t\t\tif (this.isTouching) {\n\t\t\t\tthis.isDragging = true;\n\t\t\t}\n\n\t\t\tif (this.isDragging) {\n\t\t\t\tthis.dragX = this.x - this.touchBeginX;\n\t\t\t\tthis.dragY = this.y - this.touchBeginY;\n\t\t\t}\n\t\t}\n\n\t\tpublic notifyTouchForce(force:number):void {\n\t\t\tthis.touchForce = force;\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// MEMBER\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic id:string;\n\t\tpublic isHovering:boolean;\n\t\tpublic isTouching:boolean;\n\t\tpublic isDragging:boolean;\n\n\t\tpublic x:number;\n\t\tpublic y:number;\n\n\t\tpublic prevX:number;\n\t\tpublic prevY:number;\n\n\t\tpublic dragX:number;\n\t\tpublic dragY:number;\n\n\t\tpublic velocityX:number;\n\t\tpublic velocityY:number;\n\n\t\tpublic touchBeginX:number;\n\t\tpublic touchBeginY:number;\n\n\t\tpublic touchForce:number;\n\t}\n}","/// <reference path=\"../../include.ts\" />\n\nnamespace alm.canvas {\n\n\timport EventDispatcher = alm.event.EventDispatcher;\n\timport DeviceInfo = alm.browser.DeviceInfo;\n\n\texport abstract class BaseApp extends EventDispatcher {\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// CONSTRUCTOR\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tconstructor(canvas:HTMLElement, isAutoResizeEnabled:boolean = true, ...platformSetupOptions:any[]) {\n\t\t\tsuper();\n\n\t\t\tthis.canvas = <JQuery<HTMLCanvasElement>>jQuery(canvas);\n\t\t\tthis.isAutoResizeEnabled = isAutoResizeEnabled;\n\n\t\t\ttrace(\"[BaseApp] canvas : \", canvas);\n\t\t\ttrace(\"[BaseApp] isAutoResizeEnabled : \" + this.isAutoResizeEnabled);\n\n\t\t\tthis.pointerIds = [];\n\t\t\tthis.pointersById = {};\n\t\t\tthis.pointingCount = 0;\n\n\t\t\tthis.elapsedFrameCount = 0;\n\t\t\tthis.startTime = new Date().getTime();\n\t\t\tthis.mousePointerId = 'mouse';\n\n\t\t\tif (DeviceInfo.getIsTouchEnabled()) {\n\t\t\t\tthis.canvas.on('touchstart', this.touchStartHandler);\n\t\t\t\tthis.canvas.on('touchend', this.touchEndHandler);\n\t\t\t\tthis.canvas.on('touchcancel', this.touchCancelHandler);\n\t\t\t\tthis.canvas.on('touchmove', this.touchMoveHandler);\n\t\t\t\tthis.canvas.on('touchforcechange', this.touchForceChangeHandler);\n\t\t\t} else {\n\t\t\t\tthis.canvas.on('mouseover', this.mouseOverHandler);\n\t\t\t\tthis.canvas.on('mouseout', this.mouseOutHandler);\n\t\t\t\tthis.canvas.on('mousedown', this.mouseDownHandler);\n\t\t\t\tthis.canvas.on('mouseup', this.mouseUpHandler);\n\t\t\t\tthis.canvas.on('mousemove', this.mouseMoveHandler);\n\t\t\t}\n\n\t\t\tthis.canvas.on('keydown', this.keyDownHandler);\n\t\t\tthis.canvas.on('keyup', this.keyUpHandler);\n\t\t\tthis.canvas.attr('tabindex', 1);\n\n\t\t\trequestAnimationFrame(this.requestAnimationFrame);\n\n\t\t\tthis.onPlatformSetup.apply(this, platformSetupOptions);\n\t\t\tthis.onSetup();\n\n\t\t\tif (this.isAutoResizeEnabled) {\n\t\t\t\tthis.canvas.on('resize', this.resizeHandler);\n\t\t\t\tthis.resizeHandler(null);\n\t\t\t}\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// METHOD\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic onSetup():void {\n\t\t}\n\n\t\tpublic onUpdate():void {\n\t\t}\n\n\t\tpublic onPointerEnter(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerLeave(pointer:Pointer,):void {\n\t\t}\n\n\t\tpublic onPointerTouch(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerRelease(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerMove(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerDrag(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerTouchForceChange(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onKeyDown(key:string):void {\n\t\t}\n\n\t\tpublic onKeyUp(key:string):void {\n\t\t}\n\n\t\tpublic onResize(stageWidth:number, stageHeight:number):void {\n\t\t}\n\n\t\tprotected onPlatformSetup(...platformSetupOptions:any[]):void {\n\t\t}\n\n\t\tprotected onPlatformRender():void {\n\t\t}\n\n\t\tprotected onPlatformResize(stageWidth:number, stageHeight:number):void {\n\t\t}\n\n\t\tpublic resize(width:number, height:number):void {\n\t\t\tthis.stageWidth = width;\n\t\t\tthis.stageHeight = height;\n\t\t\ttrace('[BaseApp] resize : width = ' + this.stageWidth + ', height = ' + this.stageHeight);\n\t\t\tthis.onPlatformResize(this.stageWidth, this.stageHeight);\n\t\t\tthis.onResize(this.stageWidth, this.stageHeight);\n\t\t}\n\n\t\t// --------------------------------------------------\n\t\t// Mouse Event\n\n\t\tprivate mouseOverHandler = (event:JQuery.Event):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t};\n\n\t\tprivate mouseOutHandler = (event:JQuery.Event):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tdelete this.pointersById[this.mousePointerId];\n\t\t\tconst pointerIndex = this.pointerIds.indexOf(this.mousePointerId);\n\t\t\tif (pointerIndex != -1) {\n\t\t\t\tthis.pointerIds.splice(pointerIndex, 1);\n\t\t\t}\n\t\t\t--this.pointingCount;\n\t\t\tpointer.notifyLeave();\n\t\t\tthis.onPointerLeave(pointer);\n\t\t};\n\n\t\tprivate mouseDownHandler = (event:JQuery.Event):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tpointer.notifyTouch();\n\t\t\tthis.onPointerTouch(pointer);\n\t\t};\n\n\t\tprivate mouseUpHandler = (event:JQuery.Event):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tpointer.notifyRelease();\n\t\t\tthis.onPointerRelease(pointer);\n\t\t};\n\n\t\tprivate mouseMoveHandler = (event:JQuery.Event):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tconst position:number[] = this.getPointerPosition(event);\n\t\t\tpointer.notifyMove(position[0], position[1]);\n\t\t\tthis.onPointerMove(pointer);\n\t\t\tif (pointer.isDragging) {\n\t\t\t\tthis.onPointerDrag(pointer);\n\t\t\t}\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Touch Event\n\n\t\tprivate touchStartHandler = (event:JQuery.Event):void => {\n\t\t\tconst touches:TouchList = event.changedTouches;\n\t\t\tconst touchCount:number = event.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = new Pointer(id);\n\t\t\t\tthis.pointersById[id] = pointer;\n\t\t\t\tthis.pointerIds.push(id);\n\t\t\t\t++this.pointingCount;\n\t\t\t\tconst position:number[] = this.getPointerPosition(event);\n\t\t\t\tpointer.notifyEnter(position[0], position[1]);\n\t\t\t\tpointer.notifyTouch();\n\t\t\t\tthis.onPointerEnter(pointer);\n\t\t\t\tthis.onPointerTouch(pointer);\n\t\t\t}\n\t\t};\n\n\t\tprivate touchEndHandler = (event:JQuery.Event):void => {\n\t\t\tconst touches:TouchList = event.changedTouches;\n\t\t\tconst touchCount:number = event.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = this.pointersById[id];\n\t\t\t\tdelete this.pointersById[id];\n\t\t\t\tconst pointerIndex = this.pointerIds.indexOf(id);\n\t\t\t\tif (pointerIndex != -1) {\n\t\t\t\t\tthis.pointerIds.splice(pointerIndex, 1);\n\t\t\t\t}\n\t\t\t\t--this.pointingCount;\n\t\t\t\tpointer.notifyRelease();\n\t\t\t\tpointer.notifyLeave();\n\t\t\t\tthis.onPointerRelease(pointer);\n\t\t\t\tthis.onPointerLeave(pointer);\n\t\t\t}\n\t\t};\n\n\t\tprivate touchCancelHandler = (event:JQuery.Event):void => {\n\t\t\tthis.touchEndHandler(event);\n\t\t};\n\n\t\tprivate touchMoveHandler = (event:JQuery.Event):void => {\n\t\t\tevent.originalEvent.preventDefault();\n\n\t\t\tconst touches:TouchList = event.changedTouches;\n\t\t\tconst touchCount:number = event.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = this.pointersById[id];\n\t\t\t\tconst position:number[] = this.getPointerPosition(event);\n\t\t\t\tpointer.notifyMove(position[0], position[1]);\n\t\t\t\tif (pointer.isDragging) {\n\t\t\t\t\tthis.onPointerDrag(pointer);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tprivate touchForceChangeHandler = (event:JQuery.Event):void => {\n\t\t\tconst touches:TouchList = event.changedTouches;\n\t\t\tconst touchCount:number = event.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = this.pointersById[id];\n\t\t\t\tif (pointer) {\n\t\t\t\t\tpointer.notifyTouchForce(touch.force);\n\t\t\t\t\tthis.onPointerTouchForceChange(pointer);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Key Event\n\n\t\tprivate keyDownHandler = (event:JQuery.Event):void => {\n\t\t\tthis.onKeyDown(event.key);\n\t\t};\n\n\t\tprivate keyUpHandler = (event:JQuery.Event):void => {\n\t\t\tthis.onKeyUp(event.key);\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Other Event\n\n\t\tprivate resizeHandler = (event:JQuery.Event):void => {\n\t\t\tthis.resize(this.canvas.width(), this.canvas.height());\n\t\t};\n\n\t\tprivate requestAnimationFrame = ():void => {\n\t\t\t++this.elapsedFrameCount;\n\t\t\tthis.elapsedTime = (new Date().getTime() - this.startTime) / 1000;\n\t\t\tthis.onUpdate();\n\t\t\tthis.onPlatformRender();\n\t\t\trequestAnimationFrame(this.requestAnimationFrame);\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Util\n\n\t\tprivate getMousePointer(event:JQuery.Event):Pointer {\n\t\t\tlet pointer:Pointer = this.pointersById[this.mousePointerId];\n\t\t\tif (pointer == null) {\n\t\t\t\tpointer = new Pointer(this.mousePointerId);\n\t\t\t\tthis.pointersById[this.mousePointerId] = pointer;\n\t\t\t\tthis.pointerIds.push(this.mousePointerId);\n\t\t\t\t++this.pointingCount;\n\t\t\t\tconst position:number[] = this.getPointerPosition(event);\n\t\t\t\tpointer.notifyEnter(position[0], position[1]);\n\t\t\t\tthis.onPointerEnter(pointer);\n\t\t\t}\n\t\t\treturn pointer;\n\t\t}\n\n\t\tprivate getPointerPosition(event:JQuery.Event):number[] {\n\t\t\t//return [event.clientX, event.clientY];\n\n\t\t\tconst offset:JQuery.Coordinates = this.getCanvas().offset();\n\t\t\treturn [\n\t\t\t\tevent.pageX - offset.left,\n\t\t\t\tevent.pageY - offset.top\n\t\t\t];\n\t\t}\n\n\t\tpublic static getPointerId(touchId:number):string {\n\t\t\treturn 'touch_' + touchId;\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// MEMBER\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic getPointerIds():string[] { return this.pointerIds; }\n\t\tprivate pointerIds:string[];\n\n\t\tpublic getFirstPointer():Pointer { return this.pointingCount > 0 ? this.getPointerById(this.pointerIds[0]) : null; }\n\t\tpublic getLastPointer():Pointer { return this.pointingCount > 0 ? this.getPointerById(this.pointerIds[this.pointingCount - 1]) : null; }\n\n\t\tpublic getPointerById(id:string):Pointer { return this.pointersById[id]; }\n\t\tprivate pointersById:alm.util.Hash<Pointer>;\n\n\t\tpublic getPointingCount():number { return this.pointingCount; }\n\t\tprivate pointingCount:number;\n\n\t\tpublic getStageWidth():number { return this.stageWidth; }\n\t\tprivate stageWidth:number;\n\n\t\tpublic getStageHeight():number { return this.stageHeight; }\n\t\tprivate stageHeight:number;\n\n\t\tpublic getElapsedFrameCount():number { return this.elapsedFrameCount; }\n\t\tprivate elapsedFrameCount:number;\n\n\t\tpublic getElapsedTime():number { return this.elapsedTime; }\n\t\tprivate elapsedTime:number;\n\n\t\tpublic getCanvas():JQuery<HTMLCanvasElement> { return this.canvas; }\n\t\tprivate canvas:JQuery<HTMLCanvasElement>;\n\n\t\tpublic getIsAutoResizeEnabled():boolean { return this.isAutoResizeEnabled; }\n\t\tpublic setIsAutoResizeEnabled(value:boolean):void { this.isAutoResizeEnabled = value; }\n\t\tprivate isAutoResizeEnabled:boolean;\n\n\t\tprivate startTime:number;\n\t\tprivate mousePointerId:string;\n\t}\n}"]}