{"version":3,"sources":["../src/alumican.canvas/alm/canvas/BaseApp.ts","../src/alumican.canvas/alm/canvas/Pointer.ts"],"names":["alm","canvas","BaseApp","canvasId","isAutoResizeEnabled","platformSetupOptions","_i","arguments","length","_this","this","mouseOverHandler","event","getMousePointer","mouseOutHandler","pointer","pointersById","mousePointerId","pointerIndex","pointerIds","indexOf","splice","pointingCount","notifyLeave","onPointerLeave","mouseDownHandler","notifyTouch","onPointerTouch","mouseUpHandler","notifyRelease","onPointerRelease","mouseMoveHandler","notifyMove","clientX","clientY","onPointerMove","isDragging","onPointerDrag","touchStartHandler","touch","id","touches","changedTouches","touchCount","i","item","getPointerId","identifier","Pointer","push","notifyEnter","onPointerEnter","touchEndHandler","touchCancelHandler","touchMoveHandler","canvasTouchMoveHandler","originalEvent","preventDefault","keyDownHandler","onKeyDown","key","keyUpHandler","onKeyUp","resizeHandler","resize","$","window","width","height","requestAnimationFrame","elapsedFrameCount","elapsedTime","Date","getTime","startTime","onUpdate","onPlatformRender","jQuery","trace","on","onPlatformSetup","apply","onSetup","prototype","onResize","stageWidth","stageHeight","onPlatformResize","touchId","getPointerIds","getFirstPointer","getPointerById","getLastPointer","getPointingCount","getStageWidth","getStageHeight","getElapsedFrameCount","getElapsedTime","getCanvas","getIsAutoResizeEnabled","setIsAutoResizeEnabled","value","isHovering","isTouching","x","y","prevX","prevY","dragX","dragY","velocityX","velocityY","touchBeginX","touchBeginY"],"mappings":"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","file":"alumican.canvas.min.js","sourcesContent":["/// <reference path=\"../../include.ts\" />\n\nnamespace alm.canvas {\n\n\texport abstract class BaseApp {\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// CONSTRUCTOR\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tconstructor(canvasId:string, isAutoResizeEnabled:boolean = true, ...platformSetupOptions:any[]) {\n\t\t\tthis.canvas = <JQuery<HTMLCanvasElement>>jQuery(canvasId);\n\t\t\tthis.isAutoResizeEnabled = isAutoResizeEnabled;\n\n\t\t\ttrace(\"[BaseApp] canvasId : \" + canvasId);\n\t\t\ttrace(\"[BaseApp] isAutoResizeEnabled : \" + this.isAutoResizeEnabled);\n\n\t\t\tthis.pointerIds = [];\n\t\t\tthis.pointersById = {};\n\t\t\tthis.pointingCount = 0;\n\n\t\t\tthis.elapsedFrameCount = 0;\n\t\t\tthis.startTime = new Date().getTime();\n\t\t\tthis.mousePointerId = 'mouse';\n\n\t\t\tjQuery(window).on('mouseover', this.mouseOverHandler);\n\t\t\tjQuery(window).on('mouseout', this.mouseOutHandler);\n\t\t\tjQuery(window).on('mousedown', this.mouseDownHandler);\n\t\t\tjQuery(window).on('mouseup', this.mouseUpHandler);\n\t\t\tjQuery(window).on('mousemove', this.mouseMoveHandler);\n\t\t\tjQuery(window).on('touchstart', this.touchStartHandler);\n\t\t\tjQuery(window).on('touchend', this.touchEndHandler);\n\t\t\tjQuery(window).on('touchcancel', this.touchCancelHandler);\n\t\t\tjQuery(window).on('touchmove', this.touchMoveHandler);\n\t\t\tjQuery(window).on('keydown', this.keyDownHandler);\n\t\t\tjQuery(window).on('keyup', this.keyUpHandler);\n\t\t\tthis.canvas.on('touchmove', this.canvasTouchMoveHandler);\n\t\t\trequestAnimationFrame(this.requestAnimationFrame);\n\n\t\t\tthis.onPlatformSetup.apply(this, platformSetupOptions);\n\t\t\tthis.onSetup();\n\n\t\t\tif (this.isAutoResizeEnabled) {\n\t\t\t\tjQuery(window).on('resize', this.resizeHandler);\n\t\t\t\tthis.resizeHandler(null);\n\t\t\t}\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// METHOD\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic onSetup():void {\n\t\t}\n\n\t\tpublic onUpdate():void {\n\t\t}\n\n\t\tpublic onPointerEnter(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerLeave(pointer:Pointer,):void {\n\t\t}\n\n\t\tpublic onPointerTouch(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerRelease(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerMove(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerDrag(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onKeyDown(key:string):void {\n\t\t}\n\n\t\tpublic onKeyUp(key:string):void {\n\t\t}\n\n\t\tpublic onResize(stageWidth:number, stageHeight:number):void {\n\t\t}\n\n\t\tprotected onPlatformSetup(...platformSetupOptions:any[]):void {\n\t\t}\n\n\t\tprotected onPlatformRender():void {\n\t\t}\n\n\t\tprotected onPlatformResize(stageWidth:number, stageHeight:number):void {\n\t\t}\n\n\t\tpublic resize(width:number, height:number):void {\n\t\t\tthis.stageWidth = width;\n\t\t\tthis.stageHeight = height;\n\t\t\ttrace('[BaseApp] resize : width = ' + this.stageWidth + ', height = ' + this.stageHeight);\n\t\t\tthis.onPlatformResize(this.stageWidth, this.stageHeight);\n\t\t\tthis.onResize(this.stageWidth, this.stageHeight);\n\t\t}\n\n\t\t// --------------------------------------------------\n\t\t// Mouse Event\n\n\t\tprivate mouseOverHandler = (event:JQuery.Event):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t};\n\n\t\tprivate mouseOutHandler = (event:JQuery.Event):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tdelete this.pointersById[this.mousePointerId];\n\t\t\tconst pointerIndex = this.pointerIds.indexOf(this.mousePointerId);\n\t\t\tif (pointerIndex != -1) {\n\t\t\t\tthis.pointerIds.splice(pointerIndex, 1);\n\t\t\t}\n\t\t\t--this.pointingCount;\n\t\t\tpointer.notifyLeave();\n\t\t\tthis.onPointerLeave(pointer);\n\t\t};\n\n\t\tprivate mouseDownHandler = (event:JQuery.Event):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tpointer.notifyTouch();\n\t\t\tthis.onPointerTouch(pointer);\n\t\t};\n\n\t\tprivate mouseUpHandler = (event:JQuery.Event):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tpointer.notifyRelease();\n\t\t\tthis.onPointerRelease(pointer);\n\t\t};\n\n\t\tprivate mouseMoveHandler = (event:JQuery.Event):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tpointer.notifyMove(event.clientX, event.clientY);\n\t\t\tthis.onPointerMove(pointer);\n\t\t\tif (pointer.isDragging) {\n\t\t\t\tthis.onPointerDrag(pointer);\n\t\t\t}\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Touch Event\n\n\t\tprivate touchStartHandler = (event:JQuery.Event):void => {\n\t\t\tconst touches:TouchList = event.changedTouches;\n\t\t\tconst touchCount:number = event.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = new Pointer(id);\n\t\t\t\tthis.pointersById[id] = pointer;\n\t\t\t\tthis.pointerIds.push(id);\n\t\t\t\t++this.pointingCount;\n\t\t\t\tpointer.notifyEnter(touch.clientX, touch.clientY);\n\t\t\t\tthis.onPointerEnter(pointer);\n\t\t\t\tpointer.notifyTouch();\n\t\t\t\tthis.onPointerTouch(pointer);\n\t\t\t}\n\t\t};\n\n\t\tprivate touchEndHandler = (event:JQuery.Event):void => {\n\t\t\tconst touches:TouchList = event.changedTouches;\n\t\t\tconst touchCount:number = event.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = this.pointersById[id];\n\t\t\t\tdelete this.pointersById[id];\n\t\t\t\tconst pointerIndex = this.pointerIds.indexOf(id);\n\t\t\t\tif (pointerIndex != -1) {\n\t\t\t\t\tthis.pointerIds.splice(pointerIndex, 1);\n\t\t\t\t}\n\t\t\t\t--this.pointingCount;\n\t\t\t\tpointer.notifyRelease();\n\t\t\t\tthis.onPointerRelease(pointer);\n\t\t\t\tpointer.notifyLeave();\n\t\t\t\tthis.onPointerLeave(pointer);\n\t\t\t}\n\t\t};\n\n\t\tprivate touchCancelHandler = (event:JQuery.Event):void => {\n\t\t\tthis.touchEndHandler(event);\n\t\t};\n\n\t\tprivate touchMoveHandler = (event:JQuery.Event):void => {\n\t\t\tconst touches:TouchList = event.changedTouches;\n\t\t\tconst touchCount:number = event.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = this.pointersById[id];\n\t\t\t\tpointer.notifyMove(touch.clientX, touch.clientY);\n\t\t\t\tif (pointer.isDragging) {\n\t\t\t\t\tthis.onPointerDrag(pointer);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tprivate canvasTouchMoveHandler = (event:JQuery.Event):void => {\n\t\t\tevent.originalEvent.preventDefault();\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Key Event\n\n\t\tprivate keyDownHandler = (event:JQuery.Event):void => {\n\t\t\tthis.onKeyDown(event.key);\n\t\t};\n\n\t\tprivate keyUpHandler = (event:JQuery.Event):void => {\n\t\t\tthis.onKeyUp(event.key);\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Other Event\n\n\t\tprivate resizeHandler = (event:JQuery.Event):void => {\n\t\t\tthis.resize($(window).width(), $(window).height());\n\t\t};\n\n\t\tprivate requestAnimationFrame = ():void => {\n\t\t\t++this.elapsedFrameCount;\n\t\t\tthis.elapsedTime = (new Date().getTime() - this.startTime) / 1000;\n\t\t\tthis.onUpdate();\n\t\t\tthis.onPlatformRender();\n\t\t\trequestAnimationFrame(this.requestAnimationFrame);\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Util\n\n\t\tprivate getMousePointer(event:JQuery.Event):Pointer {\n\t\t\tlet pointer:Pointer = this.pointersById[this.mousePointerId];\n\t\t\tif (pointer == null) {\n\t\t\t\tpointer = new Pointer(this.mousePointerId);\n\t\t\t\tthis.pointersById[this.mousePointerId] = pointer;\n\t\t\t\tthis.pointerIds.push(this.mousePointerId);\n\t\t\t\t++this.pointingCount;\n\t\t\t\tpointer.notifyEnter(event.clientX, event.clientY);\n\t\t\t\tthis.onPointerEnter(pointer);\n\t\t\t}\n\t\t\treturn pointer;\n\t\t}\n\n\t\tpublic static getPointerId(touchId:number):string {\n\t\t\treturn 'touch_' + touchId;\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// MEMBER\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic getPointerIds():string[] { return this.pointerIds; }\n\t\tprivate pointerIds:string[];\n\n\t\tpublic getFirstPointer():Pointer { return this.pointingCount > 0 ? this.getPointerById(this.pointerIds[0]) : null; }\n\t\tpublic getLastPointer():Pointer { return this.pointingCount > 0 ? this.getPointerById(this.pointerIds[this.pointingCount - 1]) : null; }\n\n\t\tpublic getPointerById(id:string):Pointer { return this.pointersById[id]; }\n\t\tprivate pointersById:alm.util.Hash<Pointer>;\n\n\t\tpublic getPointingCount():number { return this.pointingCount; }\n\t\tprivate pointingCount:number;\n\n\t\tpublic getStageWidth():number { return this.stageWidth; }\n\t\tprivate stageWidth:number;\n\n\t\tpublic getStageHeight():number { return this.stageHeight; }\n\t\tprivate stageHeight:number;\n\n\t\tpublic getElapsedFrameCount():number { return this.elapsedFrameCount; }\n\t\tprivate elapsedFrameCount:number;\n\n\t\tpublic getElapsedTime():number { return this.elapsedTime; }\n\t\tprivate elapsedTime:number;\n\n\t\tpublic getCanvas():JQuery<HTMLCanvasElement> { return this.canvas; }\n\t\tprivate canvas:JQuery<HTMLCanvasElement>;\n\n\t\tpublic getIsAutoResizeEnabled():boolean { return this.isAutoResizeEnabled; }\n\t\tpublic setIsAutoResizeEnabled(value:boolean):void { this.isAutoResizeEnabled = value; }\n\t\tprivate isAutoResizeEnabled:boolean;\n\n\t\tprivate startTime:number;\n\t\tprivate mousePointerId:string;\n\t}\n}","/// <reference path=\"../../include.ts\" />\n\nnamespace alm.canvas {\n\n\texport class Pointer {\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// CONSTRUCTOR\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tconstructor(id:string) {\n\t\t\tthis.id = id;\n\n\t\t\tthis.isHovering = false;\n\t\t\tthis.isTouching = false;\n\t\t\tthis.isDragging = false;\n\n\t\t\tthis.x = 0;\n\t\t\tthis.y = 0;\n\n\t\t\tthis.prevX = 0;\n\t\t\tthis.prevY = 0;\n\n\t\t\tthis.dragX = 0;\n\t\t\tthis.dragY = 0;\n\n\t\t\tthis.velocityX = 0;\n\t\t\tthis.velocityY = 0;\n\n\t\t\tthis.touchBeginX = 0;\n\t\t\tthis.touchBeginY = 0;\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// METHOD\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic notifyEnter(x:number, y:number):void {\n\t\t\tthis.prevX = this.x = x;\n\t\t\tthis.prevY = this.y = y;\n\t\t\tthis.isHovering = true;\n\t\t}\n\n\t\tpublic notifyLeave():void {\n\t\t\tthis.isHovering = false;\n\t\t}\n\n\t\tpublic notifyTouch():void {\n\t\t\tthis.isTouching = true;\n\t\t\tthis.touchBeginX = this.x;\n\t\t\tthis.touchBeginY = this.y;\n\t\t}\n\n\t\tpublic notifyRelease():void {\n\t\t\tthis.isTouching = false;\n\t\t\tthis.isDragging = false;\n\t\t\tthis.dragX = 0;\n\t\t\tthis.dragY = 0;\n\t\t}\n\n\t\tpublic notifyMove(x:number, y:number):void {\n\t\t\tthis.prevX = this.x;\n\t\t\tthis.prevY = this.y;\n\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\n\t\t\tthis.velocityX = this.x - this.prevX;\n\t\t\tthis.velocityY = this.y - this.prevY;\n\n\t\t\tif (this.isTouching) {\n\t\t\t\tthis.isDragging = true;\n\t\t\t}\n\n\t\t\tif (this.isDragging) {\n\t\t\t\tthis.dragX = this.x - this.touchBeginX;\n\t\t\t\tthis.dragY = this.y - this.touchBeginY;\n\t\t\t}\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// MEMBER\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic id:string;\n\t\tpublic isHovering:boolean;\n\t\tpublic isTouching:boolean;\n\t\tpublic isDragging:boolean;\n\n\t\tpublic x:number;\n\t\tpublic y:number;\n\n\t\tpublic prevX:number;\n\t\tpublic prevY:number;\n\n\t\tpublic dragX:number;\n\t\tpublic dragY:number;\n\n\t\tpublic velocityX:number;\n\t\tpublic velocityY:number;\n\n\t\tpublic touchBeginX:number;\n\t\tpublic touchBeginY:number;\n\t}\n}"]}