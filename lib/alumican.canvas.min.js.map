{"version":3,"sources":["../src/alumican.canvas/alm/canvas/Pointer.ts","../src/alumican.canvas/alm/canvas/BaseApp.ts"],"names":["alm","canvas_1","EventDispatcher","DeviceInfo","BaseApp","canvas","event","browser","_super","isAutoResizeEnabled","platformSetupOptions","_this","call","this","mouseOverHandler","getMousePointer","mouseOutHandler","pointer","pointersById","mousePointerId","pointerIndex","pointerIds","indexOf","splice","pointingCount","notifyLeave","onPointerLeave","mouseDownHandler","notifyTouch","onPointerTouch","mouseUpHandler","notifyRelease","onPointerRelease","mouseMoveHandler","position","getMousePointerPosition","notifyMove","onPointerMove","isDragging","onPointerDrag","touchStartHandler","touch","id","touches","changedTouches","touchCount","length","i","item","getPointerId","identifier","Pointer","push","getTouchPointerPosition","notifyEnter","onPointerEnter","touchEndHandler","touchCancelHandler","touchMoveHandler","originalEvent","preventDefault","touchForceChangeHandler","notifyTouchForce","force","onPointerTouchForceChange","keyDownHandler","onKeyDown","key","keyUpHandler","onKeyUp","resizeHandler","newStageWidth","width","newStageHeight","height","stageWidth","stageHeight","resize","visibilityStateChangeHandler","onVisibilityStateChange","document","visibilityState","requestAnimationFrame","elapsedFrameCount","elapsedTime","Date","getTime","startTime","onUpdate","onPlatformRender","window","jQuery","isTouchEnabled","getIsTouchEnabled","isForceTouchEnabled","trace","on","onPlatformSetup","onSetup","__extends","prototype","onResize","onPlatformResize","offset","getCanvas","pageX","left","pageY","top","touchId","getPointerIds","getFirstPointer","getPointerById","getLastPointer","getPointingCount","getStageWidth","getStageHeight","getElapsedFrameCount","getElapsedTime","getIsAutoResizeEnabled","setIsAutoResizeEnabled","value","getIsForceTouchEnabled","isHovering","isTouching","x","y","prevX","prevY","dragX","dragY","velocityX","velocityY","touchBeginX","touchBeginY","touchForce"],"mappings":"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","file":"alumican.canvas.min.js","sourcesContent":["/// <reference path=\"../../include.ts\" />\n\nnamespace alm.canvas {\n\n\texport class Pointer {\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// CONSTRUCTOR\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tconstructor(id:string) {\n\t\t\tthis.id = id;\n\n\t\t\tthis.isHovering = false;\n\t\t\tthis.isTouching = false;\n\t\t\tthis.isDragging = false;\n\n\t\t\tthis.x = 0;\n\t\t\tthis.y = 0;\n\n\t\t\tthis.prevX = 0;\n\t\t\tthis.prevY = 0;\n\n\t\t\tthis.dragX = 0;\n\t\t\tthis.dragY = 0;\n\n\t\t\tthis.velocityX = 0;\n\t\t\tthis.velocityY = 0;\n\n\t\t\tthis.touchBeginX = 0;\n\t\t\tthis.touchBeginY = 0;\n\n\t\t\tthis.touchForce = 0;\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// METHOD\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic notifyEnter(x:number, y:number):void {\n\t\t\tthis.prevX = this.x = x;\n\t\t\tthis.prevY = this.y = y;\n\t\t\tthis.isHovering = true;\n\t\t}\n\n\t\tpublic notifyLeave():void {\n\t\t\tthis.isHovering = false;\n\t\t}\n\n\t\tpublic notifyTouch():void {\n\t\t\tthis.isTouching = true;\n\t\t\tthis.touchBeginX = this.x;\n\t\t\tthis.touchBeginY = this.y;\n\t\t}\n\n\t\tpublic notifyRelease():void {\n\t\t\tthis.isTouching = false;\n\t\t\tthis.isDragging = false;\n\t\t\tthis.dragX = 0;\n\t\t\tthis.dragY = 0;\n\t\t}\n\n\t\tpublic notifyMove(x:number, y:number):void {\n\t\t\tthis.prevX = this.x;\n\t\t\tthis.prevY = this.y;\n\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\n\t\t\tthis.velocityX = this.x - this.prevX;\n\t\t\tthis.velocityY = this.y - this.prevY;\n\n\t\t\tif (this.isTouching) {\n\t\t\t\tthis.isDragging = true;\n\t\t\t}\n\n\t\t\tif (this.isDragging) {\n\t\t\t\tthis.dragX = this.x - this.touchBeginX;\n\t\t\t\tthis.dragY = this.y - this.touchBeginY;\n\t\t\t}\n\t\t}\n\n\t\tpublic notifyTouchForce(force:number):void {\n\t\t\tthis.touchForce = force;\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// MEMBER\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic id:string;\n\t\tpublic isHovering:boolean;\n\t\tpublic isTouching:boolean;\n\t\tpublic isDragging:boolean;\n\n\t\tpublic x:number;\n\t\tpublic y:number;\n\n\t\tpublic prevX:number;\n\t\tpublic prevY:number;\n\n\t\tpublic dragX:number;\n\t\tpublic dragY:number;\n\n\t\tpublic velocityX:number;\n\t\tpublic velocityY:number;\n\n\t\tpublic touchBeginX:number;\n\t\tpublic touchBeginY:number;\n\n\t\tpublic touchForce:number;\n\t}\n}","/// <reference path=\"../../include.ts\" />\n\nnamespace alm.canvas {\n\n\timport EventDispatcher = alm.event.EventDispatcher;\n\timport DeviceInfo = alm.browser.DeviceInfo;\n\n\texport abstract class BaseApp extends EventDispatcher {\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// CONSTRUCTOR\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tconstructor(canvas:HTMLElement, isAutoResizeEnabled:boolean = true, platformSetupOptions:any[] = null) {\n\t\t\tsuper();\n\n\t\t\tthis.window = jQuery(window);\n\n\t\t\tthis.canvas = <JQuery<HTMLCanvasElement>>jQuery(canvas);\n\t\t\tthis.isAutoResizeEnabled = isAutoResizeEnabled;\n\n\t\t\tthis.pointerIds = [];\n\t\t\tthis.pointersById = {};\n\t\t\tthis.pointingCount = 0;\n\n\t\t\tthis.elapsedFrameCount = 0;\n\t\t\tthis.startTime = new Date().getTime();\n\t\t\tthis.mousePointerId = 'mouse';\n\t\t\tthis.isTouchEnabled = DeviceInfo.getIsTouchEnabled();\n\t\t\tthis.isForceTouchEnabled = typeof canvas['ontouchforcechange'] !== 'undefined';\n\n\t\t\ttrace(\"[BaseApp] canvas : \", canvas);\n\t\t\ttrace(\"[BaseApp] platformSetupOptions : \", platformSetupOptions);\n\t\t\ttrace(\"[BaseApp] isAutoResizeEnabled : \" + this.isAutoResizeEnabled);\n\t\t\ttrace(\"[BaseApp] isTouchEnabled : \" + this.isTouchEnabled);\n\t\t\ttrace(\"[BaseApp] isForceTouchEnabled : \" + this.isForceTouchEnabled);\n\n\t\t\tif (this.isTouchEnabled) {\n\t\t\t\tthis.canvas.on('touchstart', this.touchStartHandler);\n\t\t\t\tthis.canvas.on('touchend', this.touchEndHandler);\n\t\t\t\tthis.canvas.on('touchcancel', this.touchCancelHandler);\n\t\t\t\tthis.canvas.on('touchmove', this.touchMoveHandler);\n\t\t\t\tif (this.isForceTouchEnabled) {\n\t\t\t\t\tthis.canvas.on('touchforcechange', this.touchForceChangeHandler);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.canvas.on('mouseover', this.mouseOverHandler);\n\t\t\t\tthis.canvas.on('mouseout', this.mouseOutHandler);\n\t\t\t\tthis.canvas.on('mousedown', this.mouseDownHandler);\n\t\t\t\tthis.canvas.on('mouseup', this.mouseUpHandler);\n\t\t\t\tthis.canvas.on('mousemove', this.mouseMoveHandler);\n\t\t\t}\n\n\t\t\tthis.window.on('keydown', this.keyDownHandler);\n\t\t\tthis.window.on('keyup', this.keyUpHandler);\n\t\t\t//this.canvas.attr('tabindex', 1);\n\n\t\t\tjQuery(document).on('visibilitychange', this.visibilityStateChangeHandler);\n\n\t\t\trequestAnimationFrame(this.requestAnimationFrame);\n\n\t\t\tthis.onPlatformSetup(platformSetupOptions || []);\n\t\t\tthis.onSetup();\n\n\t\t\tif (this.isAutoResizeEnabled) {\n\t\t\t\tthis.window.on('resize', this.resizeHandler);\n\t\t\t\tthis.resizeHandler(null);\n\t\t\t}\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// METHOD\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic onSetup():void {\n\t\t}\n\n\t\tpublic onUpdate():void {\n\t\t}\n\n\t\tpublic onPointerEnter(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerLeave(pointer:Pointer,):void {\n\t\t}\n\n\t\tpublic onPointerTouch(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerRelease(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerMove(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerDrag(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerTouchForceChange(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onKeyDown(key:string):void {\n\t\t}\n\n\t\tpublic onKeyUp(key:string):void {\n\t\t}\n\n\t\tpublic onResize(stageWidth:number, stageHeight:number):void {\n\t\t}\n\n\t\tpublic onVisibilityStateChange(visibilityState:VisibilityState):void {\n\t\t}\n\n\t\tprotected onPlatformSetup(platformSetupOptions:any[]):void {\n\t\t}\n\n\t\tprotected onPlatformRender():void {\n\t\t}\n\n\t\tprotected onPlatformResize(stageWidth:number, stageHeight:number):void {\n\t\t}\n\n\t\tpublic resize(width:number, height:number):void {\n\t\t\tthis.stageWidth = width;\n\t\t\tthis.stageHeight = height;\n\t\t\ttrace('[BaseApp] resize : width = ' + this.stageWidth + ', height = ' + this.stageHeight);\n\t\t\tthis.onPlatformResize(this.stageWidth, this.stageHeight);\n\t\t\tthis.onResize(this.stageWidth, this.stageHeight);\n\t\t}\n\n\t\t// --------------------------------------------------\n\t\t// Mouse Event\n\n\t\tprivate mouseOverHandler = (event:JQuery.MouseOverEvent):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t};\n\n\t\tprivate mouseOutHandler = (event:JQuery.MouseOutEvent):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tdelete this.pointersById[this.mousePointerId];\n\t\t\tconst pointerIndex = this.pointerIds.indexOf(this.mousePointerId);\n\t\t\tif (pointerIndex != -1) {\n\t\t\t\tthis.pointerIds.splice(pointerIndex, 1);\n\t\t\t}\n\t\t\t--this.pointingCount;\n\t\t\tpointer.notifyLeave();\n\t\t\tthis.onPointerLeave(pointer);\n\t\t};\n\n\t\tprivate mouseDownHandler = (event:JQuery.MouseDownEvent):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tpointer.notifyTouch();\n\t\t\tthis.onPointerTouch(pointer);\n\t\t};\n\n\t\tprivate mouseUpHandler = (event:JQuery.MouseUpEvent):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tpointer.notifyRelease();\n\t\t\tthis.onPointerRelease(pointer);\n\t\t};\n\n\t\tprivate mouseMoveHandler = (event:JQuery.MouseMoveEvent):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tconst position:number[] = this.getMousePointerPosition(event);\n\t\t\tpointer.notifyMove(position[0], position[1]);\n\t\t\tthis.onPointerMove(pointer);\n\t\t\tif (pointer.isDragging) {\n\t\t\t\tthis.onPointerDrag(pointer);\n\t\t\t}\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Touch Event\n\n\t\tprivate touchStartHandler = (event:JQuery.TouchEventBase):void => {\n\t\t\tconst touches:TouchList = event.changedTouches;\n\t\t\tconst touchCount:number = event.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = new Pointer(id);\n\t\t\t\tthis.pointersById[id] = pointer;\n\t\t\t\tthis.pointerIds.push(id);\n\t\t\t\t++this.pointingCount;\n\t\t\t\tconst position:number[] = this.getTouchPointerPosition(touch);\n\t\t\t\tpointer.notifyEnter(position[0], position[1]);\n\t\t\t\tpointer.notifyTouch();\n\t\t\t\tthis.onPointerEnter(pointer);\n\t\t\t\tthis.onPointerTouch(pointer);\n\t\t\t}\n\t\t};\n\n\t\tprivate touchEndHandler = (event:JQuery.TouchEventBase):void => {\n\t\t\tconst touches:TouchList = event.changedTouches;\n\t\t\tconst touchCount:number = event.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = this.pointersById[id];\n\t\t\t\tdelete this.pointersById[id];\n\t\t\t\tconst pointerIndex = this.pointerIds.indexOf(id);\n\t\t\t\tif (pointerIndex != -1) {\n\t\t\t\t\tthis.pointerIds.splice(pointerIndex, 1);\n\t\t\t\t}\n\t\t\t\t--this.pointingCount;\n\t\t\t\tpointer.notifyRelease();\n\t\t\t\tpointer.notifyLeave();\n\t\t\t\tthis.onPointerRelease(pointer);\n\t\t\t\tthis.onPointerLeave(pointer);\n\t\t\t}\n\t\t};\n\n\t\tprivate touchCancelHandler = (event:JQuery.TouchEventBase):void => {\n\t\t\tthis.touchEndHandler(event);\n\t\t};\n\n\t\tprivate touchMoveHandler = (event:JQuery.TouchEventBase):void => {\n\t\t\tevent.originalEvent.preventDefault();\n\n\t\t\tconst touches:TouchList = event.changedTouches;\n\t\t\tconst touchCount:number = event.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = this.pointersById[id];\n\t\t\t\tconst position:number[] = this.getTouchPointerPosition(touch);\n\t\t\t\tpointer.notifyMove(position[0], position[1]);\n\t\t\t\tif (pointer.isDragging) {\n\t\t\t\t\tthis.onPointerDrag(pointer);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tprivate touchForceChangeHandler = (event:JQuery.TouchEventBase):void => {\n\t\t\tconst touches:TouchList = event.changedTouches;\n\t\t\tconst touchCount:number = event.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = this.pointersById[id];\n\t\t\t\tif (pointer) {\n\t\t\t\t\tpointer.notifyTouchForce(touch.force);\n\t\t\t\t\tthis.onPointerTouchForceChange(pointer);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Key Event\n\n\t\tprivate keyDownHandler = (event:JQuery.KeyDownEvent):void => {\n\t\t\tthis.onKeyDown(event.key);\n\t\t};\n\n\t\tprivate keyUpHandler = (event:JQuery.KeyUpEvent):void => {\n\t\t\tthis.onKeyUp(event.key);\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Other Event\n\n\t\tprivate resizeHandler = (event:JQuery.ResizeEvent):void => {\n\t\t\tconst newStageWidth:number = this.canvas.width();\n\t\t\tconst newStageHeight:number = this.canvas.height();\n\t\t\tif (this.stageWidth != newStageWidth || this.stageHeight != newStageHeight) {\n\t\t\t\tthis.resize(newStageWidth, newStageHeight);\n\t\t\t}\n\t\t};\n\n\t\tprivate visibilityStateChangeHandler = (event:JQuery.Event):void => {\n\t\t\tthis.onVisibilityStateChange(document.visibilityState);\n\t\t};\n\n\t\tprivate requestAnimationFrame = ():void => {\n\t\t\t++this.elapsedFrameCount;\n\t\t\tthis.elapsedTime = (new Date().getTime() - this.startTime) / 1000;\n\t\t\tthis.onUpdate();\n\t\t\tthis.onPlatformRender();\n\t\t\trequestAnimationFrame(this.requestAnimationFrame);\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Util\n\n\t\tprivate getMousePointer(event:JQuery.Event):Pointer {\n\t\t\tlet pointer:Pointer = this.pointersById[this.mousePointerId];\n\t\t\tif (pointer == null) {\n\t\t\t\tpointer = new Pointer(this.mousePointerId);\n\t\t\t\tthis.pointersById[this.mousePointerId] = pointer;\n\t\t\t\tthis.pointerIds.push(this.mousePointerId);\n\t\t\t\t++this.pointingCount;\n\t\t\t\tconst position:number[] = this.getMousePointerPosition(event);\n\t\t\t\tpointer.notifyEnter(position[0], position[1]);\n\t\t\t\tthis.onPointerEnter(pointer);\n\t\t\t}\n\t\t\treturn pointer;\n\t\t}\n\n\t\tprivate getTouchPointerPosition(touch:Touch):number[] {\n\t\t\tconst offset:JQuery.Coordinates = this.getCanvas().offset();\n\t\t\t//trace(touch, touch.clientX, touch.clientY, touch.pageX, touch.pageY, offset.left, offset.top);\n\t\t\treturn [touch.pageX - offset.left, touch.pageY - offset.top];\n\t\t}\n\n\t\tprivate getMousePointerPosition(event:JQuery.Event):number[] {\n\t\t\tconst offset:JQuery.Coordinates = this.getCanvas().offset();\n\t\t\treturn [event.pageX - offset.left, event.pageY - offset.top];\n\t\t}\n\n\t\tpublic static getPointerId(touchId:number):string {\n\t\t\treturn 'touch_' + touchId;\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// MEMBER\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic getPointerIds():string[] { return this.pointerIds; }\n\t\tprivate pointerIds:string[];\n\n\t\tpublic getFirstPointer():Pointer { return this.pointingCount > 0 ? this.getPointerById(this.pointerIds[0]) : null; }\n\t\tpublic getLastPointer():Pointer { return this.pointingCount > 0 ? this.getPointerById(this.pointerIds[this.pointingCount - 1]) : null; }\n\n\t\tpublic getPointerById(id:string):Pointer { return this.pointersById[id]; }\n\t\tprivate pointersById:alm.util.Hash<Pointer>;\n\n\t\tpublic getPointingCount():number { return this.pointingCount; }\n\t\tprivate pointingCount:number;\n\n\t\tpublic getStageWidth():number { return this.stageWidth; }\n\t\tprivate stageWidth:number;\n\n\t\tpublic getStageHeight():number { return this.stageHeight; }\n\t\tprivate stageHeight:number;\n\n\t\tpublic getElapsedFrameCount():number { return this.elapsedFrameCount; }\n\t\tprivate elapsedFrameCount:number;\n\n\t\tpublic getElapsedTime():number { return this.elapsedTime; }\n\t\tprivate elapsedTime:number;\n\n\t\tpublic getCanvas():JQuery<HTMLCanvasElement> { return this.canvas; }\n\t\tprivate canvas:JQuery<HTMLCanvasElement>;\n\n\t\tpublic getIsAutoResizeEnabled():boolean { return this.isAutoResizeEnabled; }\n\t\tpublic setIsAutoResizeEnabled(value:boolean):void { this.isAutoResizeEnabled = value; }\n\t\tprivate isAutoResizeEnabled:boolean;\n\n\t\tpublic getIsForceTouchEnabled():boolean { return this.isForceTouchEnabled; }\n\t\tprivate isForceTouchEnabled:boolean;\n\n\t\tpublic getIsTouchEnabled():boolean { return this.isTouchEnabled; }\n\t\tprivate isTouchEnabled:boolean;\n\n\t\tprivate startTime:number;\n\t\tprivate mousePointerId:string;\n\t\tprivate window:JQuery<Window>;\n\t}\n}"]}