{"version":3,"sources":["../src/alumican.canvas/alm/canvas/BaseApp.ts","../src/alumican.canvas/alm/canvas/Pointer.ts"],"names":["alm","canvas_1","canvas","EventDispatcher","event","DeviceInfo","browser","Time","util","BaseApp","constructor","isAutoResizeEnabled","isAutoUpdateEnabled","platformSetupOptions","super","this","mouseOverHandler","getMousePointer","mouseOutHandler","pointer","pointersById","mousePointerId","pointerIndex","pointerIds","indexOf","splice","pointingCount","notifyLeave","onPointerLeave","mouseDownHandler","notifyTouch","onPointerTouch","mouseUpHandler","notifyRelease","onPointerRelease","mouseMoveHandler","position","getMousePointerPosition","notifyMove","onPointerMove","isDragging","onPointerDrag","touchStartHandler","originalEvent","touches","changedTouches","touch","touchCount","length","let","i","item","id","getPointerId","identifier","Pointer","push","getTouchPointerPosition","notifyEnter","onPointerEnter","touchEndHandler","touchCancelHandler","touchMoveHandler","isDefaultTouchEventEnabled","preventDefault","touchForceChangeHandler","notifyTouchForce","force","onPointerTouchForceChange","keyDownHandler","onKeyDown","key","keyUpHandler","onKeyUp","requestAnimationFrameHandler","update","window","requestAnimationFrame","resizeHandler","newStageWidth","width","newStageHeight","height","stageWidth","stageHeight","resize","visibilityStateChangeHandler","visibilityState","document","onVisibilityStateChange","jQuery","elapsedFrameCount","startTime","now","isTouchEnabled","getIsTouchEnabled","isForceTouchEnabled","trace","on","onPlatformSetup","onSetup","onUpdate","onResize","onPlatformRender","onPlatformResize","elapsedTime","offset","getCanvas","pageX","left","pageY","top","touchId","getPointerIds","getFirstPointer","getPointerById","getLastPointer","getPointingCount","getStageWidth","getStageHeight","getElapsedFrameCount","getElapsedTime","getVisibilityState","getIsAutoResizeEnabled","getIsAutoUpdateEnabled","getIsForceTouchEnabled","getIsDefaultTouchEventEnabled","setIsDefaultTouchEventEnabled","value","isHovering","isTouching","x","y","prevX","prevY","dragX","dragY","velocityX","velocityY","touchBeginX","touchBeginY","touchForce"],"mappings":"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","file":"index.min.js","sourcesContent":["/// <reference path=\"../../index.ts\" />\n\nnamespace alm.canvas {\n\n\timport EventDispatcher = alm.event.EventDispatcher;\n\timport DeviceInfo = alm.browser.DeviceInfo;\n\timport AnimationFrameTicker = alm.time.AnimationFrameTicker;\n\timport Time = alm.util.Time;\n\n\texport abstract class BaseApp extends EventDispatcher {\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// CONSTRUCTOR\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tconstructor(canvas:HTMLElement, isAutoResizeEnabled:boolean = true, isAutoUpdateEnabled:boolean = true, platformSetupOptions:any[] = null) {\n\t\t\tsuper();\n\n\t\t\tthis.window = jQuery(window);\n\n\t\t\tthis.canvas = <JQuery<HTMLCanvasElement>>jQuery(canvas);\n\t\t\tthis.isAutoResizeEnabled = isAutoResizeEnabled;\n\t\t\tthis.isAutoUpdateEnabled = isAutoUpdateEnabled;\n\t\t\tthis.isDefaultTouchEventEnabled = false;\n\n\t\t\tthis.pointerIds = [];\n\t\t\tthis.pointersById = {};\n\t\t\tthis.pointingCount = 0;\n\n\t\t\tthis.elapsedFrameCount = 0;\n\t\t\tthis.startTime = Time.now();\n\t\t\tthis.mousePointerId = 'mouse';\n\t\t\tthis.isTouchEnabled = DeviceInfo.getIsTouchEnabled();\n\t\t\tthis.isForceTouchEnabled = typeof canvas['ontouchforcechange'] !== 'undefined';\n\t\t\tthis.visibilityState = document.visibilityState;\n\n\t\t\ttrace(\"[BaseApp] canvas : \", canvas);\n\t\t\ttrace(\"[BaseApp] platformSetupOptions : \", platformSetupOptions);\n\t\t\ttrace(\"[BaseApp] isAutoResizeEnabled : \" + this.isAutoResizeEnabled);\n\t\t\ttrace(\"[BaseApp] isAutoUpdateEnabled : \" + this.isAutoUpdateEnabled);\n\t\t\ttrace(\"[BaseApp] isTouchEnabled : \" + this.isTouchEnabled);\n\t\t\ttrace(\"[BaseApp] isForceTouchEnabled : \" + this.isForceTouchEnabled);\n\n\t\t\tif (this.isTouchEnabled) {\n\t\t\t\tthis.canvas.on('touchstart', this.touchStartHandler);\n\t\t\t\tthis.canvas.on('touchend', this.touchEndHandler);\n\t\t\t\tthis.canvas.on('touchcancel', this.touchCancelHandler);\n\t\t\t\tthis.canvas.on('touchmove', this.touchMoveHandler);\n\t\t\t\tif (this.isForceTouchEnabled) {\n\t\t\t\t\tthis.canvas.on('touchforcechange', this.touchForceChangeHandler);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.canvas.on('mouseover', this.mouseOverHandler);\n\t\t\t\tthis.canvas.on('mouseout', this.mouseOutHandler);\n\t\t\t\tthis.canvas.on('mousedown', this.mouseDownHandler);\n\t\t\t\tthis.canvas.on('mouseup', this.mouseUpHandler);\n\t\t\t\tthis.canvas.on('mousemove', this.mouseMoveHandler);\n\t\t\t}\n\n\t\t\tthis.window.on('keydown', this.keyDownHandler);\n\t\t\tthis.window.on('keyup', this.keyUpHandler);\n\t\t\t//this.canvas.attr('tabindex', 1);\n\n\t\t\tjQuery(document).on('visibilitychange', this.visibilityStateChangeHandler);\n\n\t\t\tif (this.isAutoUpdateEnabled) {\n\t\t\t\t//this.animationFrameTicker = new AnimationFrameTicker();\n\t\t\t\t//this.animationFrameTicker.addEventListener(AnimationFrameTickerEvent.TICK, this.animationFrameTickerTickHandler);\n\t\t\t\t//this.animationFrameTicker.start();\n\t\t\t\twindow.requestAnimationFrame(this.requestAnimationFrameHandler);\n\t\t\t}\n\n\t\t\tthis.onPlatformSetup(platformSetupOptions || []);\n\t\t\tthis.onSetup();\n\n\t\t\tif (this.isAutoResizeEnabled) {\n\t\t\t\tthis.window.on('resize', this.resizeHandler);\n\t\t\t\tthis.resizeHandler(null);\n\t\t\t}\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// METHOD\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic onSetup():void {\n\t\t}\n\n\t\tpublic onUpdate():void {\n\t\t}\n\n\t\tpublic onPointerEnter(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerLeave(pointer:Pointer,):void {\n\t\t}\n\n\t\tpublic onPointerTouch(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerRelease(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerMove(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerDrag(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerTouchForceChange(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onKeyDown(key:string):void {\n\t\t}\n\n\t\tpublic onKeyUp(key:string):void {\n\t\t}\n\n\t\tpublic onResize(stageWidth:number, stageHeight:number):void {\n\t\t}\n\n\t\tpublic onVisibilityStateChange(visibilityState:DocumentVisibilityState):void {\n\t\t}\n\n\t\tprotected onPlatformSetup(platformSetupOptions:any[]):void {\n\t\t}\n\n\t\tprotected onPlatformRender():void {\n\t\t}\n\n\t\tprotected onPlatformResize(stageWidth:number, stageHeight:number):void {\n\t\t}\n\n\t\tpublic update():void {\n\t\t\t++this.elapsedFrameCount;\n\t\t\tthis.elapsedTime = (Time.now() - this.startTime) / 1000;\n\t\t\tthis.onUpdate();\n\t\t\tthis.onPlatformRender();\n\t\t}\n\n\t\tpublic resize(width:number, height:number):void {\n\t\t\tthis.stageWidth = width;\n\t\t\tthis.stageHeight = height;\n\t\t\ttrace('[BaseApp] resize : width = ' + this.stageWidth + ', height = ' + this.stageHeight);\n\t\t\tthis.onPlatformResize(this.stageWidth, this.stageHeight);\n\t\t\tthis.onResize(this.stageWidth, this.stageHeight);\n\t\t}\n\n\t\t// --------------------------------------------------\n\t\t// Mouse Event\n\n\t\tprivate mouseOverHandler = (event:JQuery.MouseOverEvent):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t};\n\n\t\tprivate mouseOutHandler = (event:JQuery.MouseOutEvent):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tdelete this.pointersById[this.mousePointerId];\n\t\t\tconst pointerIndex = this.pointerIds.indexOf(this.mousePointerId);\n\t\t\tif (pointerIndex != -1) {\n\t\t\t\tthis.pointerIds.splice(pointerIndex, 1);\n\t\t\t}\n\t\t\t--this.pointingCount;\n\t\t\tpointer.notifyLeave();\n\t\t\tthis.onPointerLeave(pointer);\n\t\t};\n\n\t\tprivate mouseDownHandler = (event:JQuery.MouseDownEvent):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tpointer.notifyTouch();\n\t\t\tthis.onPointerTouch(pointer);\n\t\t};\n\n\t\tprivate mouseUpHandler = (event:JQuery.MouseUpEvent):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tpointer.notifyRelease();\n\t\t\tthis.onPointerRelease(pointer);\n\t\t};\n\n\t\tprivate mouseMoveHandler = (event:JQuery.MouseMoveEvent):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tconst position:number[] = this.getMousePointerPosition(event);\n\t\t\tpointer.notifyMove(position[0], position[1]);\n\t\t\tthis.onPointerMove(pointer);\n\t\t\tif (pointer.isDragging) {\n\t\t\t\tthis.onPointerDrag(pointer);\n\t\t\t}\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Touch Event\n\n\t\tprivate touchStartHandler = (event:JQuery.TouchEventBase):void => {\n\t\t\tconst originalEvent:TouchEvent = event.originalEvent;\n\t\t\tconst touches:TouchList = originalEvent.changedTouches;\n\t\t\tconst touchCount:number = originalEvent.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = new Pointer(id);\n\t\t\t\tthis.pointersById[id] = pointer;\n\t\t\t\tthis.pointerIds.push(id);\n\t\t\t\t++this.pointingCount;\n\t\t\t\tconst position:number[] = this.getTouchPointerPosition(touch);\n\t\t\t\tpointer.notifyEnter(position[0], position[1]);\n\t\t\t\tpointer.notifyTouch();\n\t\t\t\tthis.onPointerEnter(pointer);\n\t\t\t\tthis.onPointerTouch(pointer);\n\t\t\t}\n\t\t};\n\n\t\tprivate touchEndHandler = (event:JQuery.TouchEventBase):void => {\n\t\t\tconst originalEvent:TouchEvent = event.originalEvent;\n\t\t\tconst touches:TouchList = originalEvent.changedTouches;\n\t\t\tconst touchCount:number = originalEvent.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = this.pointersById[id];\n\t\t\t\tdelete this.pointersById[id];\n\t\t\t\tconst pointerIndex = this.pointerIds.indexOf(id);\n\t\t\t\tif (pointerIndex != -1) {\n\t\t\t\t\tthis.pointerIds.splice(pointerIndex, 1);\n\t\t\t\t}\n\t\t\t\t--this.pointingCount;\n\t\t\t\tpointer.notifyRelease();\n\t\t\t\tpointer.notifyLeave();\n\t\t\t\tthis.onPointerRelease(pointer);\n\t\t\t\tthis.onPointerLeave(pointer);\n\t\t\t}\n\t\t};\n\n\t\tprivate touchCancelHandler = (event:JQuery.TouchEventBase):void => {\n\t\t\tthis.touchEndHandler(event);\n\t\t};\n\n\t\tprivate touchMoveHandler = (event:JQuery.TouchEventBase):void => {\n\t\t\tif (!this.isDefaultTouchEventEnabled) {\n\t\t\t\tevent.originalEvent.preventDefault();\n\t\t\t}\n\n\t\t\tconst originalEvent:TouchEvent = event.originalEvent;\n\t\t\tconst touches:TouchList = originalEvent.changedTouches;\n\t\t\tconst touchCount:number = originalEvent.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = this.pointersById[id];\n\t\t\t\tconst position:number[] = this.getTouchPointerPosition(touch);\n\t\t\t\tpointer.notifyMove(position[0], position[1]);\n\t\t\t\tif (pointer.isDragging) {\n\t\t\t\t\tthis.onPointerDrag(pointer);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tprivate touchForceChangeHandler = (event:JQuery.TouchEventBase):void => {\n\t\t\tconst originalEvent:TouchEvent = event.originalEvent;\n\t\t\tconst touches:TouchList = originalEvent.changedTouches;\n\t\t\tconst touchCount:number = originalEvent.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = this.pointersById[id];\n\t\t\t\tif (pointer) {\n\t\t\t\t\tpointer.notifyTouchForce(touch.force);\n\t\t\t\t\tthis.onPointerTouchForceChange(pointer);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Key Event\n\n\t\tprivate keyDownHandler = (event:JQuery.KeyDownEvent):void => {\n\t\t\tthis.onKeyDown(event.key);\n\t\t};\n\n\t\tprivate keyUpHandler = (event:JQuery.KeyUpEvent):void => {\n\t\t\tthis.onKeyUp(event.key);\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Other Event\n\n\t\t//private animationFrameTickerTickHandler = (event:AnimationFrameTickerEvent):void => {\n\t\t//\tthis.update();\n\t\t//};\n\n\t\tprivate requestAnimationFrameHandler = ():void => {\n\t\t\tthis.update();\n\t\t\twindow.requestAnimationFrame(this.requestAnimationFrameHandler);\n\t\t};\n\n\t\tprivate resizeHandler = (event:JQuery.ResizeEvent):void => {\n\t\t\tconst newStageWidth:number = this.canvas.width();\n\t\t\tconst newStageHeight:number = this.canvas.height();\n\t\t\tif (this.stageWidth != newStageWidth || this.stageHeight != newStageHeight) {\n\t\t\t\tthis.resize(newStageWidth, newStageHeight);\n\t\t\t}\n\t\t};\n\n\t\tprivate visibilityStateChangeHandler = (event:JQuery.Event):void => {\n\t\t\tthis.visibilityState = document.visibilityState;\n\t\t\tthis.onVisibilityStateChange(this.visibilityState);\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Util\n\n\t\tprivate getMousePointer(event:JQuery.Event):Pointer {\n\t\t\tlet pointer:Pointer = this.pointersById[this.mousePointerId];\n\t\t\tif (pointer == null) {\n\t\t\t\tpointer = new Pointer(this.mousePointerId);\n\t\t\t\tthis.pointersById[this.mousePointerId] = pointer;\n\t\t\t\tthis.pointerIds.push(this.mousePointerId);\n\t\t\t\t++this.pointingCount;\n\t\t\t\tconst position:number[] = this.getMousePointerPosition(event);\n\t\t\t\tpointer.notifyEnter(position[0], position[1]);\n\t\t\t\tthis.onPointerEnter(pointer);\n\t\t\t}\n\t\t\treturn pointer;\n\t\t}\n\n\t\tprivate getTouchPointerPosition(touch:Touch):number[] {\n\t\t\tconst offset:JQuery.Coordinates = this.getCanvas().offset();\n\t\t\t//trace(touch, touch.clientX, touch.clientY, touch.pageX, touch.pageY, offset.left, offset.top);\n\t\t\treturn [touch.pageX - offset.left, touch.pageY - offset.top];\n\t\t}\n\n\t\tprivate getMousePointerPosition(event:JQuery.Event):number[] {\n\t\t\tconst offset:JQuery.Coordinates = this.getCanvas().offset();\n\t\t\treturn [event.pageX - offset.left, event.pageY - offset.top];\n\t\t}\n\n\t\tpublic static getPointerId(touchId:number):string {\n\t\t\treturn 'touch_' + touchId;\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// VARIABLE\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic getPointerIds():string[] { return this.pointerIds; }\n\t\tprivate pointerIds:string[];\n\n\t\tpublic getFirstPointer():Pointer { return this.pointingCount > 0 ? this.getPointerById(this.pointerIds[0]) : null; }\n\t\tpublic getLastPointer():Pointer { return this.pointingCount > 0 ? this.getPointerById(this.pointerIds[this.pointingCount - 1]) : null; }\n\n\t\tpublic getPointerById(id:string):Pointer { return this.pointersById[id]; }\n\t\tprivate pointersById:alm.util.Hash<Pointer>;\n\n\t\tpublic getPointingCount():number { return this.pointingCount; }\n\t\tprivate pointingCount:number;\n\n\t\tpublic getStageWidth():number { return this.stageWidth; }\n\t\tprivate stageWidth:number;\n\n\t\tpublic getStageHeight():number { return this.stageHeight; }\n\t\tprivate stageHeight:number;\n\n\t\tpublic getElapsedFrameCount():number { return this.elapsedFrameCount; }\n\t\tprivate elapsedFrameCount:number;\n\n\t\tpublic getElapsedTime():number { return this.elapsedTime; }\n\t\tprivate elapsedTime:number;\n\n\t\tpublic getCanvas():JQuery<HTMLCanvasElement> { return this.canvas; }\n\t\tprivate canvas:JQuery<HTMLCanvasElement>;\n\n\t\tpublic getVisibilityState():DocumentVisibilityState { return this.visibilityState; }\n\t\tprivate visibilityState:DocumentVisibilityState;\n\n\t\tpublic getIsAutoResizeEnabled():boolean { return this.isAutoResizeEnabled; }\n\t\tprivate isAutoResizeEnabled:boolean;\n\n\t\tpublic getIsAutoUpdateEnabled():boolean { return this.isAutoUpdateEnabled; }\n\t\tprivate isAutoUpdateEnabled:boolean;\n\n\t\tpublic getIsForceTouchEnabled():boolean { return this.isForceTouchEnabled; }\n\t\tprivate isForceTouchEnabled:boolean;\n\n\t\tpublic getIsTouchEnabled():boolean { return this.isTouchEnabled; }\n\t\tprivate isTouchEnabled:boolean;\n\n\t\tpublic getIsDefaultTouchEventEnabled():boolean { return this.isDefaultTouchEventEnabled; }\n\t\tpublic setIsDefaultTouchEventEnabled(value:boolean):void { this.isDefaultTouchEventEnabled = value; }\n\t\tprivate isDefaultTouchEventEnabled:boolean;\n\n\t\tprivate startTime:number;\n\t\tprivate mousePointerId:string;\n\t\tprivate window:JQuery<Window>;\n\t\tprivate animationFrameTicker:AnimationFrameTicker;\n\t}\n}\n","/// <reference path=\"../../index.ts\" />\n\nnamespace alm.canvas {\n\n\texport class Pointer {\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// CONSTRUCTOR\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tconstructor(id:string) {\n\t\t\tthis.id = id;\n\n\t\t\tthis.isHovering = false;\n\t\t\tthis.isTouching = false;\n\t\t\tthis.isDragging = false;\n\n\t\t\tthis.x = 0;\n\t\t\tthis.y = 0;\n\n\t\t\tthis.prevX = 0;\n\t\t\tthis.prevY = 0;\n\n\t\t\tthis.dragX = 0;\n\t\t\tthis.dragY = 0;\n\n\t\t\tthis.velocityX = 0;\n\t\t\tthis.velocityY = 0;\n\n\t\t\tthis.touchBeginX = 0;\n\t\t\tthis.touchBeginY = 0;\n\n\t\t\tthis.touchForce = 0;\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// METHOD\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic notifyEnter(x:number, y:number):void {\n\t\t\tthis.prevX = this.x = x;\n\t\t\tthis.prevY = this.y = y;\n\t\t\tthis.isHovering = true;\n\t\t}\n\n\t\tpublic notifyLeave():void {\n\t\t\tthis.isHovering = false;\n\t\t}\n\n\t\tpublic notifyTouch():void {\n\t\t\tthis.isTouching = true;\n\t\t\tthis.touchBeginX = this.x;\n\t\t\tthis.touchBeginY = this.y;\n\t\t}\n\n\t\tpublic notifyRelease():void {\n\t\t\tthis.isTouching = false;\n\t\t\tthis.isDragging = false;\n\t\t\tthis.dragX = 0;\n\t\t\tthis.dragY = 0;\n\t\t}\n\n\t\tpublic notifyMove(x:number, y:number):void {\n\t\t\tthis.prevX = this.x;\n\t\t\tthis.prevY = this.y;\n\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\n\t\t\tthis.velocityX = this.x - this.prevX;\n\t\t\tthis.velocityY = this.y - this.prevY;\n\n\t\t\tif (this.isTouching) {\n\t\t\t\tthis.isDragging = true;\n\t\t\t}\n\n\t\t\tif (this.isDragging) {\n\t\t\t\tthis.dragX = this.x - this.touchBeginX;\n\t\t\t\tthis.dragY = this.y - this.touchBeginY;\n\t\t\t}\n\t\t}\n\n\t\tpublic notifyTouchForce(force:number):void {\n\t\t\tthis.touchForce = force;\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// VARIABLE\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic id:string;\n\t\tpublic isHovering:boolean;\n\t\tpublic isTouching:boolean;\n\t\tpublic isDragging:boolean;\n\n\t\tpublic x:number;\n\t\tpublic y:number;\n\n\t\tpublic prevX:number;\n\t\tpublic prevY:number;\n\n\t\tpublic dragX:number;\n\t\tpublic dragY:number;\n\n\t\tpublic velocityX:number;\n\t\tpublic velocityY:number;\n\n\t\tpublic touchBeginX:number;\n\t\tpublic touchBeginY:number;\n\n\t\tpublic touchForce:number;\n\t}\n}\n"]}