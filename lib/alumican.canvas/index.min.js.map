{"version":3,"sources":["../src/alumican.canvas/alm/canvas/Pointer.ts","../src/alumican.canvas/alm/canvas/BaseApp.ts"],"names":["alm","canvas_1","_super","EventDispatcher","DeviceInfo","Time","BaseApp","canvas","isAutoResizeEnabled","isAutoUpdateEnabled","platformSetupOptions","_this","call","this","mouseOverHandler","event","getMousePointer","mouseOutHandler","pointer","pointersById","mousePointerId","pointerIndex","pointerIds","indexOf","splice","pointingCount","notifyLeave","onPointerLeave","mouseDownHandler","notifyTouch","onPointerTouch","mouseUpHandler","notifyRelease","onPointerRelease","mouseMoveHandler","position","getMousePointerPosition","notifyMove","onPointerMove","isDragging","onPointerDrag","touchStartHandler","id","originalEvent","touches","changedTouches","touchCount","length","i","touch","item","getPointerId","identifier","Pointer","push","getTouchPointerPosition","notifyEnter","onPointerEnter","touchEndHandler","touchCancelHandler","touchMoveHandler","isDefaultTouchEventEnabled","preventDefault","touchForceChangeHandler","notifyTouchForce","force","onPointerTouchForceChange","keyDownHandler","onKeyDown","key","keyUpHandler","onKeyUp","requestAnimationFrameHandler","update","window","requestAnimationFrame","resizeHandler","newStageWidth","width","newStageHeight","height","stageWidth","stageHeight","resize","visibilityStateChangeHandler","visibilityState","document","onVisibilityStateChange","jQuery","elapsedFrameCount","startTime","now","isTouchEnabled","getIsTouchEnabled","isForceTouchEnabled","trace","on","onPlatformSetup","onSetup","browser","util","__extends","prototype","onUpdate","onResize","onPlatformRender","onPlatformResize","elapsedTime","offset","getCanvas","pageX","left","pageY","top","touchId","getPointerIds","getFirstPointer","getPointerById","getLastPointer","getPointingCount","getStageWidth","getStageHeight","getElapsedFrameCount","getElapsedTime","getVisibilityState","getIsAutoResizeEnabled","getIsAutoUpdateEnabled","getIsForceTouchEnabled","getIsDefaultTouchEventEnabled","setIsDefaultTouchEventEnabled","value","isHovering","isTouching","x","y","prevX","prevY","dragX","dragY","velocityX","velocityY","touchBeginX","touchBeginY","touchForce"],"mappings":"IAEUA,I,wfCAV,SAAUA,GAAI,IAAAC,EAObC,EALOC,EACAC,EAEAC,EAUN,SAAAC,EAAYC,EAAoBC,EAAoCC,EAAoCC,QAAxE,IAAAF,IAAAA,GAAA,QAAoC,IAAAC,IAAAA,GAAA,QAAoC,IAAAC,IAAAA,EAAA,MAAxG,IAAAC,EACCT,EAAAU,KAAAC,OAAOA,K,OA6IAF,EAAAG,iBAAmB,SAACC,GACHJ,EAAKK,gBAAgBD,IAGtCJ,EAAAM,gBAAkB,SAACF,GAC1B,IAAMG,EAAkBP,EAAKK,gBAAgBD,UACtCJ,EAAKQ,aAAaR,EAAKS,gBACxBC,EAAeV,EAAKW,WAAWC,QAAQZ,EAAKS,iBAC7B,GAAjBC,GACHV,EAAKW,WAAWE,OAAOH,EAAc,KAEpCV,EAAKc,cACPP,EAAQQ,cACRf,EAAKgB,eAAeT,IAGbP,EAAAiB,iBAAmB,SAACb,GACrBG,EAAkBP,EAAKK,gBAAgBD,GAC7CG,EAAQW,cACRlB,EAAKmB,eAAeZ,IAGbP,EAAAoB,eAAiB,SAAChB,GACnBG,EAAkBP,EAAKK,gBAAgBD,GAC7CG,EAAQc,gBACRrB,EAAKsB,iBAAiBf,IAGfP,EAAAuB,iBAAmB,SAACnB,GAC3B,IAAMG,EAAkBP,EAAKK,gBAAgBD,GACvCoB,EAAoBxB,EAAKyB,wBAAwBrB,GACvDG,EAAQmB,WAAWF,EAAS,GAAIA,EAAS,IACzCxB,EAAK2B,cAAcpB,GACfA,EAAQqB,YACX5B,EAAK6B,cAActB,IAObP,EAAA8B,kBAAoB,SAAC1B,GAO5B,IANA,IAII2B,EACAxB,EALEyB,EAA2B5B,EAAM4B,cACjCC,EAAoBD,EAAcE,eAClCC,EAAoBH,EAAcE,eAAeE,OAI9CC,EAAW,EAAGA,EAAIF,IAAcE,EAAG,CAC3CC,EAAQL,EAAQM,KAAKF,GACrBN,EAAKpC,EAAQ6C,aAAaF,EAAMG,YAChClC,EAAU,IAAIjB,EAAAoD,QAAQX,GACtB/B,EAAKQ,aAAauB,GAAMxB,EACxBP,EAAKW,WAAWgC,KAAKZ,KACnB/B,EAAKc,cACP,IAAMU,EAAoBxB,EAAK4C,wBAAwBN,GACvD/B,EAAQsC,YAAYrB,EAAS,GAAIA,EAAS,IAC1CjB,EAAQW,cACRlB,EAAK8C,eAAevC,GACpBP,EAAKmB,eAAeZ,KAIdP,EAAA+C,gBAAkB,SAAC3C,GAO1B,IANA,IAKIG,EALEyB,EAA2B5B,EAAM4B,cACjCC,EAAoBD,EAAcE,eAClCC,EAAoBH,EAAcE,eAAeE,OAI9CC,EAAW,EAAGA,EAAIF,IAAcE,EAAG,CAC3CC,EAAQL,EAAQM,KAAKF,GACrBN,EAAKpC,EAAQ6C,aAAaF,EAAMG,YAChClC,EAAUP,EAAKQ,aAAauB,UACrB/B,EAAKQ,aAAauB,GACzB,IAAMrB,EAAeV,EAAKW,WAAWC,QAAQmB,IACxB,GAAjBrB,GACHV,EAAKW,WAAWE,OAAOH,EAAc,KAEpCV,EAAKc,cACPP,EAAQc,gBACRd,EAAQQ,cACRf,EAAKsB,iBAAiBf,GACtBP,EAAKgB,eAAeT,KAIdP,EAAAgD,mBAAqB,SAAC5C,GAC7BJ,EAAK+C,gBAAgB3C,IAGdJ,EAAAiD,iBAAmB,SAAC7C,GACtBJ,EAAKkD,4BACT9C,EAAM4B,cAAcmB,iBASrB,IANA,IAAMnB,EAA2B5B,EAAM4B,cACjCC,EAAoBD,EAAcE,eAClCC,EAAoBH,EAAcE,eAAeE,OAI9CC,EAAW,EAAGA,EAAIF,IAAcE,EAAG,CAI3C,IAHAC,EAAQL,EAAQM,KAAKF,GACrBN,EAAKpC,EAAQ6C,aAAaF,EAAMG,YAChClC,EAAUP,EAAKQ,aAAauB,GACtBP,EAAoBxB,EAAK4C,wBAAwBN,GACvD/B,EAAQmB,WAAWF,EAAS,GAAIA,EAAS,IACrCjB,EAAQqB,YACX5B,EAAK6B,cAActB,KAKdP,EAAAoD,wBAA0B,SAAChD,GAOlC,IANA,IAGIkC,EAEA/B,EALEyB,EAA2B5B,EAAM4B,cACjCC,EAAoBD,EAAcE,eAClCC,EAAoBH,EAAcE,eAAeE,OAI9CC,EAAW,EAAGA,EAAIF,IAAcE,EACxCC,EAAQL,EAAQM,KAAKF,GACrBN,EAAKpC,EAAQ6C,aAAaF,EAAMG,aAChClC,EAAUP,EAAKQ,aAAauB,MAE3BxB,EAAQ8C,iBAAiBf,EAAMgB,OAC/BtD,EAAKuD,0BAA0BhD,KAQ1BP,EAAAwD,eAAiB,SAACpD,GACzBJ,EAAKyD,UAAUrD,EAAMsD,MAGd1D,EAAA2D,aAAe,SAACvD,GACvBJ,EAAK4D,QAAQxD,EAAMsD,MAUZ1D,EAAA6D,6BAA+B,WACtC7D,EAAK8D,SACLC,OAAOC,sBAAsBhE,EAAK6D,+BAG3B7D,EAAAiE,cAAgB,SAAC7D,GACxB,IAAM8D,EAAuBlE,EAAKJ,OAAOuE,QACnCC,EAAwBpE,EAAKJ,OAAOyE,SACtCrE,EAAKsE,YAAcJ,GAAiBlE,EAAKuE,aAAeH,GAC3DpE,EAAKwE,OAAON,EAAeE,IAIrBpE,EAAAyE,6BAA+B,SAACrE,GACvCJ,EAAK0E,gBAAkBC,SAASD,gBAChC1E,EAAK4E,wBAAwB5E,EAAK0E,kBAhTlC1E,EAAK+D,OAASc,OAAOd,QAErB/D,EAAKJ,OAAoCiF,OAAOjF,GAChDI,EAAKH,oBAAsBA,EAC3BG,EAAKF,oBAAsBA,EAC3BE,EAAKkD,4BAA6B,EAElClD,EAAKW,WAAa,GAClBX,EAAKQ,aAAe,GACpBR,EAAKc,cAAgB,EAErBd,EAAK8E,kBAAoB,EACzB9E,EAAK+E,UAAYrF,EAAKsF,MACtBhF,EAAKS,eAAiB,QACtBT,EAAKiF,eAAiBxF,EAAWyF,oBACjClF,EAAKmF,yBAA8D,IAAjCvF,EAA2B,mBAC7DI,EAAK0E,gBAAkBC,SAASD,gBAEhCU,MAAM,sBAAuBxF,GAC7BwF,MAAM,oCAAqCrF,GAC3CqF,MAAM,mCAAqCpF,EAAKH,qBAChDuF,MAAM,mCAAqCpF,EAAKF,qBAChDsF,MAAM,8BAAgCpF,EAAKiF,gBAC3CG,MAAM,mCAAqCpF,EAAKmF,qBAE5CnF,EAAKiF,gBACRjF,EAAKJ,OAAOyF,GAAG,aAAcrF,EAAK8B,mBAClC9B,EAAKJ,OAAOyF,GAAG,WAAYrF,EAAK+C,iBAChC/C,EAAKJ,OAAOyF,GAAG,cAAerF,EAAKgD,oBACnChD,EAAKJ,OAAOyF,GAAG,YAAarF,EAAKiD,kBAC7BjD,EAAKmF,qBACRnF,EAAKJ,OAAOyF,GAAG,mBAAoBrF,EAAKoD,2BAGzCpD,EAAKJ,OAAOyF,GAAG,YAAarF,EAAKG,kBACjCH,EAAKJ,OAAOyF,GAAG,WAAYrF,EAAKM,iBAChCN,EAAKJ,OAAOyF,GAAG,YAAarF,EAAKiB,kBACjCjB,EAAKJ,OAAOyF,GAAG,UAAWrF,EAAKoB,gBAC/BpB,EAAKJ,OAAOyF,GAAG,YAAarF,EAAKuB,mBAGlCvB,EAAK+D,OAAOsB,GAAG,UAAWrF,EAAKwD,gBAC/BxD,EAAK+D,OAAOsB,GAAG,QAASrF,EAAK2D,cAG7BkB,OAAOF,UAAUU,GAAG,mBAAoBrF,EAAKyE,8BAEzCzE,EAAKF,qBAIRiE,OAAOC,sBAAsBhE,EAAK6D,8BAGnC7D,EAAKsF,gBAAgBvF,GAAwB,IAC7CC,EAAKuF,UAEDvF,EAAKH,sBACRG,EAAK+D,OAAOsB,GAAG,SAAUrF,EAAKiE,eAC9BjE,EAAKiE,cAAc,O,EA7ET3E,EAAAD,EAAAO,SAAAP,EAAAO,OAAM,IAEZJ,EAAkBH,EAAIe,MAAMZ,gBAC5BC,EAAaJ,EAAImG,QAAQ/F,WAEzBC,EAAOL,EAAIoG,KAAK/F,KAEegG,UAAA/F,EAAtCJ,EAAsCC,GAoF9BG,EAAAgG,UAAAJ,QAAP,aAGO5F,EAAAgG,UAAAC,SAAP,aAGOjG,EAAAgG,UAAA7C,eAAP,SAAsBvC,KAGfZ,EAAAgG,UAAA3E,eAAP,SAAsBT,KAGfZ,EAAAgG,UAAAxE,eAAP,SAAsBZ,KAGfZ,EAAAgG,UAAArE,iBAAP,SAAwBf,KAGjBZ,EAAAgG,UAAAhE,cAAP,SAAqBpB,KAGdZ,EAAAgG,UAAA9D,cAAP,SAAqBtB,KAGdZ,EAAAgG,UAAApC,0BAAP,SAAiChD,KAG1BZ,EAAAgG,UAAAlC,UAAP,SAAiBC,KAGV/D,EAAAgG,UAAA/B,QAAP,SAAeF,KAGR/D,EAAAgG,UAAAE,SAAP,SAAgBvB,EAAmBC,KAG5B5E,EAAAgG,UAAAf,wBAAP,SAA+BF,KAGrB/E,EAAAgG,UAAAL,gBAAV,SAA0BvF,KAGhBJ,EAAAgG,UAAAG,iBAAV,aAGUnG,EAAAgG,UAAAI,iBAAV,SAA2BzB,EAAmBC,KAGvC5E,EAAAgG,UAAA7B,OAAP,aACG5D,KAAK4E,kBACP5E,KAAK8F,aAAetG,EAAKsF,MAAQ9E,KAAK6E,WAAa,IACnD7E,KAAK0F,WACL1F,KAAK4F,oBAGCnG,EAAAgG,UAAAnB,OAAP,SAAcL,EAAcE,GAC3BnE,KAAKoE,WAAaH,EAClBjE,KAAKqE,YAAcF,EACnBe,MAAM,8BAAgClF,KAAKoE,WAAa,cAAgBpE,KAAKqE,aAC7ErE,KAAK6F,iBAAiB7F,KAAKoE,WAAYpE,KAAKqE,aAC5CrE,KAAK2F,SAAS3F,KAAKoE,WAAYpE,KAAKqE,cAiL7B5E,EAAAgG,UAAAtF,gBAAR,SAAwBD,GACvB,IAAIG,EAAkBL,KAAKM,aAAaN,KAAKO,gBAU7C,OATe,MAAXF,IACHA,EAAU,IAAIjB,EAAAoD,QAAQxC,KAAKO,gBAC3BP,KAAKM,aAAaN,KAAKO,gBAAkBF,EACzCL,KAAKS,WAAWgC,KAAKzC,KAAKO,kBACxBP,KAAKY,cACDU,EAAoBtB,KAAKuB,wBAAwBrB,GACvDG,EAAQsC,YAAYrB,EAAS,GAAIA,EAAS,IAC1CtB,KAAK4C,eAAevC,IAEdA,GAGAZ,EAAAgG,UAAA/C,wBAAR,SAAgCN,GAC/B,IAAM2D,EAA4B/F,KAAKgG,YAAYD,SAEnD,MAAO,CAAC3D,EAAM6D,MAAQF,EAAOG,KAAM9D,EAAM+D,MAAQJ,EAAOK,MAGjD3G,EAAAgG,UAAAlE,wBAAR,SAAgCrB,GAC/B,IAAM6F,EAA4B/F,KAAKgG,YAAYD,SACnD,MAAO,CAAC7F,EAAM+F,MAAQF,EAAOG,KAAMhG,EAAMiG,MAAQJ,EAAOK,MAG3C3G,EAAA6C,aAAd,SAA2B+D,GAC1B,MAAO,SAAWA,GAaZ5G,EAAAgG,UAAAa,cAAP,WAAkC,OAAOtG,KAAKS,YAGvChB,EAAAgG,UAAAc,gBAAP,WAAmC,OAA4B,EAArBvG,KAAKY,cAAoBZ,KAAKwG,eAAexG,KAAKS,WAAW,IAAM,MACtGhB,EAAAgG,UAAAgB,eAAP,WAAkC,OAA4B,EAArBzG,KAAKY,cAAoBZ,KAAKwG,eAAexG,KAAKS,WAAWT,KAAKY,cAAgB,IAAM,MAE1HnB,EAAAgG,UAAAe,eAAP,SAAsB3E,GAAqB,OAAO7B,KAAKM,aAAauB,IAG7DpC,EAAAgG,UAAAiB,iBAAP,WAAmC,OAAO1G,KAAKY,eAGxCnB,EAAAgG,UAAAkB,cAAP,WAAgC,OAAO3G,KAAKoE,YAGrC3E,EAAAgG,UAAAmB,eAAP,WAAiC,OAAO5G,KAAKqE,aAGtC5E,EAAAgG,UAAAoB,qBAAP,WAAuC,OAAO7G,KAAK4E,mBAG5CnF,EAAAgG,UAAAqB,eAAP,WAAiC,OAAO9G,KAAK8F,aAGtCrG,EAAAgG,UAAAO,UAAP,WAA+C,OAAOhG,KAAKN,QAGpDD,EAAAgG,UAAAsB,mBAAP,WAA8C,OAAO/G,KAAKwE,iBAGnD/E,EAAAgG,UAAAuB,uBAAP,WAA0C,OAAOhH,KAAKL,qBAG/CF,EAAAgG,UAAAwB,uBAAP,WAA0C,OAAOjH,KAAKJ,qBAG/CH,EAAAgG,UAAAyB,uBAAP,WAA0C,OAAOlH,KAAKiF,qBAG/CxF,EAAAgG,UAAAT,kBAAP,WAAqC,OAAOhF,KAAK+E,gBAG1CtF,EAAAgG,UAAA0B,8BAAP,WAAiD,OAAOnH,KAAKgD,4BACtDvD,EAAAgG,UAAA2B,8BAAP,SAAqCC,GAAsBrH,KAAKgD,2BAA6BqE,GAnZ9F5H,EA0ZAA,EA1ZsBL,EAAAK,QAAOA,EAP9B,CAAUN,IAAAA,KAAG,IDAb,SAAUA,GAUR,SAAAqD,EAAYX,GACX7B,KAAK6B,GAAKA,EAEV7B,KAAKsH,YAAa,EAClBtH,KAAKuH,YAAa,EAClBvH,KAAK0B,YAAa,EAElB1B,KAAKwH,EAAI,EACTxH,KAAKyH,EAAI,EAETzH,KAAK0H,MAAQ,EACb1H,KAAK2H,MAAQ,EAEb3H,KAAK4H,MAAQ,EACb5H,KAAK6H,MAAQ,EAEb7H,KAAK8H,UAAY,EACjB9H,KAAK+H,UAAY,EAEjB/H,KAAKgI,YAAc,EACnBhI,KAAKiI,YAAc,EAEnBjI,KAAKkI,WAAa,EAhCPxI,EAAAP,EAAAO,SAAAP,EAAAO,OAAM,IA6CX8C,EAAAiD,UAAA9C,YAAP,SAAmB6E,EAAUC,GAC5BzH,KAAK0H,MAAQ1H,KAAKwH,EAAIA,EACtBxH,KAAK2H,MAAQ3H,KAAKyH,EAAIA,EACtBzH,KAAKsH,YAAa,GAGZ9E,EAAAiD,UAAA5E,YAAP,WACCb,KAAKsH,YAAa,GAGZ9E,EAAAiD,UAAAzE,YAAP,WACChB,KAAKuH,YAAa,EAClBvH,KAAKgI,YAAchI,KAAKwH,EACxBxH,KAAKiI,YAAcjI,KAAKyH,GAGlBjF,EAAAiD,UAAAtE,cAAP,WACCnB,KAAKuH,YAAa,EAClBvH,KAAK0B,YAAa,EAClB1B,KAAK4H,MAAQ,EACb5H,KAAK6H,MAAQ,GAGPrF,EAAAiD,UAAAjE,WAAP,SAAkBgG,EAAUC,GAC3BzH,KAAK0H,MAAQ1H,KAAKwH,EAClBxH,KAAK2H,MAAQ3H,KAAKyH,EAElBzH,KAAKwH,EAAIA,EACTxH,KAAKyH,EAAIA,EAETzH,KAAK8H,UAAY9H,KAAKwH,EAAIxH,KAAK0H,MAC/B1H,KAAK+H,UAAY/H,KAAKyH,EAAIzH,KAAK2H,MAE3B3H,KAAKuH,aACRvH,KAAK0B,YAAa,GAGf1B,KAAK0B,aACR1B,KAAK4H,MAAQ5H,KAAKwH,EAAIxH,KAAKgI,YAC3BhI,KAAK6H,MAAQ7H,KAAKyH,EAAIzH,KAAKiI,cAItBzF,EAAAiD,UAAAtC,iBAAP,SAAwBC,GACvBpD,KAAKkI,WAAa9E,GAvFP1D,EAAA8C,QAyHbA,EA3HD,CAAUrD,IAAAA,KAAG","file":"index.min.js","sourcesContent":["/// <reference path=\"../../index.ts\" />\n\nnamespace alm.canvas {\n\n\texport class Pointer {\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// CONSTRUCTOR\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tconstructor(id:string) {\n\t\t\tthis.id = id;\n\n\t\t\tthis.isHovering = false;\n\t\t\tthis.isTouching = false;\n\t\t\tthis.isDragging = false;\n\n\t\t\tthis.x = 0;\n\t\t\tthis.y = 0;\n\n\t\t\tthis.prevX = 0;\n\t\t\tthis.prevY = 0;\n\n\t\t\tthis.dragX = 0;\n\t\t\tthis.dragY = 0;\n\n\t\t\tthis.velocityX = 0;\n\t\t\tthis.velocityY = 0;\n\n\t\t\tthis.touchBeginX = 0;\n\t\t\tthis.touchBeginY = 0;\n\n\t\t\tthis.touchForce = 0;\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// METHOD\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic notifyEnter(x:number, y:number):void {\n\t\t\tthis.prevX = this.x = x;\n\t\t\tthis.prevY = this.y = y;\n\t\t\tthis.isHovering = true;\n\t\t}\n\n\t\tpublic notifyLeave():void {\n\t\t\tthis.isHovering = false;\n\t\t}\n\n\t\tpublic notifyTouch():void {\n\t\t\tthis.isTouching = true;\n\t\t\tthis.touchBeginX = this.x;\n\t\t\tthis.touchBeginY = this.y;\n\t\t}\n\n\t\tpublic notifyRelease():void {\n\t\t\tthis.isTouching = false;\n\t\t\tthis.isDragging = false;\n\t\t\tthis.dragX = 0;\n\t\t\tthis.dragY = 0;\n\t\t}\n\n\t\tpublic notifyMove(x:number, y:number):void {\n\t\t\tthis.prevX = this.x;\n\t\t\tthis.prevY = this.y;\n\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\n\t\t\tthis.velocityX = this.x - this.prevX;\n\t\t\tthis.velocityY = this.y - this.prevY;\n\n\t\t\tif (this.isTouching) {\n\t\t\t\tthis.isDragging = true;\n\t\t\t}\n\n\t\t\tif (this.isDragging) {\n\t\t\t\tthis.dragX = this.x - this.touchBeginX;\n\t\t\t\tthis.dragY = this.y - this.touchBeginY;\n\t\t\t}\n\t\t}\n\n\t\tpublic notifyTouchForce(force:number):void {\n\t\t\tthis.touchForce = force;\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// VARIABLE\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic id:string;\n\t\tpublic isHovering:boolean;\n\t\tpublic isTouching:boolean;\n\t\tpublic isDragging:boolean;\n\n\t\tpublic x:number;\n\t\tpublic y:number;\n\n\t\tpublic prevX:number;\n\t\tpublic prevY:number;\n\n\t\tpublic dragX:number;\n\t\tpublic dragY:number;\n\n\t\tpublic velocityX:number;\n\t\tpublic velocityY:number;\n\n\t\tpublic touchBeginX:number;\n\t\tpublic touchBeginY:number;\n\n\t\tpublic touchForce:number;\n\t}\n}\n","/// <reference path=\"../../index.ts\" />\n\nnamespace alm.canvas {\n\n\timport EventDispatcher = alm.event.EventDispatcher;\n\timport DeviceInfo = alm.browser.DeviceInfo;\n\timport AnimationFrameTicker = alm.time.AnimationFrameTicker;\n\timport Time = alm.util.Time;\n\n\texport abstract class BaseApp extends EventDispatcher {\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// CONSTRUCTOR\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tconstructor(canvas:HTMLElement, isAutoResizeEnabled:boolean = true, isAutoUpdateEnabled:boolean = true, platformSetupOptions:any[] = null) {\n\t\t\tsuper();\n\n\t\t\tthis.window = jQuery(window);\n\n\t\t\tthis.canvas = <JQuery<HTMLCanvasElement>>jQuery(canvas);\n\t\t\tthis.isAutoResizeEnabled = isAutoResizeEnabled;\n\t\t\tthis.isAutoUpdateEnabled = isAutoUpdateEnabled;\n\t\t\tthis.isDefaultTouchEventEnabled = false;\n\n\t\t\tthis.pointerIds = [];\n\t\t\tthis.pointersById = {};\n\t\t\tthis.pointingCount = 0;\n\n\t\t\tthis.elapsedFrameCount = 0;\n\t\t\tthis.startTime = Time.now();\n\t\t\tthis.mousePointerId = 'mouse';\n\t\t\tthis.isTouchEnabled = DeviceInfo.getIsTouchEnabled();\n\t\t\tthis.isForceTouchEnabled = typeof canvas['ontouchforcechange'] !== 'undefined';\n\t\t\tthis.visibilityState = document.visibilityState;\n\n\t\t\ttrace(\"[BaseApp] canvas : \", canvas);\n\t\t\ttrace(\"[BaseApp] platformSetupOptions : \", platformSetupOptions);\n\t\t\ttrace(\"[BaseApp] isAutoResizeEnabled : \" + this.isAutoResizeEnabled);\n\t\t\ttrace(\"[BaseApp] isAutoUpdateEnabled : \" + this.isAutoUpdateEnabled);\n\t\t\ttrace(\"[BaseApp] isTouchEnabled : \" + this.isTouchEnabled);\n\t\t\ttrace(\"[BaseApp] isForceTouchEnabled : \" + this.isForceTouchEnabled);\n\n\t\t\tif (this.isTouchEnabled) {\n\t\t\t\tthis.canvas.on('touchstart', this.touchStartHandler);\n\t\t\t\tthis.canvas.on('touchend', this.touchEndHandler);\n\t\t\t\tthis.canvas.on('touchcancel', this.touchCancelHandler);\n\t\t\t\tthis.canvas.on('touchmove', this.touchMoveHandler);\n\t\t\t\tif (this.isForceTouchEnabled) {\n\t\t\t\t\tthis.canvas.on('touchforcechange', this.touchForceChangeHandler);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.canvas.on('mouseover', this.mouseOverHandler);\n\t\t\t\tthis.canvas.on('mouseout', this.mouseOutHandler);\n\t\t\t\tthis.canvas.on('mousedown', this.mouseDownHandler);\n\t\t\t\tthis.canvas.on('mouseup', this.mouseUpHandler);\n\t\t\t\tthis.canvas.on('mousemove', this.mouseMoveHandler);\n\t\t\t}\n\n\t\t\tthis.window.on('keydown', this.keyDownHandler);\n\t\t\tthis.window.on('keyup', this.keyUpHandler);\n\t\t\t//this.canvas.attr('tabindex', 1);\n\n\t\t\tjQuery(document).on('visibilitychange', this.visibilityStateChangeHandler);\n\n\t\t\tif (this.isAutoUpdateEnabled) {\n\t\t\t\t//this.animationFrameTicker = new AnimationFrameTicker();\n\t\t\t\t//this.animationFrameTicker.addEventListener(AnimationFrameTickerEvent.TICK, this.animationFrameTickerTickHandler);\n\t\t\t\t//this.animationFrameTicker.start();\n\t\t\t\twindow.requestAnimationFrame(this.requestAnimationFrameHandler);\n\t\t\t}\n\n\t\t\tthis.onPlatformSetup(platformSetupOptions || []);\n\t\t\tthis.onSetup();\n\n\t\t\tif (this.isAutoResizeEnabled) {\n\t\t\t\tthis.window.on('resize', this.resizeHandler);\n\t\t\t\tthis.resizeHandler(null);\n\t\t\t}\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// METHOD\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic onSetup():void {\n\t\t}\n\n\t\tpublic onUpdate():void {\n\t\t}\n\n\t\tpublic onPointerEnter(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerLeave(pointer:Pointer,):void {\n\t\t}\n\n\t\tpublic onPointerTouch(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerRelease(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerMove(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerDrag(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onPointerTouchForceChange(pointer:Pointer):void {\n\t\t}\n\n\t\tpublic onKeyDown(key:string):void {\n\t\t}\n\n\t\tpublic onKeyUp(key:string):void {\n\t\t}\n\n\t\tpublic onResize(stageWidth:number, stageHeight:number):void {\n\t\t}\n\n\t\tpublic onVisibilityStateChange(visibilityState:VisibilityState):void {\n\t\t}\n\n\t\tprotected onPlatformSetup(platformSetupOptions:any[]):void {\n\t\t}\n\n\t\tprotected onPlatformRender():void {\n\t\t}\n\n\t\tprotected onPlatformResize(stageWidth:number, stageHeight:number):void {\n\t\t}\n\n\t\tpublic update():void {\n\t\t\t++this.elapsedFrameCount;\n\t\t\tthis.elapsedTime = (Time.now() - this.startTime) / 1000;\n\t\t\tthis.onUpdate();\n\t\t\tthis.onPlatformRender();\n\t\t}\n\n\t\tpublic resize(width:number, height:number):void {\n\t\t\tthis.stageWidth = width;\n\t\t\tthis.stageHeight = height;\n\t\t\ttrace('[BaseApp] resize : width = ' + this.stageWidth + ', height = ' + this.stageHeight);\n\t\t\tthis.onPlatformResize(this.stageWidth, this.stageHeight);\n\t\t\tthis.onResize(this.stageWidth, this.stageHeight);\n\t\t}\n\n\t\t// --------------------------------------------------\n\t\t// Mouse Event\n\n\t\tprivate mouseOverHandler = (event:JQuery.MouseOverEvent):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t};\n\n\t\tprivate mouseOutHandler = (event:JQuery.MouseOutEvent):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tdelete this.pointersById[this.mousePointerId];\n\t\t\tconst pointerIndex = this.pointerIds.indexOf(this.mousePointerId);\n\t\t\tif (pointerIndex != -1) {\n\t\t\t\tthis.pointerIds.splice(pointerIndex, 1);\n\t\t\t}\n\t\t\t--this.pointingCount;\n\t\t\tpointer.notifyLeave();\n\t\t\tthis.onPointerLeave(pointer);\n\t\t};\n\n\t\tprivate mouseDownHandler = (event:JQuery.MouseDownEvent):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tpointer.notifyTouch();\n\t\t\tthis.onPointerTouch(pointer);\n\t\t};\n\n\t\tprivate mouseUpHandler = (event:JQuery.MouseUpEvent):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tpointer.notifyRelease();\n\t\t\tthis.onPointerRelease(pointer);\n\t\t};\n\n\t\tprivate mouseMoveHandler = (event:JQuery.MouseMoveEvent):void => {\n\t\t\tconst pointer:Pointer = this.getMousePointer(event);\n\t\t\tconst position:number[] = this.getMousePointerPosition(event);\n\t\t\tpointer.notifyMove(position[0], position[1]);\n\t\t\tthis.onPointerMove(pointer);\n\t\t\tif (pointer.isDragging) {\n\t\t\t\tthis.onPointerDrag(pointer);\n\t\t\t}\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Touch Event\n\n\t\tprivate touchStartHandler = (event:JQuery.TouchEventBase):void => {\n\t\t\tconst originalEvent:TouchEvent = event.originalEvent;\n\t\t\tconst touches:TouchList = originalEvent.changedTouches;\n\t\t\tconst touchCount:number = originalEvent.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = new Pointer(id);\n\t\t\t\tthis.pointersById[id] = pointer;\n\t\t\t\tthis.pointerIds.push(id);\n\t\t\t\t++this.pointingCount;\n\t\t\t\tconst position:number[] = this.getTouchPointerPosition(touch);\n\t\t\t\tpointer.notifyEnter(position[0], position[1]);\n\t\t\t\tpointer.notifyTouch();\n\t\t\t\tthis.onPointerEnter(pointer);\n\t\t\t\tthis.onPointerTouch(pointer);\n\t\t\t}\n\t\t};\n\n\t\tprivate touchEndHandler = (event:JQuery.TouchEventBase):void => {\n\t\t\tconst originalEvent:TouchEvent = event.originalEvent;\n\t\t\tconst touches:TouchList = originalEvent.changedTouches;\n\t\t\tconst touchCount:number = originalEvent.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = this.pointersById[id];\n\t\t\t\tdelete this.pointersById[id];\n\t\t\t\tconst pointerIndex = this.pointerIds.indexOf(id);\n\t\t\t\tif (pointerIndex != -1) {\n\t\t\t\t\tthis.pointerIds.splice(pointerIndex, 1);\n\t\t\t\t}\n\t\t\t\t--this.pointingCount;\n\t\t\t\tpointer.notifyRelease();\n\t\t\t\tpointer.notifyLeave();\n\t\t\t\tthis.onPointerRelease(pointer);\n\t\t\t\tthis.onPointerLeave(pointer);\n\t\t\t}\n\t\t};\n\n\t\tprivate touchCancelHandler = (event:JQuery.TouchEventBase):void => {\n\t\t\tthis.touchEndHandler(event);\n\t\t};\n\n\t\tprivate touchMoveHandler = (event:JQuery.TouchEventBase):void => {\n\t\t\tif (!this.isDefaultTouchEventEnabled) {\n\t\t\t\tevent.originalEvent.preventDefault();\n\t\t\t}\n\n\t\t\tconst originalEvent:TouchEvent = event.originalEvent;\n\t\t\tconst touches:TouchList = originalEvent.changedTouches;\n\t\t\tconst touchCount:number = originalEvent.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = this.pointersById[id];\n\t\t\t\tconst position:number[] = this.getTouchPointerPosition(touch);\n\t\t\t\tpointer.notifyMove(position[0], position[1]);\n\t\t\t\tif (pointer.isDragging) {\n\t\t\t\t\tthis.onPointerDrag(pointer);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tprivate touchForceChangeHandler = (event:JQuery.TouchEventBase):void => {\n\t\t\tconst originalEvent:TouchEvent = event.originalEvent;\n\t\t\tconst touches:TouchList = originalEvent.changedTouches;\n\t\t\tconst touchCount:number = originalEvent.changedTouches.length;\n\t\t\tlet touch:Touch;\n\t\t\tlet id:string;\n\t\t\tlet pointer:Pointer;\n\t\t\tfor (let i:number = 0; i < touchCount; ++i) {\n\t\t\t\ttouch = touches.item(i);\n\t\t\t\tid = BaseApp.getPointerId(touch.identifier);\n\t\t\t\tpointer = this.pointersById[id];\n\t\t\t\tif (pointer) {\n\t\t\t\t\tpointer.notifyTouchForce(touch.force);\n\t\t\t\t\tthis.onPointerTouchForceChange(pointer);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Key Event\n\n\t\tprivate keyDownHandler = (event:JQuery.KeyDownEvent):void => {\n\t\t\tthis.onKeyDown(event.key);\n\t\t};\n\n\t\tprivate keyUpHandler = (event:JQuery.KeyUpEvent):void => {\n\t\t\tthis.onKeyUp(event.key);\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Other Event\n\n\t\t//private animationFrameTickerTickHandler = (event:AnimationFrameTickerEvent):void => {\n\t\t//\tthis.update();\n\t\t//};\n\n\t\tprivate requestAnimationFrameHandler = ():void => {\n\t\t\tthis.update();\n\t\t\twindow.requestAnimationFrame(this.requestAnimationFrameHandler);\n\t\t};\n\n\t\tprivate resizeHandler = (event:JQuery.ResizeEvent):void => {\n\t\t\tconst newStageWidth:number = this.canvas.width();\n\t\t\tconst newStageHeight:number = this.canvas.height();\n\t\t\tif (this.stageWidth != newStageWidth || this.stageHeight != newStageHeight) {\n\t\t\t\tthis.resize(newStageWidth, newStageHeight);\n\t\t\t}\n\t\t};\n\n\t\tprivate visibilityStateChangeHandler = (event:JQuery.Event):void => {\n\t\t\tthis.visibilityState = document.visibilityState;\n\t\t\tthis.onVisibilityStateChange(this.visibilityState);\n\t\t};\n\n\t\t// --------------------------------------------------\n\t\t// Util\n\n\t\tprivate getMousePointer(event:JQuery.Event):Pointer {\n\t\t\tlet pointer:Pointer = this.pointersById[this.mousePointerId];\n\t\t\tif (pointer == null) {\n\t\t\t\tpointer = new Pointer(this.mousePointerId);\n\t\t\t\tthis.pointersById[this.mousePointerId] = pointer;\n\t\t\t\tthis.pointerIds.push(this.mousePointerId);\n\t\t\t\t++this.pointingCount;\n\t\t\t\tconst position:number[] = this.getMousePointerPosition(event);\n\t\t\t\tpointer.notifyEnter(position[0], position[1]);\n\t\t\t\tthis.onPointerEnter(pointer);\n\t\t\t}\n\t\t\treturn pointer;\n\t\t}\n\n\t\tprivate getTouchPointerPosition(touch:Touch):number[] {\n\t\t\tconst offset:JQuery.Coordinates = this.getCanvas().offset();\n\t\t\t//trace(touch, touch.clientX, touch.clientY, touch.pageX, touch.pageY, offset.left, offset.top);\n\t\t\treturn [touch.pageX - offset.left, touch.pageY - offset.top];\n\t\t}\n\n\t\tprivate getMousePointerPosition(event:JQuery.Event):number[] {\n\t\t\tconst offset:JQuery.Coordinates = this.getCanvas().offset();\n\t\t\treturn [event.pageX - offset.left, event.pageY - offset.top];\n\t\t}\n\n\t\tpublic static getPointerId(touchId:number):string {\n\t\t\treturn 'touch_' + touchId;\n\t\t}\n\n\n\n\n\n\t\t// --------------------------------------------------\n\t\t//\n\t\t// VARIABLE\n\t\t//\n\t\t// --------------------------------------------------\n\n\t\tpublic getPointerIds():string[] { return this.pointerIds; }\n\t\tprivate pointerIds:string[];\n\n\t\tpublic getFirstPointer():Pointer { return this.pointingCount > 0 ? this.getPointerById(this.pointerIds[0]) : null; }\n\t\tpublic getLastPointer():Pointer { return this.pointingCount > 0 ? this.getPointerById(this.pointerIds[this.pointingCount - 1]) : null; }\n\n\t\tpublic getPointerById(id:string):Pointer { return this.pointersById[id]; }\n\t\tprivate pointersById:alm.util.Hash<Pointer>;\n\n\t\tpublic getPointingCount():number { return this.pointingCount; }\n\t\tprivate pointingCount:number;\n\n\t\tpublic getStageWidth():number { return this.stageWidth; }\n\t\tprivate stageWidth:number;\n\n\t\tpublic getStageHeight():number { return this.stageHeight; }\n\t\tprivate stageHeight:number;\n\n\t\tpublic getElapsedFrameCount():number { return this.elapsedFrameCount; }\n\t\tprivate elapsedFrameCount:number;\n\n\t\tpublic getElapsedTime():number { return this.elapsedTime; }\n\t\tprivate elapsedTime:number;\n\n\t\tpublic getCanvas():JQuery<HTMLCanvasElement> { return this.canvas; }\n\t\tprivate canvas:JQuery<HTMLCanvasElement>;\n\n\t\tpublic getVisibilityState():VisibilityState { return this.visibilityState; }\n\t\tprivate visibilityState:VisibilityState;\n\n\t\tpublic getIsAutoResizeEnabled():boolean { return this.isAutoResizeEnabled; }\n\t\tprivate isAutoResizeEnabled:boolean;\n\n\t\tpublic getIsAutoUpdateEnabled():boolean { return this.isAutoUpdateEnabled; }\n\t\tprivate isAutoUpdateEnabled:boolean;\n\n\t\tpublic getIsForceTouchEnabled():boolean { return this.isForceTouchEnabled; }\n\t\tprivate isForceTouchEnabled:boolean;\n\n\t\tpublic getIsTouchEnabled():boolean { return this.isTouchEnabled; }\n\t\tprivate isTouchEnabled:boolean;\n\n\t\tpublic getIsDefaultTouchEventEnabled():boolean { return this.isDefaultTouchEventEnabled; }\n\t\tpublic setIsDefaultTouchEventEnabled(value:boolean):void { this.isDefaultTouchEventEnabled = value; }\n\t\tprivate isDefaultTouchEventEnabled:boolean;\n\n\t\tprivate startTime:number;\n\t\tprivate mousePointerId:string;\n\t\tprivate window:JQuery<Window>;\n\t\tprivate animationFrameTicker:AnimationFrameTicker;\n\t}\n}\n"]}