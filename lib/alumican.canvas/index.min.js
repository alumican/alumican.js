var alm;!function(t){{var h=t.canvas||(t.canvas={}),e=t.event.EventDispatcher,n=t.browser.DeviceInfo,o=t.util.Time;class a extends e{constructor(t,e=!0,i=!0,s=null){super(),this.mouseOverHandler=t=>{this.getMousePointer(t)},this.mouseOutHandler=t=>{const e=this.getMousePointer(t);delete this.pointersById[this.mousePointerId];t=this.pointerIds.indexOf(this.mousePointerId);-1!=t&&this.pointerIds.splice(t,1),--this.pointingCount,e.notifyLeave(),this.onPointerLeave(e)},this.mouseDownHandler=t=>{const e=this.getMousePointer(t);e.notifyTouch(),this.onPointerTouch(e)},this.mouseUpHandler=t=>{const e=this.getMousePointer(t);e.notifyRelease(),this.onPointerRelease(e)},this.mouseMoveHandler=t=>{const e=this.getMousePointer(t);t=this.getMousePointerPosition(t);e.notifyMove(t[0],t[1]),this.onPointerMove(e),e.isDragging&&this.onPointerDrag(e)},this.touchStartHandler=t=>{t=t.originalEvent;const e=t.changedTouches;var i,s=t.changedTouches.length;let n;for(let t=0;t<s;++t){i=e.item(t),o=a.getPointerId(i.identifier),n=new h.Pointer(o),this.pointersById[o]=n,this.pointerIds.push(o),++this.pointingCount;var o=this.getTouchPointerPosition(i);n.notifyEnter(o[0],o[1]),n.notifyTouch(),this.onPointerEnter(n),this.onPointerTouch(n)}},this.touchEndHandler=t=>{t=t.originalEvent;const e=t.changedTouches;var i=t.changedTouches.length;let s;for(let t=0;t<i;++t){n=e.item(t),n=a.getPointerId(n.identifier),s=this.pointersById[n],delete this.pointersById[n];var n=this.pointerIds.indexOf(n);-1!=n&&this.pointerIds.splice(n,1),--this.pointingCount,s.notifyRelease(),s.notifyLeave(),this.onPointerRelease(s),this.onPointerLeave(s)}},this.touchCancelHandler=t=>{this.touchEndHandler(t)},this.touchMoveHandler=t=>{this.isDefaultTouchEventEnabled||t.originalEvent.preventDefault();t=t.originalEvent;const e=t.changedTouches;var i,s=t.changedTouches.length;let n;for(let t=0;t<s;++t){i=e.item(t),o=a.getPointerId(i.identifier),n=this.pointersById[o];var o=this.getTouchPointerPosition(i);n.notifyMove(o[0],o[1]),n.isDragging&&this.onPointerDrag(n)}},this.touchForceChangeHandler=t=>{t=t.originalEvent;const e=t.changedTouches;var i,s,n=t.changedTouches.length;let o;for(let t=0;t<n;++t)i=e.item(t),s=a.getPointerId(i.identifier),(o=this.pointersById[s])&&(o.notifyTouchForce(i.force),this.onPointerTouchForceChange(o))},this.keyDownHandler=t=>{this.onKeyDown(t.key)},this.keyUpHandler=t=>{this.onKeyUp(t.key)},this.requestAnimationFrameHandler=()=>{this.update(),window.requestAnimationFrame(this.requestAnimationFrameHandler)},this.resizeHandler=t=>{var e=this.canvas.width(),i=this.canvas.height();this.stageWidth==e&&this.stageHeight==i||this.resize(e,i)},this.visibilityStateChangeHandler=t=>{this.visibilityState=document.visibilityState,this.onVisibilityStateChange(this.visibilityState)},this.window=jQuery(window),this.canvas=jQuery(t),this.isAutoResizeEnabled=e,this.isAutoUpdateEnabled=i,this.isDefaultTouchEventEnabled=!1,this.pointerIds=[],this.pointersById={},this.pointingCount=0,this.elapsedFrameCount=0,this.startTime=o.now(),this.mousePointerId="mouse",this.isTouchEnabled=n.getIsTouchEnabled(),this.isForceTouchEnabled=void 0!==t.ontouchforcechange,this.visibilityState=document.visibilityState,trace("[BaseApp] canvas : ",t),trace("[BaseApp] platformSetupOptions : ",s),trace("[BaseApp] isAutoResizeEnabled : "+this.isAutoResizeEnabled),trace("[BaseApp] isAutoUpdateEnabled : "+this.isAutoUpdateEnabled),trace("[BaseApp] isTouchEnabled : "+this.isTouchEnabled),trace("[BaseApp] isForceTouchEnabled : "+this.isForceTouchEnabled),this.isTouchEnabled?(this.canvas.on("touchstart",this.touchStartHandler),this.canvas.on("touchend",this.touchEndHandler),this.canvas.on("touchcancel",this.touchCancelHandler),this.canvas.on("touchmove",this.touchMoveHandler),this.isForceTouchEnabled&&this.canvas.on("touchforcechange",this.touchForceChangeHandler)):(this.canvas.on("mouseover",this.mouseOverHandler),this.canvas.on("mouseout",this.mouseOutHandler),this.canvas.on("mousedown",this.mouseDownHandler),this.canvas.on("mouseup",this.mouseUpHandler),this.canvas.on("mousemove",this.mouseMoveHandler)),this.window.on("keydown",this.keyDownHandler),this.window.on("keyup",this.keyUpHandler),jQuery(document).on("visibilitychange",this.visibilityStateChangeHandler),this.isAutoUpdateEnabled&&window.requestAnimationFrame(this.requestAnimationFrameHandler),this.onPlatformSetup(s||[]),this.onSetup(),this.isAutoResizeEnabled&&(this.window.on("resize",this.resizeHandler),this.resizeHandler(null))}onSetup(){}onUpdate(){}onPointerEnter(t){}onPointerLeave(t){}onPointerTouch(t){}onPointerRelease(t){}onPointerMove(t){}onPointerDrag(t){}onPointerTouchForceChange(t){}onKeyDown(t){}onKeyUp(t){}onResize(t,e){}onVisibilityStateChange(t){}onPlatformSetup(t){}onPlatformRender(){}onPlatformResize(t,e){}update(){++this.elapsedFrameCount,this.elapsedTime=(o.now()-this.startTime)/1e3,this.onUpdate(),this.onPlatformRender()}resize(t,e){this.stageWidth=t,this.stageHeight=e,trace("[BaseApp] resize : width = "+this.stageWidth+", height = "+this.stageHeight),this.onPlatformResize(this.stageWidth,this.stageHeight),this.onResize(this.stageWidth,this.stageHeight)}getMousePointer(t){let e=this.pointersById[this.mousePointerId];return null==e&&(e=new h.Pointer(this.mousePointerId),this.pointersById[this.mousePointerId]=e,this.pointerIds.push(this.mousePointerId),++this.pointingCount,t=this.getMousePointerPosition(t),e.notifyEnter(t[0],t[1]),this.onPointerEnter(e)),e}getTouchPointerPosition(t){var e=this.getCanvas().offset();return[t.pageX-e.left,t.pageY-e.top]}getMousePointerPosition(t){var e=this.getCanvas().offset();return[t.pageX-e.left,t.pageY-e.top]}static getPointerId(t){return"touch_"+t}getPointerIds(){return this.pointerIds}getFirstPointer(){return 0<this.pointingCount?this.getPointerById(this.pointerIds[0]):null}getLastPointer(){return 0<this.pointingCount?this.getPointerById(this.pointerIds[this.pointingCount-1]):null}getPointerById(t){return this.pointersById[t]}getPointingCount(){return this.pointingCount}getStageWidth(){return this.stageWidth}getStageHeight(){return this.stageHeight}getElapsedFrameCount(){return this.elapsedFrameCount}getElapsedTime(){return this.elapsedTime}getCanvas(){return this.canvas}getVisibilityState(){return this.visibilityState}getIsAutoResizeEnabled(){return this.isAutoResizeEnabled}getIsAutoUpdateEnabled(){return this.isAutoUpdateEnabled}getIsForceTouchEnabled(){return this.isForceTouchEnabled}getIsTouchEnabled(){return this.isTouchEnabled}getIsDefaultTouchEventEnabled(){return this.isDefaultTouchEventEnabled}setIsDefaultTouchEventEnabled(t){this.isDefaultTouchEventEnabled=t}}h.BaseApp=a}}(alm=alm||{}),function(t){(t.canvas||(t.canvas={})).Pointer=class{constructor(t){this.id=t,this.isHovering=!1,this.isTouching=!1,this.isDragging=!1,this.x=0,this.y=0,this.prevX=0,this.prevY=0,this.dragX=0,this.dragY=0,this.velocityX=0,this.velocityY=0,this.touchBeginX=0,this.touchBeginY=0,this.touchForce=0}notifyEnter(t,e){this.prevX=this.x=t,this.prevY=this.y=e,this.isHovering=!0}notifyLeave(){this.isHovering=!1}notifyTouch(){this.isTouching=!0,this.touchBeginX=this.x,this.touchBeginY=this.y}notifyRelease(){this.isTouching=!1,this.isDragging=!1,this.dragX=0,this.dragY=0}notifyMove(t,e){this.prevX=this.x,this.prevY=this.y,this.x=t,this.y=e,this.velocityX=this.x-this.prevX,this.velocityY=this.y-this.prevY,this.isTouching&&(this.isDragging=!0),this.isDragging&&(this.dragX=this.x-this.touchBeginX,this.dragY=this.y-this.touchBeginY)}notifyTouchForce(t){this.touchForce=t}}}(alm=alm||{});
//# sourceMappingURL=index.min.js.map
