var alm;!function(i){{var t=i.video||(i.video={}),s=i.util.Cmd,d=i.math.Easing,i=i.event.EventDispatcher;class e extends i{constructor(i){super(),this.volume=this.defaultVolume=i,this.isInitializing=!0}setup(){this.isShowing=!0,this.isPlaying=!1,this.opacity=1,this.view=document.createElement("div"),this.view.classList.add("video-clip"),this.implSetup(this.view,this.volume),this.hide(0,0),this.isInitializing=!1}start(i){this.isPlaying||(this.isPlaying=!0,this.show(i))}stop(i,t){this.isPlaying&&(this.isPlaying=!1,this.hide(i,t))}rewind(){this.implRewind(this.view)}restart(){this.isPlaying?(this.implRewind(this.view),this.implStart(this.view)):this.start(0)}dispose(){this.displayTween=s.stop(this.displayTween),this.implDispose(this.view),this.view&&(this.view.remove(),this.view=null)}show(i){if(!this.isShowing){this.isShowing=!0;const t=this.getView();this.displayTween&&(this.displayTween=s.stop(this.displayTween)),0<i?(this.displayTween=new cmd.Tween(this,{opacity:1},null,i,d.easeOutQuad,()=>{t.style.display="block",this.implStart(this.view)},()=>{t.style.opacity=this.opacity.toString(),this.applyVolume()},()=>{this.displayTween=null}),this.displayTween.execute()):(t.style.display="block",this.implStart(this.view),this.opacity=1,t.style.opacity=this.opacity.toString(),this.applyVolume())}}hide(i,t){if(this.isShowing){this.isShowing=!1;const e=this.getView();this.displayTween&&(this.displayTween=s.stop(this.displayTween)),0<i?(i=new cmd.Tween(this,{opacity:0},null,i,d.easeOutQuad,null,()=>{e.style.opacity=this.opacity.toString(),this.applyVolume()},()=>{e.style.display="none",this.displayTween=null,this.isInitializing||this.implStop(this.view)}),this.displayTween=0<t?new cmd.Serial(new cmd.Wait(t),i):i,this.displayTween.execute()):(this.opacity=0,e.style.opacity=this.opacity.toString(),this.applyVolume(),e.style.display="none",this.isInitializing||this.implStop(this.view))}}applyVolume(){0<this.defaultVolume&&(this.volume=this.defaultVolume*this.opacity,this.implUpdateVolume(this.volume))}dispatchVideoEvent(i){this.dispatchEvent(new t.VideoClipEvent(i,this))}getView(){return this.view}getIsPlaying(){return this.isPlaying}getDefaultVolume(){return this.defaultVolume}getVolume(){return this.volume}getOpacity(){return this.opacity}implSetup(i,t){}implStart(i){}implStop(i){}implRewind(i){}implDispose(i){}implUpdateVolume(i){}}t.VideoClip=e}}(alm=alm||{}),function(i){{var t=i.video||(i.video={});class e extends i.event.Event{constructor(i,t){super(i,t)}}e.complete="VideoClipEvent.complete",t.VideoClipEvent=e}}(alm=alm||{}),function(i){{var t=i.video||(i.video={});class e extends t.VideoClip{constructor(i,t){super(t),this.videoCanplaythroughHandler=i=>{this.isReady||(this.isReady=!0)},this.videoTimeupdateHandler=i=>{this.update()},this.videoEndedHandler=i=>{},this.timerHandler=()=>{this.update()},this.url=i,this.intervalId=-1,this.setup()}implSetup(i,t){this.isReady=!1,this.video=document.createElement("video"),this.video.setAttribute("muted","muted"),this.video.classList.add("video-media"),this.video.playsInline=!0,this.video.controls=!1,this.video.autoplay=!1,this.video.preload="auto",this.video.loop=!1,this.video.volume=t,this.video.muted=0===t,this.video.src=this.url,this.video.addEventListener("canplaythrough",this.videoCanplaythroughHandler),this.video.addEventListener("ended",this.videoEndedHandler),this.video.load(),this.getView().appendChild(this.video)}implStart(i){this.video.paused&&this.video.play(),this.startTimer()}implStop(i){this.video.paused||this.video.pause(),this.video.currentTime=0,this.stopTimer()}implRewind(i){this.video.currentTime=0}implDispose(i){i.removeChild(this.video),this.video.pause(),this.video.removeAttribute("src"),this.video.load(),this.video=null,this.stopTimer()}implUpdateVolume(i){this.video.volume=i}update(){this.video.currentTime>=this.video.duration&&(this.video.paused||this.video.pause(),this.stopTimer(),this.dispatchVideoEvent(t.VideoClipEvent.complete))}startTimer(){-1===this.intervalId&&(this.intervalId=window.setInterval(this.timerHandler,1e3/60))}stopTimer(){-1!==this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=-1)}}t.SimpleVideoClip=e}}(alm=alm||{}),function(i){{var t=i.video||(i.video={});class e extends t.VideoClip{constructor(i,t,e,s){super(t),this.videoCanplaythroughHandler=i=>{this.isReady||(this.isReady=!0)},this.videoTimeupdateHandler=i=>{this.update()},this.videoEndedHandler=i=>{},this.timerHandler=()=>{this.update()},this.url=i,this.loopStartPosition=e,this.loopEndPosition=s,this.intervalId=-1,this.setup()}implSetup(i,t){this.isReady=!1,this.phase=0,this.video=document.createElement("video"),this.video.classList.add("video-media"),this.video.playsInline=!0,this.video.controls=!1,this.video.autoplay=!1,this.video.preload="auto",this.video.loop=!1,this.video.volume=t,this.video.muted=0===t,this.video.src=this.url,this.video.addEventListener("canplaythrough",this.videoCanplaythroughHandler),this.video.addEventListener("ended",this.videoEndedHandler),this.video.load(),this.getView().appendChild(this.video)}implStart(i){this.phase=0,this.video.currentTime=0,this.video.paused&&this.video.play(),this.startTimer()}implStop(i){this.phase=2,this.video.currentTime=this.loopEndPosition}implRewind(i){this.phase=0,this.video.currentTime=0}implUpdateVolume(i){this.video.volume=i}implDispose(i){i.removeChild(this.video),this.video.pause(),this.video.removeAttribute("src"),this.video.load(),this.video=null,this.stopTimer()}update(){var i=this.video.currentTime;0===this.phase&&i>=this.loopStartPosition&&(this.phase=1),1===this.phase&&i>=this.loopEndPosition&&(this.video.currentTime=this.loopStartPosition,this.video.paused&&this.video.play()),2===this.phase&&i>=this.video.duration&&(this.phase=3,this.video.currentTime=this.video.duration,this.video.paused||this.video.pause(),this.stopTimer(),this.dispatchVideoEvent(t.VideoClipEvent.complete))}startTimer(){-1===this.intervalId&&(this.intervalId=window.setInterval(this.timerHandler,1e3/60))}stopTimer(){-1!==this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=-1)}}t.LoopPointVideoClip=e}}(alm=alm||{}),function(i){{var t=i.video||(i.video={});class e extends t.VideoClip{constructor(i,t){super(0),this.imageLoadHandler=i=>{this.isReady||(this.isReady=!0)},this.url=i,this.duration=t,this.timerId=-1,this.setup()}implSetup(i,t){this.isReady=!1,this.image=new Image,this.image.addEventListener("load",this.imageLoadHandler),this.image.classList.add("video-media"),this.image.src=this.url,this.getView().appendChild(this.image)}implStart(i){this.startTimer()}implStop(i){this.stopTimer()}implRewind(i){this.stopTimer(),this.startTimer()}implDispose(i){this.stopTimer(),i.removeChild(this.image),this.image.removeEventListener("load",this.imageLoadHandler),this.image.remove(),this.image.src="",this.image=null}implUpdateVolume(i){}startTimer(){-1===this.timerId&&0<this.duration&&(this.timerId=window.setTimeout(()=>{this.timerId=-1,this.dispatchVideoEvent(t.VideoClipEvent.complete)},this.duration))}stopTimer(){-1!==this.timerId&&(window.clearTimeout(this.timerId),this.timerId=-1)}}t.StaticImageClip=e}}(alm=alm||{}),function(i){{var l=i.video||(i.video={});i=i.event.EventDispatcher;class t extends i{constructor(i=null,t="video-player"){super(),this.clipCompleteHandler=i=>{this.isLoop?this.switchClip(this.currentClipId,!0,!0,!1):this.dispatchEvent(new l.VideoPlayerEvent(l.VideoPlayerEvent.complete,this,this.currentClipId,this.clipIndicesById[this.currentClipId]))},this.container=i||document.createElement("div"),""!==t&&this.container.classList.add(t),this.clips=[],this.clipsById={},this.clipIndicesById={},this.clipIdsByIndex={},this.clipCount=0,this.isPlaying=!1,this.isLoop=!1,this.isCrossOverEnabled=!0,this.crossFadeDuration=500,this.currentClipId="",this.oldClipId=""}load(i,t=1,e=""){return this.loadInternal(i,e,()=>new l.SimpleVideoClip(i,t))}loadWithLoopPoint(i,t,e,s=1,d=""){return this.loadInternal(i,d,()=>new l.LoopPointVideoClip(i,s,t,e))}loadImage(i,t=0,e=""){return this.loadInternal(i,e,()=>new l.StaticImageClip(i,t))}loadInternal(i,t,e){if(this.clipsById[t=""===t?i:t])return-1;console.debug("[VideoPlayer] load :",i);const s=e();s.addEventListener(l.VideoClipEvent.complete,this.clipCompleteHandler),this.container.appendChild(s.getView());i=this.clipCount;return this.clips.push(s),this.clipsById[t]=s,this.clipIndicesById[t]=i,this.clipIdsByIndex[i]=t,++this.clipCount,i}unload(i){if(!this.clipsById[i])return!1;this.currentClipId===i&&this.stop();const t=this.clipsById[i];t.removeEventListener(l.VideoClipEvent.complete,this.clipCompleteHandler),t.dispose(),this.container.removeChild(t.getView()),delete this.clipsById[i],this.clips[this.clipIndicesById[i]]=null}playById(i,t=!1,e=!1,s=!0){this.switchClip(i,t,e,s)}playByIndex(i,t=!1,e=!1,s=!0){this.switchClip(this.clipIdsByIndex[i],t,e,s)}stop(i=!0){this.switchClip("",!1,!1,i)}dispose(){this.switchClip("",!1,!1,!1);for(let i=0;i<this.clipCount;++i){const t=this.clips[i];t&&t.dispose()}this.clips=null,this.clipsById=null,this.clipIndicesById=null,this.clipIdsByIndex=null,this.container=null}switchClip(i,t,e,s){if((i=this.clipsById[i]?i:"")===this.currentClipId){if(t&&""!==this.currentClipId){console.debug("[VideoPlayer] rewind :",this.currentClipId);const d=this.clipsById[this.currentClipId];this.isLoop=e,d.restart()}}else{if(this.oldClipId=this.currentClipId,this.currentClipId=i,console.debug("[VideoPlayer] switch :",this.oldClipId,"->",this.currentClipId),""!==this.oldClipId){const l=this.clipsById[this.oldClipId];l.stop(s?this.crossFadeDuration:0,s&&!this.isCrossOverEnabled&&""!==this.currentClipId?this.crossFadeDuration:0)}if(""!==this.currentClipId){const o=this.clipsById[this.currentClipId];this.isPlaying=!0,this.isLoop=e,o.start(s?this.crossFadeDuration:0)}else this.isPlaying=!1}}getContainer(){return this.container}setIsCrossOverEnabled(i){this.isCrossOverEnabled=i}getIsCrossOverEnabled(){return this.isCrossOverEnabled}setCrossFadeDuration(i){this.crossFadeDuration=i}getCrossFadeDuration(){return this.crossFadeDuration}getIsPlaying(){return this.isPlaying}getIsLoop(){return this.isLoop}getClipCount(){return this.clipCount}getCurrentClipId(){return this.currentClipId}getOldClipId(){return this.oldClipId}getCurrentClipIndex(){return this.clipIndicesById[this.currentClipId]}getOldClipIndex(){return this.clipIndicesById[this.oldClipId]}}l.VideoPlayer=t}}(alm=alm||{}),function(i){{var t=i.video||(i.video={});class e extends i.event.Event{constructor(i,t,e,s){super(i,t),this.clipId=e,this.clipIndex=s}}e.complete="VideoPlayerEvent.complete",t.VideoPlayerEvent=e}}(alm=alm||{});
//# sourceMappingURL=index.min.js.map
