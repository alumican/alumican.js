var alm;!function(t){var i,s,a;i=t.audio||(t.audio={}),s=t.util.Cmd,a=t.math.Easing,i.AudioClip=class{constructor(t,i,e="",s=1){this.context=t,this.masterVolume=s,this.buffer=null,this.sourceNode=null,this.isAvailable=!1,this.duration=0,this.gainNode=this.context.createGain(),this.gainNode.connect(i),this.volume=1,this.applyVolume(),""!=e&&this.load(e)}load(i){const t=new XMLHttpRequest;t.responseType="arraybuffer",t.onreadystatechange=()=>{4!=t.readyState||0!=t.status&&200!=t.status||this.context.decodeAudioData(t.response,t=>{trace("[AudioClip] load complete :",i),this.isAvailable=!0,this.buffer=t,this.duration=this.buffer.duration},t=>{trace("[AudioClip] load error :",t),trace(t)})},t.open("GET",i,!0),t.send("")}play(t=!1,i=!0){!this.isAvailable||!i&&this.sourceNode||(this.stop(),this.sourceNode=this.context.createBufferSource(),this.sourceNode.buffer=this.buffer,this.sourceNode.loop=t,this.sourceNode.connect(this.gainNode),this.sourceNode.start(0))}stop(){this.sourceNode&&(this.sourceNode.stop(),this.sourceNode.disconnect(this.gainNode),this.sourceNode=null)}getVolume(){return this.volume}setVolume(t){s.stop(this.volumeTween),this.volume!=t&&(this.volume=t,this.applyVolume())}fadeTo(t,i=1e3,e=null){s.stop(this.volumeTween),this.volumeTween=new cmd.Tween(this,{volume:t},null,i,a.linear,null,()=>{this.applyVolume()},()=>{e&&e()}),this.volumeTween.execute()}fadeIn(t=1e3){this.fadeTo(1,t)}fadeOut(t=1e3,i=!0){this.fadeTo(0,t,()=>{i&&this.stop()})}applyVolume(){this.gainNode.gain.value=this.volume*this.masterVolume}getIsAvailable(){return this.isAvailable}getDuration(){return this.duration}getCurrentTime(){return this.context.currentTime}}}(alm=alm||{}),function(t){{var s=t.audio||(t.audio={});t=t.event.EventDispatcher;class i extends t{constructor(){super();const t=window.AudioContext||window.webkitAudioContext||null;this.isAvailable=null!=t,this.isAvailable&&(this.context=new t,this.clipsById={},this.masterGainNode=this.context.createGain(),this.masterGainNode.connect(this.context.destination),this.masterVolume=1)}add(t,i=1,e=""){return!!this.isAvailable&&(!this.clipsById[e=""==e?t:e]&&(this.clipsById[e]=new s.AudioClip(this.context,this.masterGainNode,t,i),!0))}getClip(t){if(this.isAvailable)return this.clipsById[t]}getMasterVolume(){return this.isAvailable?this.masterVolume:0}setMasterVolume(t){this.isAvailable&&(this.masterVolume=t,this.masterGainNode.gain.value=this.masterVolume)}static getInstance(){return i.instance||(i.instance=new i)}}i.instance=null,s.AudioPlayer=i}}(alm=alm||{}),function(t){var i;(i=t.audio||(t.audio={})).CrossOverLoopAudio=class{constructor(t=1){this.timerHandler=()=>{++this.clipIndex==this.clipCount&&(this.clipIndex=0),this.playCurrent()},this.audioPlayer=i.AudioPlayer.getInstance(),this.clipCount=0,this.clipIndex=0,this.clipIds=[],this.clip=null,this.isPlaying=!1,this.volume=1,this.crossOverDuration=t,this.timeoutId=-1}add(t,i=1){var e=t+"-"+this.clipCount;this.audioPlayer.add(t,i,e),this.clipIds.push(e),this.clipCount=this.clipIds.length}play(){this.isPlaying||(this.isPlaying=!0,this.playCurrent())}stop(){this.isPlaying&&(this.isPlaying=!1,this.stopCurrent())}setVolume(t){this.volume=t,this.clip&&this.clip.setVolume(this.volume)}playCurrent(){this.clip=this.audioPlayer.getClip(this.clipIds[this.clipIndex]),this.clip.setVolume(this.volume),this.clip.play(!1,!0);var t=1e3*(this.clip.getDuration()-this.crossOverDuration);this.timeoutId=window.setTimeout(this.timerHandler,t)}stopCurrent(){-1!=this.timeoutId&&(window.clearTimeout(this.timeoutId),this.timeoutId=-1),this.clip&&(this.clip.stop(),this.clip=null)}}}(alm=alm||{}),function(t){var e,i,s;e=t.audio||(t.audio={}),i=t.util.Num,s=t.math.Easing,e.FootstepAudio=class{constructor(t=.12,i=.6){this.timerHandler=()=>{var t=this.isWaitingForFirstStep?.5*this.interval:this.interval,i=(new Date).getTime();i-this.startTime>=1e3*t&&(this.startTime=i,this.isWaitingForFirstStep=!1,++this.clipIndex>=this.clipCount&&(this.clipIndex=0),t=this.clipIds[this.clipIndex],this.audioPlayer.getClip(t).setVolume(this.volume),this.audioPlayer.getClip(t).play(!1,!0))},this.audioPlayer=e.AudioPlayer.getInstance(),this.intervalMin=t,this.intervalMax=i,this.intervalId=-1,this.interval=this.intervalMax,this.clipIndex=-1,this.clipCount=0,this.clipIds=[],this.isPlaying=!1,this.volume=1}add(t,i=1){var e=t+"-"+this.clipCount;this.audioPlayer.add(t,i,e),this.clipIds.push(e),this.clipCount=this.clipIds.length}play(t=!0){this.isPlaying||(this.isPlaying=!0,this.isWaitingForFirstStep=!0,this.startTime=t?0:(new Date).getTime(),this.intervalId=window.setInterval(this.timerHandler,1e3/60),this.timerHandler())}stop(){this.isPlaying&&(this.isPlaying=!1,window.clearInterval(this.intervalId))}setSpeed(t){this.interval=i.ease(t,0,1,this.intervalMax,this.intervalMin,s.easeOutSine)}setVolume(t){this.volume=t}}}(alm=alm||{});
//# sourceMappingURL=index.min.js.map
