function trace(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];alm.util.Logger.info.apply(trace.caller,arguments)}function throwWarn(t,e,n){void 0===n&&(n=!0),alm.util.Logger.warnIf.apply(null,arguments)}function throwError(t,e,n){void 0===n&&(n=!0),alm.util.Logger.errorIf.apply(null,arguments)}var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(t){!function(t){var e=function(){function t(){}return t.linear=function(t,e,n,i,o){return i*e/o+n},t.easeInQuad=function(t,e,n,i,o){return i*(e/=o)*e+n},t.easeOutQuad=function(t,e,n,i,o){return-i*(e/=o)*(e-2)+n},t.easeInOutQuad=function(t,e,n,i,o){return(e/=o/2)<1?i/2*e*e+n:-i/2*(--e*(e-2)-1)+n},t.easeInCubic=function(t,e,n,i,o){return i*(e/=o)*e*e+n},t.easeOutCubic=function(t,e,n,i,o){return i*((e=e/o-1)*e*e+1)+n},t.easeInOutCubic=function(t,e,n,i,o){return(e/=o/2)<1?i/2*e*e*e+n:i/2*((e-=2)*e*e+2)+n},t.easeInQuart=function(t,e,n,i,o){return i*(e/=o)*e*e*e+n},t.easeOutQuart=function(t,e,n,i,o){return-i*((e=e/o-1)*e*e*e-1)+n},t.easeInOutQuart=function(t,e,n,i,o){return(e/=o/2)<1?i/2*e*e*e*e+n:-i/2*((e-=2)*e*e*e-2)+n},t.easeInQuint=function(t,e,n,i,o){return i*(e/=o)*e*e*e*e+n},t.easeOutQuint=function(t,e,n,i,o){return i*((e=e/o-1)*e*e*e*e+1)+n},t.easeInOutQuint=function(t,e,n,i,o){return(e/=o/2)<1?i/2*e*e*e*e*e+n:i/2*((e-=2)*e*e*e*e+2)+n},t.easeInSine=function(t,e,n,i,o){return-i*Math.cos(e/o*(Math.PI/2))+i+n},t.easeOutSine=function(t,e,n,i,o){return i*Math.sin(e/o*(Math.PI/2))+n},t.easeInOutSine=function(t,e,n,i,o){return-i/2*(Math.cos(Math.PI*e/o)-1)+n},t.easeInExpo=function(t,e,n,i,o){return 0==e?n:i*Math.pow(2,10*(e/o-1))+n},t.easeOutExpo=function(t,e,n,i,o){return e==o?n+i:i*(1-Math.pow(2,-10*e/o))+n},t.easeInOutExpo=function(t,e,n,i,o){return 0==e?n:e==o?n+i:(e/=o/2)<1?i/2*Math.pow(2,10*(e-1))+n:i/2*(2-Math.pow(2,-10*--e))+n},t.easeInCirc=function(t,e,n,i,o){return-i*(Math.sqrt(1-(e/=o)*e)-1)+n},t.easeOutCirc=function(t,e,n,i,o){return i*Math.sqrt(1-(e=e/o-1)*e)+n},t.easeInOutCirc=function(t,e,n,i,o){return(e/=o/2)<1?-i/2*(Math.sqrt(1-e*e)-1)+n:i/2*(Math.sqrt(1-(e-=2)*e)+1)+n},t.createEaseInElastic=function(t){return void 0===t&&(t=1.70158),function(e,n,i,o,r){var s=0,a=o;return 0==n?i:1==(n/=r)?i+o:(0==s&&(s=.3*r),a<Math.abs(o)?(a=o,t=s/4):t=s/(2*Math.PI)*Math.asin(o/a),-a*Math.pow(2,10*(n-=1))*Math.sin((n*r-t)*(2*Math.PI)/s)+i)}},t.createEaseOutElastic=function(t){return void 0===t&&(t=1.70158),function(e,n,i,o,r){var s=0,a=o;return 0==n?i:1==(n/=r)?i+o:(0==s&&(s=.3*r),a<Math.abs(o)?(a=o,t=s/4):t=s/(2*Math.PI)*Math.asin(o/a),a*Math.pow(2,-10*n)*Math.sin((n*r-t)*(2*Math.PI)/s)+o+i)}},t.createEaseInOutElastic=function(t){return void 0===t&&(t=1.70158),function(e,n,i,o,r){var s=0,a=o;return 0==n?i:2==(n/=r/2)?i+o:(0==s&&(s=r*(.3*1.5)),a<Math.abs(o)?(a=o,t=s/4):t=s/(2*Math.PI)*Math.asin(o/a),n<1?a*Math.pow(2,10*(n-=1))*Math.sin((n*r-t)*(2*Math.PI)/s)*-.5+i:a*Math.pow(2,-10*(n-=1))*Math.sin((n*r-t)*(2*Math.PI)/s)*.5+o+i)}},t.easeInElastic=function(e,n,i,o,r){return t.defaultEaseInElastic(e,n,i,o,r)},t.easeOutElastic=function(e,n,i,o,r){return t.defaultEaseOutElastic(e,n,i,o,r)},t.easeInOutElastic=function(e,n,i,o,r){return t.defaultEaseInOutElastic(e,n,i,o,r)},t.createEaseInBack=function(t){return void 0===t&&(t=1.70158),function(e,n,i,o,r){return o*(n/=r)*n*((t+1)*n-t)+i}},t.createEaseOutBack=function(t){return void 0===t&&(t=1.70158),function(e,n,i,o,r){return o*((n=n/r-1)*n*((t+1)*n+t)+1)+i}},t.createEaseInOutBack=function(t){return void 0===t&&(t=1.70158),function(e,n,i,o,r){return(n/=r/2)<1?o/2*(n*n*((1+(t*=1.525))*n-t))+i:o/2*((n-=2)*n*((1+(t*=1.525))*n+t)+2)+i}},t.easeInBack=function(e,n,i,o,r){return t.defaultEaseInElastic(e,n,i,o,r)},t.easeOutBack=function(e,n,i,o,r){return t.defaultEaseOutBack(e,n,i,o,r)},t.easeInOutBack=function(e,n,i,o,r){return t.defaultEaseInOutBack(e,n,i,o,r)},t.easeInBounce=function(e,n,i,o,r){return o-t.easeOutBounce(e,r-n,0,o,r)+i},t.easeOutBounce=function(t,e,n,i,o){return(e/=o)<1/2.75?i*(7.5625*e*e)+n:e<2/2.75?i*(7.5625*(e-=1.5/2.75)*e+.75)+n:e<2.5/2.75?i*(7.5625*(e-=2.25/2.75)*e+.9375)+n:i*(7.5625*(e-=2.625/2.75)*e+.984375)+n},t.easeInOutBounce=function(e,n,i,o,r){return n<r/2?.5*t.easeInBounce(e,2*n,0,o,r)+i:.5*t.easeOutBounce(e,2*n-r,0,o,r)+.5*o+i},t.defaultEaseInElastic=t.createEaseInElastic(),t.defaultEaseOutElastic=t.createEaseOutElastic(),t.defaultEaseInOutElastic=t.createEaseInOutElastic(),t.defaultEaseInBack=t.createEaseInBack(),t.defaultEaseOutBack=t.createEaseOutBack(),t.defaultEaseInOutBack=t.createEaseInOutBack(),t}();t.Easing=e}(t.util||(t.util={}))}(alm||(alm={}));!function(t){!function(t){var e=function(){function t(t,e,n){void 0===n&&(n=null),this.type=t,this.target=e,this.data=n}return t.prototype.getType=function(){return this.type},t.prototype.getTarget=function(){return this.target},t.prototype.getData=function(){return this.data},t.prototype.setData=function(t){this.data=t},t}();t.Event=e}(t.event||(t.event={}))}(alm||(alm={}));!function(t){!function(t){var e=function(){function e(t){void 0===t&&(t=null),this.target=t||this,this.listeners={}}return e.prototype.addEventListener=function(t,e){if("function"==typeof e){var n=this.listeners[t];if(n){for(var i=n.length,o=0;o<i;++o)if(e==n[o])return}else this.listeners[t]=n=[];n.push(e)}},e.prototype.removeEventListener=function(t,e){if("function"==typeof e){var n=this.listeners[t];if(n){for(var i=n.length,o=0;o<i;++o)if(e==n[o]){n.splice(o,1);break}0==n.length&&delete this.listeners[t]}}},e.prototype.removeAllEventListener=function(t){void 0===t&&(t=null),t?delete this.listeners[t]:this.listeners={}},e.prototype.hasEventListener=function(t){return null!=this.listeners[t]},e.prototype.dispatchEvent=function(t){var e=this.listeners[t.getType()];if(e)for(var n=e.length,i=0;i<n;++i)e[i].call(this.target,t)},e.prototype.dispatchEventType=function(e,n,i){void 0===n&&(n=null),void 0===i&&(i=null),this.dispatchEvent(new t.Event(e,n,i))},e}();t.EventDispatcher=e}(t.event||(t.event={}))}(alm||(alm={}));!function(t){!function(t){t[t.Sleeping=0]="Sleeping",t[t.Executing=1]="Executing",t[t.Interrupting=2]="Interrupting"}(t.CommandState||(t.CommandState={}))}(cmd||(cmd={}));!function(t){var e=function(t){function e(e,n){return void 0===n&&(n=null),t.call(this,e,n)||this}return __extends(e,t),e.prototype.clone=function(){return new e(this.getType(),this.getTarget())},e.prototype.toString=function(){return"[CommandEvent] type = "+this.getType()},e.COMPLETE="complete",e}(alm.event.Event);t.CommandEvent=e}(cmd||(cmd={}));!function(t){var e=function(e){function n(n,i,o){void 0===n&&(n=null),void 0===i&&(i=null),void 0===o&&(o=null);var r=e.call(this)||this;return r.setExecuteFunction(n),r.setInterruptFunction(i),r.setDestroyFunction(o),r.state=t.CommandState.Sleeping,r.self=r,r.parent=null,r}return __extends(n,e),n.prototype.execute=function(){if(this.state>t.CommandState.Sleeping)throw new Error("[Command.execute] + Command is already executing.");this.state=t.CommandState.Executing,this.getExecuteFunction().call(this,this)},n.prototype.interrupt=function(){this.state==t.CommandState.Executing&&(this.state=t.CommandState.Interrupting,this.getInterruptFunction().call(this,this))},n.prototype.destroy=function(){this.state=t.CommandState.Sleeping,this.getDestroyFunction().call(this,this),this.parent=null,this.executeFunction=null,this.interruptFunction=null,this.destroyFunction=null},n.prototype.notifyComplete=function(){switch(this.state){case t.CommandState.Sleeping:break;case t.CommandState.Executing:case t.CommandState.Interrupting:this.dispatchEvent(new t.CommandEvent(t.CommandEvent.COMPLETE,this)),this.destroy()}},n.prototype.implExecuteFunction=function(t){this.notifyComplete()},n.prototype.implInterruptFunction=function(t){},n.prototype.implDestroyFunction=function(t){},n.prototype.getExecuteFunction=function(){return this.executeFunction||this.implExecuteFunction},n.prototype.setExecuteFunction=function(t){this.executeFunction=t},n.prototype.getInterruptFunction=function(){return this.interruptFunction||this.implInterruptFunction},n.prototype.setInterruptFunction=function(t){this.interruptFunction=t},n.prototype.getDestroyFunction=function(){return this.destroyFunction||this.implDestroyFunction},n.prototype.setDestroyFunction=function(t){this.destroyFunction=t},n.prototype.getState=function(){return this.state},n.prototype.getParent=function(){return this.parent},n.prototype.setParent=function(t){this.parent=t},n.prototype.getSelf=function(){return this.self},n}(alm.event.EventDispatcher);t.Command=e}(cmd||(cmd={}));!function(t){var e=function(e){function n(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=e.call(this)||this;return i.commands=[],i.addCommand.apply(i,t),i}return __extends(n,e),n.prototype.addCommand=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.length>0&&(this.preProcess(t),this.commands=this.getCommands().concat(t))},n.prototype.insertCommand=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.insertCommandAt.apply(this,[0].concat(t))},n.prototype.insertCommandAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];e.length>0&&(this.preProcess(e),Array.prototype.splice.apply(this.getCommands(),[t,0].concat(e)))},n.prototype.addCommandArray=function(t){this.addCommand.apply(this,t)},n.prototype.insertCommandArray=function(t){this.insertCommand.apply(this,t)},n.prototype.insertCommandArrayAt=function(t,e){this.insertCommandAt.apply(this,[t].concat(e))},n.prototype.getLength=function(){return this.commands.length},n.prototype.getCommandByIndex=function(t){return this.commands[t]},n.prototype.getCommands=function(){return this.commands},n.prototype.preProcess=function(e){for(var n,i=e.length,o=0;o<i;++o)"function"==typeof(n=e[o])&&(e[o]=n=new t.Func(n)),n.setParent(this)},n.prototype.implExecuteFunction=function(t){this.notifyComplete()},n.prototype.implInterruptFunction=function(t){},n.prototype.implDestroyFunction=function(t){},n}(t.Command);t.CommandList=e}(cmd||(cmd={}));!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.implExecuteFunction=function(t){var e=this.getParent().notifyBreak;e&&e(),this.notifyComplete()},e.prototype.implInterruptFunction=function(t){},e.prototype.implDestroyFunction=function(t){},e}(t.Command);t.Break=e}(cmd||(cmd={}));!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.implExecuteFunction=function(t){var e=this.getParent().notifyReturn;e&&e(),this.notifyComplete()},e.prototype.implInterruptFunction=function(t){},e.prototype.implDestroyFunction=function(t){},e}(t.Command);t.Return=e}(cmd||(cmd={}));!function(t){var e=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=t.call(this)||this;return i.messages=e,i}return __extends(e,t),e.prototype.implExecuteFunction=function(t){console.log.apply(console,Array.prototype.slice.call(this.messages)),this.notifyComplete()},e.prototype.implInterruptFunction=function(t){},e.prototype.implDestroyFunction=function(t){this.messages=null},e.prototype.getMessages=function(){return this.messages},e.prototype.setMessages=function(t){this.messages=t},e}(t.Command);t.Log=e}(cmd||(cmd={}));!function(t){var e=function(t){function e(e){void 0===e&&(e=1e3);var n=t.call(this)||this;return n.completeHandler=function(t){n.notifyComplete()},n.time=e,n.timerId=-1,n}return __extends(e,t),e.prototype.implExecuteFunction=function(t){this.timerId=window.setTimeout(this.completeHandler,this.time)},e.prototype.implInterruptFunction=function(t){this.cancel()},e.prototype.implDestroyFunction=function(t){this.cancel()},e.prototype.cancel=function(){-1!=this.timerId&&(clearTimeout(this.timerId),this.timerId=-1)},e.prototype.getTime=function(){return this.time},e.prototype.setTime=function(t){this.time=t},e}(t.Command);t.Wait=e}(cmd||(cmd={}));!function(t){var e=function(t){function e(e,n,i,o){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===i&&(i=null),void 0===o&&(o=null);var r=t.call(this)||this;return r.completeHandler=function(t){r.notifyComplete()},r.func=e,r.args=n,r.eventDispatcher=i,r.eventType=o,r}return __extends(e,t),e.prototype.implExecuteFunction=function(t){this.eventDispatcher&&this.eventType?(this.eventDispatcher.addEventListener(this.eventType,this.completeHandler),this.func.apply(this,this.args)):(this.func.apply(this,this.args),this.notifyComplete())},e.prototype.implInterruptFunction=function(t){this.eventDispatcher&&this.eventType&&this.eventDispatcher.removeEventListener(this.eventType,this.completeHandler)},e.prototype.implDestroyFunction=function(t){this.eventDispatcher&&this.eventType&&this.eventDispatcher.removeEventListener(this.eventType,this.completeHandler),this.func=null,this.args=null,this.eventDispatcher=null,this.eventType=null},e.prototype.getFunction=function(){return this.func},e.prototype.setFunction=function(t){this.func=t},e.prototype.getArguments=function(){return this.args},e.prototype.setArguments=function(t){this.args=t},e.prototype.getEventDispatcher=function(){return this.eventDispatcher},e.prototype.setEventDispatcher=function(t){this.eventDispatcher=t},e.prototype.getEventType=function(){return this.eventType},e.prototype.setEventType=function(t){this.eventType=t},e}(t.Command);t.Func=e}(cmd||(cmd={}));!function(t){var e=function(t){function e(e,n){void 0===e&&(e=null),void 0===n&&(n=null);var i=t.call(this)||this;return i.completeHandler=function(t){i.notifyComplete()},i.eventDispatcher=e,i.eventType=n,i}return __extends(e,t),e.prototype.implExecuteFunction=function(t){this.eventDispatcher&&this.eventType&&this.eventDispatcher.addEventListener(this.eventType,this.completeHandler)},e.prototype.implInterruptFunction=function(t){this.eventDispatcher&&this.eventType&&this.eventDispatcher.removeEventListener(this.eventType,this.completeHandler)},e.prototype.implDestroyFunction=function(t){this.eventDispatcher&&this.eventType&&this.eventDispatcher.removeEventListener(this.eventType,this.completeHandler),this.eventType=null,this.eventDispatcher=null},e.prototype.getEventDispatcher=function(){return this.eventDispatcher},e.prototype.setEventDispatcher=function(t){this.eventDispatcher=t},e.prototype.getEventType=function(){return this.eventType},e.prototype.setEventType=function(t){this.eventType=t},e}(t.Command);t.Listen=e}(cmd||(cmd={}));!function(t){var e=alm.util.Easing,n=function(t){function n(n,i,o,r,s,a,u,c){void 0===o&&(o=null),void 0===r&&(r=1e3),void 0===s&&(s=e.linear),void 0===a&&(a=null),void 0===u&&(u=null),void 0===c&&(c=null);var h=t.call(this)||this;return h.intervalHandler=function(){var t=(new Date).getTime()-h.startTime;t<h.duration?(h.apply(t/h.duration),h.onUpdate&&h.onUpdate(h.progressTime,h.progressValue)):(h.apply(1),h.cancel(),h.onUpdate&&h.onUpdate(h.progressTime,h.progressValue),h.onComplete&&h.onComplete(h.progressTime,h.progressValue),h.notifyComplete())},h.tweenTarget=n,h.to=i,h.from=o,h.duration=r,h.easing=s,h.onStart=a,h.onUpdate=u,h.onComplete=c,h.progressTime=0,h.progressValue=0,h.startTime=0,h.timerId=-1,h}return __extends(n,t),n.prototype.implExecuteFunction=function(t){this.internalFrom={};for(var e in this.to)this.to[e],this.from&&null!=this.from[e]?this.internalFrom[e]=this.from[e]:this.internalFrom[e]=this.tweenTarget[e];this.duration>0?(this.timerId=window.setInterval(this.intervalHandler,n.updateInterval),this.startTime=(new Date).getTime(),this.apply(0),this.onStart&&this.onStart(this.progressTime,this.progressValue)):(this.apply(0),this.onStart&&this.onStart(this.progressTime,this.progressValue),this.apply(1),this.onUpdate&&this.onUpdate(this.progressTime,this.progressValue),this.onComplete&&this.onComplete(this.progressTime,this.progressValue),this.notifyComplete())},n.prototype.implInterruptFunction=function(t){this.cancel()},n.prototype.implDestroyFunction=function(t){this.cancel(),this.tweenTarget=null,this.to=null,this.from=null,this.easing=null,this.onStart=null,this.onUpdate=null,this.onComplete=null,this.internalFrom=null},n.prototype.cancel=function(){-1!=this.timerId&&(clearInterval(this.timerId),this.timerId=-1)},n.prototype.apply=function(t){this.progressTime=t,this.progressValue=this.easing(0,this.progressTime,0,1,1);var e;for(var n in this.to)e=this.internalFrom[n],this.tweenTarget[n]=e+(this.to[n]-e)*this.progressValue},n.prototype.getTarget=function(){return this.tweenTarget},n.prototype.setTarget=function(t){this.tweenTarget=t},n.prototype.getDuration=function(){return this.duration},n.prototype.setDuration=function(t){this.duration=t},n.prototype.getTo=function(){return this.to},n.prototype.setTo=function(t){this.to=t},n.prototype.getFrom=function(){return this.from},n.prototype.setFrom=function(t){this.from=t},n.prototype.getEasing=function(){return this.easing},n.prototype.setEasing=function(t){this.easing=t},n.prototype.getOnStart=function(){return this.onStart},n.prototype.setOnStart=function(t){this.onStart=t},n.prototype.getOnUpdate=function(){return this.onUpdate},n.prototype.setOnUpdate=function(t){this.onUpdate=t},n.prototype.getOnComplete=function(){return this.onComplete},n.prototype.setOnComplete=function(t){this.onComplete=t},n.prototype.getProgressTime=function(){return this.progressTime},n.prototype.getProgressValue=function(){return this.progressValue},n.prototype.getUpdateInterval=function(){return n.updateInterval},n.prototype.setUpdateInterval=function(t){n.updateInterval=t},n.updateInterval=1e3/60,n}(t.Command);t.Tween=n}(cmd||(cmd={}));!function(t){var e=function(e){function n(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var o=e.apply(this,n)||this;return o.completeHandler=function(e){o.currentCommand.removeEventListener(t.CommandEvent.COMPLETE,o.completeHandler),o.currentCommand=null,++o.position>=o.getLength()?o.notifyComplete():o.next()},o.currentCommand=null,o.position=-1,o.isPaused=!1,o.isCompleteOnPaused=!1,o}return __extends(n,e),n.prototype.addCommand=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.prototype.addCommand.apply(this,t)},n.prototype.insertCommand=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.prototype.insertCommandAt.apply(this,[this.position+1].concat(t))},n.prototype.addCommandArray=function(t){this.addCommand.apply(this,t)},n.prototype.insertCommandArray=function(t){this.insertCommand.apply(this,t)},n.prototype.next=function(){this.currentCommand=this.getCommandByIndex(this.position),this.currentCommand.addEventListener(t.CommandEvent.COMPLETE,this.completeHandler),this.currentCommand.execute()},n.prototype.implExecuteFunction=function(t){this.position=0,this.getLength()>0?this.next():this.notifyComplete()},n.prototype.implInterruptFunction=function(n){this.currentCommand&&(this.currentCommand.removeEventListener(t.CommandEvent.COMPLETE,this.completeHandler),this.currentCommand.interrupt(),this.currentCommand=null),this.position=-1,e.prototype.implInterruptFunction.call(this,n)},n.prototype.implDestroyFunction=function(n){this.currentCommand&&(this.currentCommand.removeEventListener(t.CommandEvent.COMPLETE,this.completeHandler),this.currentCommand.destroy(),this.currentCommand=null),this.position=-1,this.isPaused=!1,this.isCompleteOnPaused=!1,e.prototype.implDestroyFunction.call(this,n)},n.prototype.implNotifyBreak=function(){this.currentCommand.getState()==t.CommandState.Executing&&(this.currentCommand.removeEventListener(t.CommandEvent.COMPLETE,this.completeHandler),this.currentCommand.interrupt()),this.notifyComplete()},n.prototype.implNotifyReturn=function(){this.currentCommand.getState()==t.CommandState.Executing&&(this.currentCommand.removeEventListener(t.CommandEvent.COMPLETE,this.completeHandler),this.currentCommand.interrupt());var e=this.getParent().notifyReturn;e&&e(),this.destroy()},n.prototype.getPosition=function(){return this.position},n}(t.CommandList);t.Serial=e}(cmd||(cmd={}));var cmd;!function(t){var e=function(e){function n(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=e.apply(this,t)||this;return i.completeHandler=function(t){++i.completeCount>=i.getLength()&&i.notifyComplete()},i.completeCount=0,i}return __extends(n,e),n.prototype.addCommand=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.prototype.addCommand.apply(this,t)},n.prototype.insertCommand=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addCommand.apply(this,t)},n.prototype.addCommandArray=function(t){this.addCommand.apply(this,t)},n.prototype.insertCommandArray=function(t){this.addCommand.apply(this,t)},n.prototype.implExecuteFunction=function(e){this.completeCount=0;var n=this.getLength();if(n>0)for(var i,o=this.getCommands(),r=0;r<n;++r)(i=o[r]).addEventListener(t.CommandEvent.COMPLETE,this.completeHandler),i.execute();else this.notifyComplete()},n.prototype.implInterruptFunction=function(n){var i=this.getLength();if(i>0)for(var o,r=this.getCommands(),s=0;s<i;++s)(o=r[s]).removeEventListener(t.CommandEvent.COMPLETE,this.completeHandler),o.interrupt();e.prototype.implInterruptFunction.call(this,n)},n.prototype.implDestroyFunction=function(n){var i=this.getLength();if(i>0)for(var o,r=this.getCommands(),s=0;s<i;++s)(o=r[s]).removeEventListener(t.CommandEvent.COMPLETE,this.completeHandler),o.destroy();e.prototype.implDestroyFunction.call(this,n)},n.prototype.implNotifyBreak=function(){var e=this.getLength();if(e>0)for(var n=this.getCommands(),i=void 0,o=0;o<e;++o)(i=n[o]).getState()==t.CommandState.Executing&&(i.removeEventListener(t.CommandEvent.COMPLETE,this.completeHandler),i.interrupt());this.notifyComplete()},n.prototype.implNotifyReturn=function(){var e=this.getLength();if(e>0)for(var n=this.getCommands(),i=void 0,o=0;o<e;++o)(i=n[o]).getState()==t.CommandState.Executing&&(i.removeEventListener(t.CommandEvent.COMPLETE,this.completeHandler),i.interrupt());var r=this.getParent().notifyReturn;r&&r(),this.destroy()},n.prototype.getCompleteCount=function(){return this.completeCount},n}(t.CommandList);t.Parallel=e}(cmd||(cmd={}));!function(t){!function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.set(t,e)}return t.prototype.set=function(t,e){this.x=t,this.y=e},t.prototype.copyTo=function(t){t.set(this.x,this.y)},t.prototype.getClone=function(){return new t(this.x,this.y)},t.prototype.zero=function(){this.set(0,0)},t.prototype.normalize=function(){var t=this.getLength();this.x/=t,this.y/=t},t.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.getSquareDistance=function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},t.prototype.getDistance=function(t){return Math.sqrt(this.getSquareDistance(t))},t}();t.Vector2=e}(t.geom||(t.geom={}))}(alm||(alm={}));!function(t){!function(t){var e=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.set(t,e,n)}return t.prototype.set=function(t,e,n){this.x=t,this.y=e,this.z=n},t.prototype.copyTo=function(t){t.set(this.x,this.y,this.z)},t.prototype.getClone=function(){return new t(this.x,this.y,this.z)},t.prototype.zero=function(){this.set(0,0,0)},t.prototype.normalize=function(){var t=this.getLength();this.x/=t,this.y/=t,this.z/=t},t.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},t.prototype.getSquareDistance=function(t){var e=t.x-this.x,n=t.y-this.y,i=t.z-this.z;return e*e+n*n+i*i},t.prototype.getDistance=function(t){return Math.sqrt(this.getSquareDistance(t))},t}();t.Vector3=e}(t.geom||(t.geom={}))}(alm||(alm={}));!function(t){!function(t){var e=function(){function e(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.set(t,e,n,i)}return e.prototype.set=function(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i},e.prototype.copyTo=function(t){t.set(this.x,this.y,this.width,this.height)},e.prototype.getClone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.getTop=function(){return this.y},e.prototype.getBottom=function(){return this.y+this.height},e.prototype.getLeft=function(){return this.x},e.prototype.getRight=function(){return this.x+this.width},e.prototype.getTopLeft=function(){return new t.Vector2(this.getLeft(),this.getTop())},e.prototype.getTopRight=function(){return new t.Vector2(this.getRight(),this.getTop())},e.prototype.getBottomLeft=function(){return new t.Vector2(this.getLeft(),this.getBottom())},e.prototype.getBottomRight=function(){return new t.Vector2(this.getRight(),this.getBottom())},e}();t.Rectangle=e}(t.geom||(t.geom={}))}(alm||(alm={}));!function(t){!function(t){var e=function(){function t(){}return t.each=function(t,e){null!=t&&Object.keys(t).forEach(function(n){e(n,t[n])})},t}();t.Obj=e}(t.util||(t.util={}))}(alm||(alm={}));!function(t){!function(t){var e=function(){function t(){}return t.sequence=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=1);for(var i=new Array(t),o=e,r=0;r<t;++r)i[r]=o,o+=n;return i},t.unique=function(t){return t.filter(function(t,e,n){return n.indexOf(t)===e})},t.duplicated=function(t,e){return void 0===e&&(e=!1),e?t.filter(function(t,e,n){return n.indexOf(t)!==n.lastIndexOf(t)}):t.filter(function(t,e,n){return n.indexOf(t)===e&&n.lastIndexOf(t)!==e})},t.roundRobin=function(t,e,n){var i,o,r=1,s=t.length,a=e.length;for(i=0;i<s;++i)for(o=i+1;o<a;++o)n(r++,i,o,t[i],e[o])},t}();t.Arr=e}(t.util||(t.util={}))}(alm||(alm={}));!function(t){!function(t){var e=function(){function t(){}return t.map=function(t,e,n,i,o,r){return void 0===r&&(r=!0),e==n?i:(r&&(e<n?t<e?t=e:t>n&&(t=n):t<n?t=n:t>e&&(t=e)),(t-e)*(o-i)/(n-e)+i)},t.random=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=1),t+(e-t)*Math.random()},t.randomInt=function(e,n){return void 0===e&&(e=0),void 0===n&&(n=1),Math.floor(t.random(e,n))},t.clamp=function(t,e,n){return t<e?e:t>n?n:t},t.dist=function(t,e,n,i,o){void 0===o&&(o=!1);var r=n-t,s=i-e;return o?r*r+s*s:Math.sqrt(r*r+s*s)},t.radToDeg=function(e){return e*t.RAD2DEG},t.degToRad=function(e){return e*t.DEG2RAD},t.turn=function(e,n,i){return void 0===i&&(i=!0),i?(n-e+t.PI3)%t.PI2-Math.PI:(n-e+540)%360-180},t.PI2=2*Math.PI,t.PI3=3*Math.PI,t.PI4=4*Math.PI,t.PI5=5*Math.PI,t.PI6=6*Math.PI,t.PI_2=Math.PI/2,t.PI_3=Math.PI/3,t.PI_4=Math.PI/4,t.PI_6=Math.PI/6,t.RAD2DEG=180/Math.PI,t.DEG2RAD=Math.PI/180,t}();t.Num=e}(t.util||(t.util={}))}(alm||(alm={}));!function(t){!function(t){var e=function(){function t(){}return t.toTimeString=function(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),n+=60*e+3600*t;var i=Math.floor(n/3600).toString(),o=Math.floor(n/60%60).toString(),r=("0"+Math.floor(n%60)).substr(-2,2);return"0"!=i?i+":"+("0"+o).substr(-2,2)+":"+r:o+":"+r},t}();t.Str=e}(t.util||(t.util={}))}(alm||(alm={}));!function(t){!function(t){var e=function(){function t(){}return t.getQuery=function(){for(var t,e={},n=location.search.substring(1).split("&"),i=0;n[i];++i)e[(t=n[i].split("="))[0]]=t[1];return e},t}();t.Loc=e}(t.util||(t.util={}))}(alm||(alm={}));!function(t){!function(e){var n;!function(t){t[t.Top_Left=0]="Top_Left",t[t.Top_Center=1]="Top_Center",t[t.Top_Right=2]="Top_Right",t[t.Middle_Left=3]="Middle_Left",t[t.Middle_Center=4]="Middle_Center",t[t.Middle_Right=5]="Middle_Right",t[t.Bottom_Left=6]="Bottom_Left",t[t.Bottom_Center=7]="Bottom_Center",t[t.Bottom_Right=8]="Bottom_Right"}(n=e.Align||(e.Align={}));var i;!function(t){t[t.ExactFit=0]="ExactFit",t[t.ShowAll=1]="ShowAll",t[t.NoBorder=2]="NoBorder",t[t.NoScale=3]="NoScale"}(i=e.ScaleMode||(e.ScaleMode={}));var o=function(){function e(){}return e.resize=function(e,o,r,s){void 0===r&&(r=i.ShowAll),void 0===s&&(s=n.Middle_Center);var a=e.x,u=e.y,c=e.width,h=e.height,l=o.x,p=o.y,d=o.width,f=o.height;switch(r){case i.ShowAll:case i.NoBorder:var m=d/c,v=f/h,y=r==i.ShowAll?m<v?m:v:m>v?m:v;c*=y,h*=y;break;case i.ExactFit:return new t.geom.Rectangle(l,p,d,f)}return a=l+(s==n.Top_Left||s==n.Middle_Left||s==n.Bottom_Left?0:s==n.Top_Right||s==n.Middle_Right||s==n.Bottom_Right?d-c:(d-c)/2),u=p+(s==n.Top_Left||s==n.Top_Center||s==n.Top_Right?0:s==n.Bottom_Left||s==n.Bottom_Center||s==n.Bottom_Right?f-h:(f-h)/2),new t.geom.Rectangle(a,u,c,h)},e}();e.Boxer=o}(t.util||(t.util={}))}(alm||(alm={}));!function(t){!function(t){var e=function(){function t(t){void 0===t&&(t=null),t?this.set(t):(this.initValues=this.restValues=null,this.restCount=this.restValues.length,this.isEmpty=!0),this.onCheck=null,this.isAutoResetEnabled=!1}return t.prototype.set=function(t){this.initValues=t.concat(),this.reset()},t.prototype.get=function(){this.isEmpty&&this.isAutoResetEnabled&&this.reset();var t=Math.floor(Math.random()*this.restCount),e=this.restValues[t],n=!0;return this.onCheck&&(n=this.onCheck(e)),n&&(this.restValues.splice(t,1),this.restCount=this.restValues.length,this.isEmpty=0==this.restCount),e},t.prototype.reset=function(){this.restValues=this.initValues.concat(),this.restCount=this.restValues.length,this.isEmpty=0==this.restCount},t.prototype.getRestCount=function(){return this.restCount},t.prototype.getIsEmply=function(){return this.isEmpty},t.prototype.getIsAutoResetEnabled=function(){return this.isAutoResetEnabled},t.prototype.setIsAutoResetEnabled=function(t){this.isAutoResetEnabled=t},t.createIndices=function(e){for(var n=new Array(e),i=0;i<e;++i)n[i]=i;return new t(n)},t}();t.Raffle=e}(t.util||(t.util={}))}(alm||(alm={}));!function(t){!function(t){var e=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=!0),this.setAngle(t,n),this.setVelocity(e,n)}return t.prototype.getAngle=function(t){return void 0===t&&(t=!0),t?this.angle:180*this.angle/Math.PI},t.prototype.setAngle=function(t,e){void 0===e&&(e=!0),this.angle=e?t:t*Math.PI/180},t.prototype.getVelocity=function(t){return void 0===t&&(t=!0),t?this.velocity:180*this.velocity/Math.PI},t.prototype.setVelocity=function(t,e){void 0===e&&(e=!0),this.velocity=e?t:t*Math.PI/180},t.prototype.update=function(){this.angle+=this.velocity},t.prototype.getSin=function(t){return void 0===t&&(t=1),t*Math.sin(this.angle)},t.prototype.getCos=function(t){return void 0===t&&(t=1),t*Math.cos(this.angle)},t.prototype.getTan=function(t){return void 0===t&&(t=1),t*Math.tan(this.angle)},t.prototype.getMagnitude=function(t){return void 0===t&&(t=1),t*(1+Math.sin(this.angle))/2},t.prototype.getVector=function(t,e){if(void 0===t&&(t=1),void 0===e&&(e=null),null==e)return{x:this.getCos(t),y:this.getSin(t)};e.x=this.getCos(t),e.y=this.getSin(t)},t}();t.Rotator=e}(t.util||(t.util={}))}(alm||(alm={}));!function(t){!function(t){var e;!function(t){t[t.Verbose=0]="Verbose",t[t.Info=1]="Info",t[t.Warn=2]="Warn",t[t.Error=3]="Error",t[t.Silent=4]="Silent"}(e=t.LoggerLevel||(t.LoggerLevel={}));var n=function(){function t(){}return t.prototype.verbose=function(t){},t.prototype.info=function(t){},t.prototype.warn=function(t){},t.prototype.error=function(t){},t}();t.NullLogging=n;var i=function(){function t(){}return t.prototype.verbose=function(t){console.debug.apply(console,Array.prototype.slice.call(["Verbose: "].concat(t)))},t.prototype.info=function(t){console.log.apply(console,Array.prototype.slice.call(["Info   : "].concat(t)))},t.prototype.warn=function(t){console.warn.apply(console,Array.prototype.slice.call(["Warn   : "].concat(t)))},t.prototype.error=function(t){console.error.apply(console,Array.prototype.slice.call(["Error  : "].concat(t)))},t}();t.ConsoleLogging=i;var o=function(){function t(t,e){this.dom=t,this.html=e}return t.prototype.verbose=function(t){this.print("Verbose: ",t)},t.prototype.info=function(t){this.print("Info   : ",t)},t.prototype.warn=function(t){this.print("Warn   : ",t)},t.prototype.error=function(t){this.print("Error  : ",t)},t.prototype.print=function(t,e){var n=e.join(", ")+"\n";this.html?this.dom.innerHTML=n+this.dom.innerHTML:this.dom.innerText=n+this.dom.innerText},t}();t.DOMLogging=o;var r=function(){function t(t){this.loggers=t}return t.prototype.verbose=function(t){for(var e=this.loggers.length,n=0;n<e;++n)this.loggers[n].verbose.apply(this,t)},t.prototype.info=function(t){for(var e=this.loggers.length,n=0;n<e;++n)this.loggers[n].info.apply(this,t)},t.prototype.warn=function(t){for(var e=this.loggers.length,n=0;n<e;++n)this.loggers[n].warn.apply(this,t)},t.prototype.error=function(t){for(var e=this.loggers.length,n=0;n<e;++n)this.loggers[n].error.apply(this,t)},t}();t.ParallelLogging=r;var s=function(){function t(){}return t.verbose=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];t.level<=e.Verbose&&t.logger.verbose(n)},t.info=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];t.level<=e.Info&&t.logger.info(n)},t.warn=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];t.level<=e.Warn&&t.logger.warn(n)},t.error=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];t.level<=e.Error&&t.logger.error(n)},t.warnIf=function(n,i,o){void 0===o&&(o=!0),t.level<=e.Warn&&o&&t.logger.warn([i+" : "+n])},t.errorIf=function(n,i,o){void 0===o&&(o=!0),t.level<=e.Error&&o&&t.logger.error([i+" : "+n])},t.level=e.Verbose,t.logger=new i,t}();t.Logger=s}(t.util||(t.util={}))}(alm||(alm={}));!function(t){!function(e){var n=function(t){function n(n,i){void 0===n&&(n=1e3),void 0===i&&(i=0);var o=t.call(this)||this;return o.timerHandler=function(){o.tStartTime=o.getCurrentTime(),++o.elapsedCount;var t=!1;o.repeatCount>0&&o.elapsedCount>=o.repeatCount?(t=!0,o.stop()):o.tInterval!=o.interval&&o.startInterval(o.interval),o.dispatch(e.TimerEvent.TICK),t&&o.dispatch(e.TimerEvent.COMPLETE)},o.interval=n,o.repeatCount=i,o.isRunning=!1,o.tId=-1,o.reset(),o}return __extends(n,t),n.prototype.start=function(){this.isRunning||(this.isRunning=!0,this.tStartTime=this.getCurrentTime(),this.startInterval(-1!=this.tRestTime?this.tRestTime:this.interval))},n.prototype.stop=function(){this.isRunning&&(this.isRunning=!1,this.tRestTime=this.getCurrentTime()-this.tStartTime,this.stopInterval())},n.prototype.reset=function(){this.stop(),this.elapsedCount=0,this.tRestTime=-1},n.prototype.restart=function(){this.reset(),this.start()},n.prototype.getCurrentTime=function(){return(new Date).valueOf()},n.prototype.startInterval=function(t){this.stopInterval(),this.tInterval=t,this.tId=window.setInterval(this.timerHandler,this.tInterval)},n.prototype.stopInterval=function(){-1!=this.tId&&(clearInterval(this.tId),this.tId=-1)},n.prototype.dispatch=function(t){this.dispatchEvent(new e.TimerEvent(t,this,this.elapsedCount,this.repeatCount,this.getRestCount()))},n.prototype.getIsRunning=function(){return this.isRunning},n.prototype.getInterval=function(){return this.interval},n.prototype.setInterval=function(t){this.interval=t},n.prototype.getElapsedTime=function(){return this.getCurrentTime()-this.tStartTime},n.prototype.getRestTime=function(){return this.interval-this.getElapsedTime()},n.prototype.getElapsedCount=function(){return this.elapsedCount},n.prototype.getRepeatCount=function(){return this.repeatCount},n.prototype.setRepeatCount=function(t){this.repeatCount=t},n.prototype.getRestCount=function(){return this.repeatCount-this.elapsedCount},n}(t.event.EventDispatcher);e.Timer=n}(t.util||(t.util={}))}(alm||(alm={}));!function(t){!function(e){var n=function(t){function e(e,n,i,o,r){void 0===n&&(n=null),void 0===i&&(i=0),void 0===o&&(o=0),void 0===r&&(r=0);var s=t.call(this,e,n)||this;return s.elapsedCount=i,s.repeatCount=o,s.restCount=r,s}return __extends(e,t),e.prototype.clone=function(){return new e(this.getType(),this.getTarget(),this.elapsedCount,this.repeatCount,this.restCount)},e.prototype.toString=function(){return"[TimerEvent] type = "+this.getType()+", elapsedCount = "+this.elapsedCount+", repeatCount="+this.repeatCount+", restCount="+this.restCount},e.TICK="tick",e.COMPLETE="complete",e}(t.event.Event);e.TimerEvent=n}(t.util||(t.util={}))}(alm||(alm={}));!function(t){!function(t){var e=function(){function t(){}return t.fadeTo=function(t,e,n,i,o,r,s){void 0===o&&(o=""),void 0===r&&(r=!1),void 0===s&&(s=!0);var a={value:parseInt(t.css("opacity"))},u=new cmd.Tween(a,{value:e},null,n,i,function(){e>0&&(""!=o&&t.css("display",o),r&&t.css("visibility","visible"))},function(){t.css("opacity",a.value)},function(){e<=0&&(""!=o&&t.css("display","none"),r&&t.css("visibility","hidden"))});return s&&u.execute(),u},t.fadeInJquery=function(e,n,i,o,r,s){return void 0===o&&(o=""),void 0===r&&(r=!1),void 0===s&&(s=!0),t.fadeTo(e,1,n,i,o,r,s)},t.fadeOutJquery=function(e,n,i,o,r,s){return void 0===o&&(o=""),void 0===r&&(r=!1),void 0===s&&(s=!0),t.fadeTo(e,0,n,i,o,r,s)},t.getQuery=function(){for(var t,e={},n=location.search.substring(1).split("&"),i=0;n[i];++i)e[(t=n[i].split("="))[0]]=t[1];return e},t}();t.JQueryUtil=e}(t.util||(t.util={}))}(alm||(alm={}));!function(t){!function(t){var e=function(){function t(){}return t.stop=function(t){return t&&t.interrupt(),null},t.sequence=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=new cmd.Serial;return i.addCommand.apply(i,e),t&&i.execute(),i},t.single=function(t,e){return t&&e&&e.execute(),e},t}();t.CommandUtil=e}(t.util||(t.util={}))}(alm||(alm={}));!function(t){!function(e){var n=t.event.EventDispatcher,i=function(){function t(){this.isLoading_=!1,this.currentCount=0,this.totalCount=0,this.loadingQueries=[],this.loadingQueryIndex=-1,this.queriesByQueryId={},this.queriesByUrl={},this.texturesByUrl={},this.texturesByQueryId={},this.eventDispatcher=new n}return t.prototype.requireJQueryJson=function(t){return this.addQuery("jQuery.JSON",t,{})},t.prototype.requireThreeTexture=function(t){return this.addQuery("THREE.Texture",t,{})},t.prototype.addQuery=function(e,n,i){if(this.queriesByUrl[n])return this.queriesByUrl[n].id;var r=new o;return r.id=String(t.id),r.type=e,r.url=n,r.param=i,this.loadingQueries.push(r),this.queriesByQueryId[r.id]=r,this.queriesByUrl[r.url]=r,++t.id,r.id},t.prototype.load=function(){this.isLoading_||(this.isLoading_=!0,this.loadingQueryIndex=-1,this.next())},t.prototype.next=function(){var t=this;if(this.currentCount=this.loadingQueryIndex+1,this.totalCount=this.loadingQueries.length,this.currentCount>0&&this.eventDispatcher.dispatchEvent(new e.AssetLoaderEvent(e.AssetLoaderEvent.PROGRESS,this,this.currentCount/this.totalCount,this.currentCount,this.totalCount)),this.currentCount<this.totalCount){this.loadingQueryIndex++;var n=this.loadingQueries[this.loadingQueryIndex];switch(n.isLoading=!0,n.isLoadComplete=!1,trace("[AssetLoader] loading... '"+n.url+"' as '"+n.type+"'"),n.type){case"jQuery.JSON":jQuery.getJSON(n.url,function(e){n.isLoading=!1,n.isLoadComplete=!0,n.content=e,n.param.onLoad&&n.param.onLoad(e),t.next()});break;case"THREE.Texture":var i=n.url,o=(new THREE.TextureLoader).load(i,function(e){n.isLoading=!1,n.isLoadComplete=!0,n.content=e,n.param.onLoad&&n.param.onLoad(e),t.next()},function(t){},function(e){n.isLoading=!1,n.isLoadComplete=!0,n.param.onError&&n.param.onError(e.type+" : "+e.message),t.next()});this.texturesByUrl[n.url]=o,this.texturesByQueryId[n.id]=o;break;default:this.next()}}else this.isLoading_=!1,this.loadingQueries=[],this.loadingQueryIndex=-1,this.eventDispatcher.dispatchEvent(new e.AssetLoaderEvent(e.AssetLoaderEvent.COMPLETE,this,this.currentCount/this.totalCount,this.currentCount,this.totalCount))},t.prototype.addLoadUpdateListener=function(t){this.eventDispatcher.addEventListener(e.AssetLoaderEvent.PROGRESS,t)},t.prototype.removeLoadUpdateListener=function(t){this.eventDispatcher.removeEventListener(e.AssetLoaderEvent.PROGRESS,t)},t.prototype.addLoadCompleteListener=function(t){this.eventDispatcher.addEventListener(e.AssetLoaderEvent.COMPLETE,t)},t.prototype.removeLoadCompleteListener=function(t){this.eventDispatcher.removeEventListener(e.AssetLoaderEvent.COMPLETE,t)},t.prototype.getQueryByQueryId=function(t){return this.queriesByQueryId[t]},t.prototype.getQueryByUrl=function(t){return this.queriesByUrl[t]},t.prototype.isLoading=function(){return this.isLoading_},t.prototype.getCurrentCount=function(){return this.currentCount},t.prototype.getTotalCount=function(){return this.totalCount},t.prototype.getTexturesByUrl=function(t){return this.texturesByUrl[t]},t.prototype.getTexturesByQueryId=function(t){return this.texturesByQueryId[t]},t.id=0,t}();e.AssetLoader=i;var o=function(){return function(){this.isLoading=!1,this.isLoadComplete=!1}}();e.LoaderQuery=o}(t.loader||(t.loader={}))}(alm||(alm={}));!function(t){!function(e){var n=function(t){function e(e,n,i,o,r,s){void 0===n&&(n=null),void 0===i&&(i=0),void 0===o&&(o=0),void 0===r&&(r=0),void 0===s&&(s=null);var a=t.call(this,e,n)||this;return a.progress=i,a.loadedCount=o,a.totalCount=r,a.content=s,a}return __extends(e,t),e.prototype.clone=function(){return new e(this.getType(),this.getTarget(),this.progress,this.loadedCount,this.totalCount,this.content)},e.prototype.toString=function(){return"[AssetLoaderEvent] type = "+this.getType()+", progress = "+this.progress+", loadedCount = "+this.loadedCount+", totalCount = "+this.totalCount},e.PROGRESS="progress",e.COMPLETE="complete",e.ERROR="error",e}(t.event.Event);e.AssetLoaderEvent=n}(t.loader||(t.loader={}))}(alm||(alm={}));!function(t){!function(e){var n=function(t){function e(n){void 0===n&&(n=null);var i=t.call(this)||this;return i.view=n,i.isInitializing=!1,i.isInitialized=!1,i.isReady=!1,i.isShowing=!1,i.isShown=!0,i.isHiding=!1,i.autoHideWithInit=!0,i.name="",i.id=e.id,e.viewsById[e.id]=i,++e.id,i}return __extends(e,t),e.prototype.initialize=function(){this.isInitializing||this.isInitialized||(this.isInitializing=!0,this.view=this.implInitialize(),throwError(this.name||this,"view is null",!this.view),this.hide(!1),this.isInitializing=!1,this.isInitialized=!0)},e.prototype.ready=function(){this.isReady||(throwError(this.name||this,"ready() was called without being initialized",!this.isInitialized),this.implReady(),this.isReady=!0)},e.prototype.finalize=function(){this.implFinalize()},e.prototype.show=function(t){void 0===t&&(t=!0),this.isShown||this.getShowCommand(t).execute()},e.prototype.hide=function(t){void 0===t&&(t=!0),this.isShown&&this.getHideCommand(t).execute()},e.prototype.getShowCommand=function(t){var e=this;void 0===t&&(t=!0);var n=new cmd.Serial;return n.addCommand(new cmd.Func(function(){e.isShown||(throwError(e.name||e,"getShowCommand() was called without being initialized",!e.isInitialized),throwWarn(e.name||e,"getShowCommand() was called without being ready",!e.isReady),e.isShown=!0,e.isShowing=!0,e.isHiding=!1,e.showCommand&&(e.showCommand.interrupt(),e.showCommand=null),e.hideCommand&&(e.hideCommand.interrupt(),e.hideCommand=null),e.showCommand=n,n.insertCommand(e.implShow(e.view,t),new cmd.Func(function(){e.showCommand=null,e.isShowing=!1})))})),n},e.prototype.getHideCommand=function(t){var e=this;void 0===t&&(t=!0);var n=new cmd.Serial;return n.addCommand(new cmd.Func(function(){e.isShown&&(e.isInitializing||(throwError(e.name||e,"getHideCommand() was called without being initialized",!e.isInitialized),throwWarn(e.name||e,"getHideCommand() was called without being ready",!e.isReady)),e.isShown=!1,e.isShowing=!1,e.isHiding=!0,e.showCommand&&(e.showCommand.interrupt(),e.showCommand=null),e.hideCommand&&(e.hideCommand.interrupt(),e.hideCommand=null),e.hideCommand=n,n.insertCommand(e.implHide(e.view,t),new cmd.Func(function(){e.hideCommand=null,e.isHiding=!1})))})),n},e.prototype.getIsInitializing=function(){return this.isInitializing},e.prototype.getIsInitialized=function(){return this.isInitialized},e.prototype.getIsReady=function(){return this.isReady},e.prototype.getIsShowing=function(){return this.isShowing},e.prototype.getIsShown=function(){return this.isShown},e.prototype.getIsHiding=function(){return this.isHiding},e.prototype.getIsHidden=function(){return!this.isShown},e.prototype.getView=function(){return this.view},e.prototype.getAutoHideWithInit=function(){return this.autoHideWithInit},e.prototype.setAutoHideWithInit=function(t){this.autoHideWithInit=t},e.prototype.getName=function(){return this.name},e.prototype.setName=function(t){this.name=t},e.getViewById=function(t){return e.viewsById[t]},e.id=0,e.viewsById={},e}(t.event.EventDispatcher);e.View=n}(t.view||(t.view={}))}(alm||(alm={}));!function(t){!function(t){var e=function(){function t(){}return t.initialize=function(){if(!this.isInitialized){this.isInitialized=!0;var t=window.navigator.userAgent.toLowerCase();this.isTablet=-1!=t.indexOf("windows")&&-1!=t.indexOf("touch")||-1!=t.indexOf("ipad")||-1!=t.indexOf("android")&&-1==t.indexOf("mobile")||-1!=t.indexOf("firefox")&&-1!=t.indexOf("tablet")||-1!=t.indexOf("kindle")||-1!=t.indexOf("silk")||-1!=t.indexOf("playbook"),this.isMobile=-1!=t.indexOf("windows")&&-1!=t.indexOf("phone")||-1!=t.indexOf("iphone")||-1!=t.indexOf("ipod")||-1!=t.indexOf("android")&&-1!=t.indexOf("mobile")||-1!=t.indexOf("firefox")&&-1!=t.indexOf("mobile")||-1!=t.indexOf("blackberry"),this.isDesktop=!this.isTablet&&!this.isMobile,this.isIOS=-1!=t.indexOf("ipad")||-1!=t.indexOf("iphone")||-1!=t.indexOf("ipod"),this.isAndroid=-1!=t.indexOf("android")&&-1!=t.indexOf("mobile"),this.isRetina=2==Math.round(window.devicePixelRatio)}},t.getIsDesktop=function(){return this.initialize(),this.isDesktop},t.getIsTablet=function(){return this.initialize(),this.isTablet},t.getIsMobile=function(){return this.initialize(),this.isMobile},t.getIsIOS=function(){return this.initialize(),this.isIOS},t.getIsAndroid=function(){return this.initialize(),this.isAndroid},t.getIsRetina=function(){return this.initialize(),this.isRetina},t.isInitialized=!1,t}();t.DeviceInfo=e}(t.browser||(t.browser={}))}(alm||(alm={}));!function(t){!function(t){var e=function(){function t(){}return t.save=function(e,n,i){if(void 0===i&&(i=-1),!t.isAvailable())return!1;var o={value:JSON.stringify(n),expiredAt:i};return localStorage.setItem(e,JSON.stringify(o)),!0},t.saveWithTerm=function(e,n,i){void 0===i&&(i=-1);var o=i>0?(new Date).getTime()+i:-1;return t.save(e,n,o)},t.load=function(e,n){if(void 0===n&&(n=null),!t.isAvailable())return n;var i=JSON.parse(localStorage.getItem(e));return i?i.expiredAt>0?(new Date).getTime()<i.expiredAt?JSON.parse(i.value):(localStorage.removeItem(e),n):JSON.parse(i.value):n},t.remove=function(e){t.isAvailable()&&localStorage.removeItem(e)},t.isAvailable=function(){if(null==t.isAvailable_)try{localStorage.setItem("__CKECK__","__CKECK__"),localStorage.removeItem("__CKECK__"),t.isAvailable_=!0}catch(e){t.isAvailable_=!1}return t.isAvailable_},t.toMilliseconds=function(t,e,n,i,o){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),o+1e3*(i+60*(n+60*(e+24*t)))},t.isAvailable_=null,t}();t.LocalStorage=e}(t.browser||(t.browser={}))}(alm||(alm={}));!function(t){!function(e){var n=t.event.EventDispatcher;!function(t){t[t.Backspace=8]="Backspace",t[t.Tab=9]="Tab",t[t.Enter=13]="Enter",t[t.Shift=16]="Shift",t[t.Ctrl=17]="Ctrl",t[t.Alt=18]="Alt",t[t.PauseBreak=19]="PauseBreak",t[t.CapsLock=20]="CapsLock",t[t.Escape=27]="Escape",t[t.Space=32]="Space",t[t.PageUp=33]="PageUp",t[t.PageDown=34]="PageDown",t[t.End=35]="End",t[t.Home=36]="Home",t[t.LeftArrow=37]="LeftArrow",t[t.UpArrow=38]="UpArrow",t[t.RightArrow=39]="RightArrow",t[t.DownArrow=40]="DownArrow",t[t.Insert=45]="Insert",t[t.Delete=46]="Delete",t[t.Key0=48]="Key0",t[t.Key1=49]="Key1",t[t.Key2=50]="Key2",t[t.Key3=51]="Key3",t[t.Key4=52]="Key4",t[t.Key5=53]="Key5",t[t.Key6=54]="Key6",t[t.Key7=55]="Key7",t[t.Key8=56]="Key8",t[t.Key9=57]="Key9",t[t.ClosedParen=48]="ClosedParen",t[t.ExclamationMark=49]="ExclamationMark",t[t.AtSign=50]="AtSign",t[t.PoundSign=51]="PoundSign",t[t.Hash=51]="Hash",t[t.DollarSign=52]="DollarSign",t[t.PercentSign=53]="PercentSign",t[t.Caret=54]="Caret",t[t.Hat=54]="Hat",t[t.Ampersand=55]="Ampersand",t[t.Star=56]="Star",t[t.Asterik=56]="Asterik",t[t.OpenParen=57]="OpenParen",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.LeftWindowKey=91]="LeftWindowKey",t[t.RightWindowKey=92]="RightWindowKey",t[t.SelectKey=93]="SelectKey",t[t.Numpad0=96]="Numpad0",t[t.Numpad1=97]="Numpad1",t[t.Numpad2=98]="Numpad2",t[t.Numpad3=99]="Numpad3",t[t.Numpad4=100]="Numpad4",t[t.Numpad5=101]="Numpad5",t[t.Numpad6=102]="Numpad6",t[t.Numpad7=103]="Numpad7",t[t.Numpad8=104]="Numpad8",t[t.Numpad9=105]="Numpad9",t[t.Multiply=106]="Multiply",t[t.Add=107]="Add",t[t.Subtract=109]="Subtract",t[t.DecimalPoint=110]="DecimalPoint",t[t.Divide=111]="Divide",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12",t[t.NumLock=144]="NumLock",t[t.ScrollLock=145]="ScrollLock",t[t.SemiColon=186]="SemiColon",t[t.Equals=187]="Equals",t[t.Comma=188]="Comma",t[t.Dash=189]="Dash",t[t.Period=190]="Period",t[t.UnderScore=189]="UnderScore",t[t.PlusSign=187]="PlusSign",t[t.ForwardSlash=191]="ForwardSlash",t[t.Tilde=192]="Tilde",t[t.GraveAccent=192]="GraveAccent",t[t.OpenBracket=219]="OpenBracket",t[t.ClosedBracket=221]="ClosedBracket",t[t.Quote=222]="Quote"}(e.KeyCode||(e.KeyCode={}));var i=function(){function t(){}return t.initialize=function(){this.isInitialized||(this.isInitialized=!0,this.eventDispatcher=new n)},t.start=function(){if(!this.isRunning){this.isRunning=!0,this.initialize(),trace("[KeyWatcher] start");var t=jQuery(window);t.on("keydown",this.windowKeyDownHandler),t.on("keyup",this.windowKeyUpHandler)}},t.stop=function(){if(this.isRunning){this.isRunning=!1,this.initialize(),trace("[KeyWatcher] stop");var t=jQuery(window);t.off("keydown",this.windowKeyDownHandler),t.off("keyup",this.windowKeyUpHandler)}},t.addEventListener=function(t,e){this.initialize(),this.eventDispatcher.addEventListener(t,e)},t.removeEventListener=function(t,e){this.initialize(),this.eventDispatcher.removeEventListener(t,e)},t.getIsRunning=function(){return this.isRunning},t.getIsAnyKeyPressed=function(){return this.pressedKeyCount>0},t.getIsKeyPressed=function(t){return null!=this.isKeyPressedByKeyCode[t]},t.getIsContinuousPressEnabled=function(){return this.isContinuousPressEnabled},t.setIsContinuousPressEnabled=function(t){this.isContinuousPressEnabled=t},t.windowKeyDownHandler=function(n){var i=n.keyCode;null==t.isKeyPressedByKeyCode[i]?(t.isKeyPressedByKeyCode[i]=!0,++t.pressedKeyCount,t.eventDispatcher.dispatchEvent(new e.KeyWatcherEvent(e.KeyWatcherEvent.KEY_DOWN,t,n))):t.isContinuousPressEnabled&&t.eventDispatcher.dispatchEvent(new e.KeyWatcherEvent(e.KeyWatcherEvent.KEY_DOWN,t,n))},t.windowKeyUpHandler=function(n){var i=n.keyCode;null!=t.isKeyPressedByKeyCode[i]&&(delete t.isKeyPressedByKeyCode[i],--t.pressedKeyCount,t.eventDispatcher.dispatchEvent(new e.KeyWatcherEvent(e.KeyWatcherEvent.KEY_UP,t,n)))},t.isRunning=!1,t.pressedKeyCount=0,t.isKeyPressedByKeyCode={},t.isContinuousPressEnabled=!1,t.isInitialized=!1,t.pressTimer=null,t.isLongPressed=!1,t.eventDispatcher=null,t}();e.KeyWatcher=i}(t.browser||(t.browser={}))}(alm||(alm={}));!function(t){!function(e){var n=function(t){function e(e,n,i){void 0===n&&(n=null),void 0===i&&(i=null);var o=t.call(this,e,n)||this;return o.jqueryEvent=i,o.key=o.jqueryEvent.key,o.keyCode=o.jqueryEvent.keyCode,o.altKey=o.jqueryEvent.altKey,o.ctrlKey=o.jqueryEvent.ctrlKey,o.shiftKey=o.jqueryEvent.shiftKey,o}return __extends(e,t),e.prototype.clone=function(){return new e(this.getType(),this.getTarget(),this.jqueryEvent)},e.prototype.toString=function(){return"[KeyWatcherEvent] type = "+this.getType()+", key = "+this.key+", keyCode = "+this.keyCode+", altKey = "+this.altKey+", ctrlKey = "+this.ctrlKey+", shiftKey = "+this.shiftKey},e.KEY_UP="keyUp",e.KEY_DOWN="keyDown",e}(t.event.Event);e.KeyWatcherEvent=n}(t.browser||(t.browser={}))}(alm||(alm={}));!function(t){!function(e){var n=t.event.EventDispatcher,i=function(){function t(){}return t.initialize=function(){this.isInitialized||(this.isInitialized=!0,this.eventDispatcher=new n)},t.start=function(){this.isRunning||(this.isRunning=!0,this.initialize(),trace("[WindowWatcher] start"),jQuery(window).on("resize",this.windowScrollHandler),jQuery(window).on("scroll",this.windowScrollHandler),this.apply())},t.stop=function(){this.isRunning&&(this.isRunning=!1,this.initialize(),trace("[WindowWatcher] stop"),jQuery(window).off("resize",this.windowScrollHandler),jQuery(window).off("scroll",this.windowScrollHandler))},t.apply=function(){var t=jQuery(window);this.windowWidth=t.width(),this.windowHeight=t.height(),this.scrollTop=t.scrollTop(),this.scrollBottom=this.scrollTop+this.windowHeight},t.addEventListener=function(t,e){this.initialize(),this.eventDispatcher.addEventListener(t,e)},t.removeEventListener=function(t,e){this.initialize(),this.eventDispatcher.removeEventListener(t,e)},t.calcScrolledPosition=function(t){return t-this.scrollTop},t.calcScrolledPositionRatio=function(t){return this.calcScrolledPosition(t)/this.windowHeight},t.getIsRunning=function(){return this.isRunning},t.getScrollTop=function(){return this.scrollTop},t.getScrollBottom=function(){return this.scrollBottom},t.getWindowWidth=function(){return this.windowWidth},t.getWindowHeight=function(){return this.windowHeight},t.windowScrollHandler=function(n){t.apply(),t.eventDispatcher.dispatchEvent(new e.WindowWatcherEvent(e.WindowWatcherEvent.SCROLL,t,n,t.scrollTop,t.scrollBottom,t.windowWidth,t.windowHeight))},t.windowResizeHandler=function(n){t.apply(),t.eventDispatcher.dispatchEvent(new e.WindowWatcherEvent(e.WindowWatcherEvent.RESIZE,t,n,t.scrollTop,t.scrollBottom,t.windowWidth,t.windowHeight))},t.isRunning=!1,t.windowWidth=0,t.windowHeight=0,t.isInitialized=!1,t.eventDispatcher=null,t}();e.WindowWatcher=i}(t.browser||(t.browser={}))}(alm||(alm={}));!function(t){!function(e){var n=function(t){function e(e,n,i,o,r,s,a){void 0===n&&(n=null),void 0===i&&(i=null),void 0===o&&(o=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===a&&(a=0);var u=t.call(this,e,n)||this;return u.jqueryEvent=i,u.scrollTop=o,u.scrollBottom=r,u.windowWidth=s,u.windowHeight=a,u}return __extends(e,t),e.prototype.clone=function(){return new e(this.getType(),this.getTarget(),this.jqueryEvent,this.scrollTop,this.scrollBottom,this.windowWidth,this.windowHeight)},e.prototype.toString=function(){return"[WindowWatcherEvent] type = "+this.getType()+", scrollTop = "+this.scrollTop+", scrollBottom = "+this.scrollBottom+", windowWidth = "+this.windowWidth+", windowHeight = "+this.windowHeight},e.SCROLL="scroll",e.RESIZE="resize",e}(t.event.Event);e.WindowWatcherEvent=n}(t.browser||(t.browser={}))}(alm||(alm={}));!function(t){var e=alm.util.Logger,n=function(n){function i(e){var i=n.call(this)||this;return i.name=e,i.state=t.SceneState.Idling,i.parent=null,i.childrenByName={},i.numChildren=0,i.isEntered=!1,i.onLoad=null,i.onUnload=null,i.onArrive=null,i.onLeave=null,i.onAscend=null,i.onDescend=null,i}return __extends(i,n),i.prototype.addChild=function(t){if(t){var n=t.name;if(!this.childrenByName[n])return++this.numChildren,t.parent=this,this.childrenByName[n]=t,t;e.warn("[Scene '"+this.name+"'] addChild was failed, because child name '"+n+"' is already contained.")}else e.warn("[Scene '"+this.name+"'] addChild was failed, because child is null.");return null},i.prototype.removeChild=function(t){if(t){var n=t.name;if(this.childrenByName[n])return--this.numChildren,t.parent=null,delete this.childrenByName[n],t;e.warn("[Scene '"+this.name+"'] removeChild was failed, because child name '"+n+"' is not contained.")}else e.warn("[Scene '"+this.name+"'] removeChild was failed, because child is null.");return null},i.prototype.addChildren=function(t){for(var e,n=[],i=t.length,o=0;o<i;++o)(e=this.addChild(t[o]))&&n.push(e);return n},i.prototype.removeChildren=function(t){for(var e,n=[],i=t.length,o=0;o<i;++o)(e=this.removeChild(t[o]))&&n.push(e);return n},i.prototype.removeAllChildren=function(){var t,e=[];for(var n in this.childrenByName)(t=this.childrenByName[n]).parent=null,e.push(t);return this.childrenByName={},this.numChildren=0,e},i.prototype.contains=function(t){return!!t&&null!=this.childrenByName["string"==typeof t?t:t.name]},i.prototype.getName=function(){return this.name},i.prototype.getState=function(){return this.state},i.prototype.getLastState=function(){return this.lastState},i.prototype.getParent=function(){return this.parent},i.prototype.getChildByName=function(t){return this.childrenByName[t]},i.prototype.getNumChildren=function(){return this.numChildren},i.prototype.getManager=function(){return this.parent?this.parent.getManager():(e.warn("[Scene '"+this.name+"'] getManager was failed, check whether if scene is connected to root."),null)},i.prototype.getPath=function(){var t=this.getManager();if(t){for(var n=[this.name],i=this;i=i.parent;)n.unshift(i.name);return t.getScenePathByNames(n)}return e.warn("[Scene '"+this.name+"'] getPath was failed, check whether if scene is connected to root."),null},i.prototype.gotoScene=function(t){this.getManager().goto(t)},i.prototype._load=function(e){var n=this;this.transferInfo=e,this.state=t.SceneState.Loading,this.isEntered=!0;var i=new cmd.Serial(function(){n.dispatchEvent(new t.SceneEvent(t.SceneEvent.LOAD,n));var e="function"==typeof n.onLoad?n.onLoad():n.implOnLoad();e&&i.insertCommand(e)},function(){n.lastState=n.state,n.state=t.SceneState.Idling,n.dispatchEvent(new t.SceneEvent(t.SceneEvent.LOAD_COMPLETE,n))});i.execute()},i.prototype._unload=function(e){var n=this;this.transferInfo=e,this.state=t.SceneState.Unloading,this.isEntered=!1;var i=new cmd.Serial(function(){n.dispatchEvent(new t.SceneEvent(t.SceneEvent.UNLOAD,n));var e="function"==typeof n.onUnload?n.onUnload():n.implOnUnload();e&&i.insertCommand(e)},function(){n.lastState=n.state,n.state=t.SceneState.Idling,n.dispatchEvent(new t.SceneEvent(t.SceneEvent.UNLOAD_COMPLETE,n))});i.execute()},i.prototype._arrive=function(e){var n=this;this.transferInfo=e,this.state=t.SceneState.Arriving,this.isEntered=!0;var i=new cmd.Serial(function(){n.dispatchEvent(new t.SceneEvent(t.SceneEvent.ARRIVE,n));var e="function"==typeof n.onArrive?n.onArrive():n.implOnArrive();e&&i.insertCommand(e)},function(){n.lastState=n.state,n.state=t.SceneState.Idling,n.dispatchEvent(new t.SceneEvent(t.SceneEvent.ARRIVE_COMPLETE,n))});i.execute()},i.prototype._leave=function(e){var n=this;this.transferInfo=e,this.state=t.SceneState.Leaving,this.isEntered=!1;var i=new cmd.Serial(function(){n.dispatchEvent(new t.SceneEvent(t.SceneEvent.LEAVE,n));var e="function"==typeof n.onLeave?n.onLeave():n.implOnLeave();e&&i.insertCommand(e)},function(){n.lastState=n.state,n.state=t.SceneState.Idling,n.dispatchEvent(new t.SceneEvent(t.SceneEvent.LEAVE_COMPLETE,n))});i.execute()},i.prototype._ascend=function(e){var n=this;this.transferInfo=e,this.state=t.SceneState.Ascending,this.isEntered=!0;var i=new cmd.Serial(function(){n.dispatchEvent(new t.SceneEvent(t.SceneEvent.ASCEND,n));var e="function"==typeof n.onAscend?n.onAscend():n.implOnAscend();e&&i.insertCommand(e)},function(){n.lastState=n.state,n.state=t.SceneState.Idling,n.dispatchEvent(new t.SceneEvent(t.SceneEvent.ASCEND_COMPLETE,n))});i.execute()},i.prototype._descend=function(e){var n=this;this.transferInfo=e,this.state=t.SceneState.Descending,this.isEntered=!1;var i=new cmd.Serial(function(){n.dispatchEvent(new t.SceneEvent(t.SceneEvent.DESCEND,n));var e="function"==typeof n.onDescend?n.onDescend():n.implOnDescend();e&&i.insertCommand(e)},function(){n.lastState=n.state,n.state=t.SceneState.Idling,n.dispatchEvent(new t.SceneEvent(t.SceneEvent.DESCEND_COMPLETE,n))});i.execute()},i.prototype.implOnLoad=function(){return new cmd.Command},i.prototype.implOnUnload=function(){return new cmd.Command},i.prototype.implOnArrive=function(){return new cmd.Command},i.prototype.implOnLeave=function(){return new cmd.Command},i.prototype.implOnAscend=function(){return new cmd.Command},i.prototype.implOnDescend=function(){return new cmd.Command},i}(alm.event.EventDispatcher);t.Scene=n}(scn||(scn={}));!function(t){var e=function(t){function e(e,n){return void 0===n&&(n=null),t.call(this,e,n)||this}return __extends(e,t),e.prototype.clone=function(){return new e(this.getType(),this.getTarget())},e.prototype.toString=function(){return"[SceneEvent] type = "+this.getType()},e.LOAD="load",e.UNLOAD="unload",e.ARRIVE="arrive",e.LEAVE="leave",e.ASCEND="ascend",e.DESCEND="descend",e.LOAD_COMPLETE="loadComplete",e.UNLOAD_COMPLETE="unloadComplete",e.ARRIVE_COMPLETE="arriveComplete",e.LEAVE_COMPLETE="leaveComplete",e.ASCEND_COMPLETE="ascendComplete",e.DESCEND_COMPLETE="descendComplete",e}(alm.event.Event);t.SceneEvent=e}(scn||(scn={}));!function(t){var e=alm.util.Logger,n=alm.util.LoggerLevel,i=function(i){function o(e){void 0===e&&(e="");var n=i.call(this)||this;return n.sceneLoadCompleteHandler=function(e){n.currentScene.removeEventListener(t.SceneEvent.LOAD_COMPLETE,n.sceneLoadCompleteHandler),n.lastState=t.SceneState.Loading,++n.eventIndex,n.checkState()},n.sceneUnloadCompleteHandler=function(e){n.currentScene.removeEventListener(t.SceneEvent.UNLOAD_COMPLETE,n.sceneUnloadCompleteHandler),n.lastState=t.SceneState.Unloading,++n.eventIndex,n.checkState()},n.sceneArriveCompleteHandler=function(e){n.currentScene.removeEventListener(t.SceneEvent.ARRIVE_COMPLETE,n.sceneArriveCompleteHandler),n.lastState=t.SceneState.Arriving,++n.eventIndex,n.checkState()},n.sceneLeaveCompleteHandler=function(e){n.currentScene.removeEventListener(t.SceneEvent.LEAVE_COMPLETE,n.sceneLeaveCompleteHandler),n.lastState=t.SceneState.Leaving,++n.eventIndex,n.checkState()},n.sceneAscendCompleteHandler=function(e){n.currentScene.removeEventListener(t.SceneEvent.ASCEND_COMPLETE,n.sceneAscendCompleteHandler),n.lastState=t.SceneState.Ascending,++n.eventIndex,n.checkState()},n.sceneDescendCompleteHandler=function(e){n.currentScene.removeEventListener(t.SceneEvent.DESCEND_COMPLETE,n.sceneDescendCompleteHandler),n.lastState=t.SceneState.Descending,++n.eventIndex,n.checkState()},n.name=e,n.root=new t.core.RootScene(n),n.currentScene=null,n.waypoints=[],n.waypointIndex=-1,n.lastState=t.SceneState.Idling,n.eventIndex=-1,n.transferId=-1,n.transferInfo=null,n}return __extends(o,i),o.prototype.start=function(){e.verbose("----- scene manager start -----"),this.goto("/")},o.prototype.goto=function(n){if(n=this.resolvePath(n),!this.transferInfo||this.transferInfo.getDestinationPath()!=n){var i=[];if((i=-1!=this.waypointIndex?this.createWaypoints(this.waypoints[this.waypointIndex].getPath(),n):[new t.core.Waypoint("/",0)]).length>0){var o=null!=this.transferInfo;o?(e.verbose("destination is changed"),e.verbose("waypoint index : "+this.waypointIndex),this.waypoints=this.waypoints.slice(0,this.waypointIndex+1).concat(i.slice(1)),this.setDirection(this.waypoints),this.printWaypoint(this.waypoints)):(this.waypointIndex=0,this.eventIndex=0,++this.transferId,this.waypoints=i),this.transferInfo=new t.SceneTransferInfo(this.transferId,this.waypoints[this.waypointIndex].getPath(),this.waypoints[this.waypoints.length-1].getPath()),o||this.dispatchEvent(new t.SceneManagerEvent(t.SceneManagerEvent.TRANSFER_START,this)),this.checkState()}}},o.prototype.resolvePath=function(t){"/"!=t[0]&&(t=this.currentScene?this.currentScene.getPath()+"/"+t:"/"+t);for(var e=t.split("/"),n=[],i=0;i<e.length;++i){var o=e[i];""!=o&&("."!=o&&(".."!=o?n.push(o):n.pop()))}return"/"+n.join("/")},o.prototype.addSceneAt=function(n,i){void 0===i&&(i=!1);for(var o=!1,r=this.getSceneNamesByPath(n),s=r.length,a=this.root,u=1;u<s;++u){var c=r[u];u==s-1?a.contains(c)?e.warn("[SceneManager '"+this.name+"'] addSceneAt was failed, because path '"+n+"' is already exist."):(a=a.addChild(new t.Scene(c)),o=!0):a=a.contains(c)?a.getChildByName(c):a.addChild(new t.Scene(c))}return o?a:null},o.prototype.getName=function(){return this.name},o.prototype.getRoot=function(){return this.root},o.prototype.getSceneByPath=function(t){for(var e=this.getSceneNamesByPath(t),n=e.length,i=this.root,o=1;o<n;++o)i=i.getChildByName(e[o]);return i},o.prototype.getSceneNamesByPath=function(t){return"/"==t?[""]:this.resolvePath(t).split("/")},o.prototype.getSceneLevelByNames=function(t){return t.length-1},o.prototype.getScenePathByNames=function(t){return 0==t.length?"/":1==t.length?"/"+t[0]:t.join("/")},o.prototype.createWaypoints=function(i,o){if(i==o)return e.warn("[SceneManager] departure path and destination path is same, path = '"+i+"'"),[];e.verbose("----- scene flow -----");var r=[new t.core.Waypoint(i,this.getSceneLevelByNames(this.getSceneNamesByPath(i)))],s=this.getSceneNamesByPath(i),a=this.getSceneNamesByPath(o);e.verbose("    path"),e.verbose("        current    : '"+i+"'"),e.verbose("        destination: '"+o+"'"),e.verbose("    names"),e.verbose("        current("+s.length+")    : '"+s+"'"),e.verbose("        destination("+a.length+"): '"+a+"'");var u,c=0,h=[];if("/"==o)c=-1,h=[],u="/";else{for(;;){if(s[c]!=a[c]){--c;break}h.push(s[c]),++c}u=this.getScenePathByNames(h)}e.verbose("    turning"),e.verbose("        path     : "+u),e.verbose("        level    : "+c),e.verbose("        names("+h.length+") : '"+h+"'");for(var l=s.concat(),p=i,d=s.length-1;d>c+1;--d){l.pop();if((v=this.getScenePathByNames(l))!=p){y=this.getSceneLevelByNames(l);r.push(new t.core.Waypoint(v,y)),p=v}}if(u==o&&c>0){c==r[r.length-1].getLevel()?t.core.Direction.Sibling:t.core.Direction.Ascend;r.push(new t.core.Waypoint(u,c))}else for(var l=h.concat(),f=r[r.length-1],p=f.getPath(),d=(f.getLevel(),c+1);d<a.length;++d){var m=a[d];l.push(m);var v=this.getScenePathByNames(l);if(v!=p){var y=this.getSceneLevelByNames(l);r.push(new t.core.Waypoint(v,y)),y,p=v}}return this.setDirection(r),e.level<=n.Verbose&&this.printWaypoint(r),r},o.prototype.setDirection=function(e){for(var n,i=e.length,o=null,r=0;r<i;++r){if(n=e[r],r>0){var s=n.getLevel()-o.getLevel();n._setFrom(s>0?t.core.Direction.Descend:s<0?t.core.Direction.Ascend:t.core.Direction.Sibling),o._setTo(n.getFrom())}o=n}},o.prototype.printWaypoint=function(t){e.verbose("    waypoints");for(var n=t.length,i=0;i<n;++i)e.verbose("        ["+i+"] "+t[i]);e.verbose("")},o.prototype.checkState=function(){if(trace("lastState : "+t.getSceneStateString(this.lastState)),this.waypointIndex>=this.waypoints.length){e.verbose("----- scene transfer complete -----");var n=this.transferInfo.getTransferId();return this.waypointIndex=this.waypoints.length-1,this.dispatchEvent(new t.SceneManagerEvent(t.SceneManagerEvent.TRANSFER_COMPLETE,this)),void(n==this.transferInfo.getTransferId()&&(this.lastState=t.SceneState.Idling,this.transferInfo=null))}if(this.currentScene){var i=this.waypoints[this.waypointIndex];if(this.currentScene=this.getSceneByPath(i.getPath()),this.waypoints.length>1&&0==this.waypointIndex)return trace("Departure scene"),this.lastState!=t.SceneState.Leaving&&this.currentScene.getLastState()==t.SceneState.Arriving?(e.verbose(this.eventIndex+" Leave   : '"+this.currentScene.getPath()+"'"),this.currentScene.addEventListener(t.SceneEvent.LEAVE_COMPLETE,this.sceneLeaveCompleteHandler),void this.currentScene._leave(this.transferInfo)):this.lastState==t.SceneState.Unloading||i.getTo()!=t.core.Direction.Sibling&&i.getTo()!=t.core.Direction.Ascend?(++this.waypointIndex,void this.checkState()):(++this.waypointIndex,e.verbose(this.eventIndex+" Unload  : '"+this.currentScene.getPath()+"'"),this.currentScene.addEventListener(t.SceneEvent.UNLOAD_COMPLETE,this.sceneUnloadCompleteHandler),void this.currentScene._unload(this.transferInfo));if(this.waypointIndex>0&&this.waypointIndex<this.waypoints.length-1){if(trace("Through scene"),this.lastState!=t.SceneState.Loading&&(i.getFrom()==t.core.Direction.Sibling||i.getFrom()==t.core.Direction.Descend))return e.verbose(this.eventIndex+" Load    : '"+this.currentScene.getPath()+"'"),this.currentScene.addEventListener(t.SceneEvent.LOAD_COMPLETE,this.sceneLoadCompleteHandler),void this.currentScene._load(this.transferInfo);if(this.lastState!=t.SceneState.Ascending&&i.getFrom()==t.core.Direction.Ascend)return e.verbose(this.eventIndex+" Ascend  : '"+this.currentScene.getPath()+"'"),this.currentScene.addEventListener(t.SceneEvent.ASCEND_COMPLETE,this.sceneAscendCompleteHandler),void this.currentScene._ascend(this.transferInfo);if(this.lastState!=t.SceneState.Unloading&&(i.getTo()==t.core.Direction.Sibling||i.getTo()==t.core.Direction.Ascend))return++this.waypointIndex,e.verbose(this.eventIndex+" Unload  : '"+this.currentScene.getPath()+"'"),this.currentScene.addEventListener(t.SceneEvent.UNLOAD_COMPLETE,this.sceneUnloadCompleteHandler),void this.currentScene._unload(this.transferInfo);if(this.lastState!=t.SceneState.Descending&&i.getTo()==t.core.Direction.Descend)return++this.waypointIndex,e.verbose(this.eventIndex+" Descend : '"+this.currentScene.getPath()+"'"),this.currentScene.addEventListener(t.SceneEvent.DESCEND_COMPLETE,this.sceneDescendCompleteHandler),void this.currentScene._descend(this.transferInfo)}if(this.waypointIndex==this.waypoints.length-1){if(trace("Destination scene"),this.lastState!=t.SceneState.Loading&&(i.getFrom()==t.core.Direction.Sibling||i.getFrom()==t.core.Direction.Descend))return e.verbose(this.eventIndex+" Load    : '"+this.currentScene.getPath()+"'"),this.currentScene.addEventListener(t.SceneEvent.LOAD_COMPLETE,this.sceneLoadCompleteHandler),void this.currentScene._load(this.transferInfo);if(this.lastState!=t.SceneState.Arriving)return++this.waypointIndex,e.verbose(this.eventIndex+" Arrive  : '"+this.currentScene.getPath()+"'"),this.currentScene.addEventListener(t.SceneEvent.ARRIVE_COMPLETE,this.sceneArriveCompleteHandler),void this.currentScene._arrive(this.transferInfo)}}else trace("Init scene"),this.lastState=t.SceneState.Idling,this.currentScene=this.root,e.verbose(this.eventIndex+" Load    : '"+this.currentScene.getPath()+"'"),this.currentScene.addEventListener(t.SceneEvent.LOAD_COMPLETE,this.sceneLoadCompleteHandler),this.currentScene._load(this.transferInfo)},o}(alm.event.EventDispatcher);t.SceneManager=i}(scn||(scn={}));!function(t){var e=function(t){function e(e,n){return void 0===n&&(n=null),t.call(this,e,n)||this}return __extends(e,t),e.prototype.clone=function(){return new e(this.getType(),this.getTarget())},e.prototype.toString=function(){return"[SceneManagerEvent] type = "+this.getType()},e.TRANSFER_START="transferStart",e.TRANSFER_COMPLETE="transferComplete",e}(alm.event.Event);t.SceneManagerEvent=e}(scn||(scn={}));!function(t){var e=function(){function t(t,e,n){this.transferId=t,this.departurePath=e,this.destinationPath=n,this.relay=null}return t.prototype.getTransferId=function(){return this.transferId},t.prototype.getDeparturePath=function(){return this.departurePath},t.prototype.getDestinationPath=function(){return this.destinationPath},t}();t.SceneTransferInfo=e}(scn||(scn={}));!function(t){var e;!function(t){t[t.Idling=0]="Idling",t[t.Loading=1]="Loading",t[t.Unloading=2]="Unloading",t[t.Arriving=3]="Arriving",t[t.Leaving=4]="Leaving",t[t.Ascending=5]="Ascending",t[t.Descending=6]="Descending"}(e=t.SceneState||(t.SceneState={})),t.getSceneStateString=function(t){switch(t){case e.Idling:return"idling";case e.Loading:return"loading";case e.Unloading:return"unloading";case e.Arriving:return"arriving";case e.Leaving:return"leaving";case e.Ascending:return"ascending";case e.Descending:return"descending"}return""}}(scn||(scn={}));!function(t){!function(t){var e;!function(t){t[t.Static=0]="Static",t[t.Sibling=1]="Sibling",t[t.Ascend=2]="Ascend",t[t.Descend=3]="Descend"}(e=t.Direction||(t.Direction={})),t.getDirectionString=function(t){switch(t){case e.Static:return"static";case e.Sibling:return"sibling";case e.Ascend:return"ascend";case e.Descend:return"descend"}return""}}(t.core||(t.core={}))}(scn||(scn={}));!function(t){!function(e){var n=function(t){function e(e){var n=t.call(this,"")||this;return n.manager=e,n}return __extends(e,t),e.prototype.getManager=function(){return this.manager},e}(t.Scene);e.RootScene=n}(t.core||(t.core={}))}(scn||(scn={}));var scn;!function(t){!function(t){var e=function(){function e(e,n){this.path=e,this.level=n,this.from=t.Direction.Static,this.to=t.Direction.Static}return e.prototype.getPath=function(){return this.path},e.prototype.getLevel=function(){return this.level},e.prototype.getFrom=function(){return this.from},e.prototype.getTo=function(){return this.to},e.prototype._setFrom=function(t){this.from=t},e.prototype._setTo=function(t){this.to=t},e.prototype.toString=function(){return"[Waypoint] path = '"+this.path+"', level = "+this.level+", from = "+t.getDirectionString(this.from)+", to = "+t.getDirectionString(this.to)},e}();t.Waypoint=e}(t.core||(t.core={}))}(scn||(scn={}));var alm;!function(t){function e(){return"0.0.1"}t.getVersion=e;var n="color:#999;",i=console.debug;i("%c+ + + + + + + + + + + + + + + + + + + + + + + + + +",n),i("%c+ alumican.js",n),i("%c+ version 0.0.1",n),i("%c+ http://alumican.net",n),i("%c+ https://github.com/alumican/alumican.js",n),i("%c+ + + + + + + + + + + + + + + + + + + + + + + + + +",n),i("")}(alm||(alm={}));
//# sourceMappingURL=alumican.min.js.map
